<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="language" content="en" />
        <link href="./assets/7ad99c2d/css/bootstrap.css" rel="stylesheet">
<link href="./assets/d607947b/style.css" rel="stylesheet">
<script src="./assets/ff75f2d2/jquery.js"></script>
<script src="./assets/7ad99c2d/js/bootstrap.js"></script>
<script src="./assets/ee9fb928/jssearch.js"></script>    <title>Yii Framework 2.0 API Documentation</title>
</head>
<body>

<div class="wrap">
    <nav id="w479" class="navbar-inverse navbar-fixed-top navbar" role="navigation"><div class="navbar-header"><button class="navbar-toggle" data-toggle="collapse" data-target="#w479-collapse"><span class="sr-only">Toggle navigation</span>
<span class="icon-bar"></span>
<span class="icon-bar"></span>
<span class="icon-bar"></span></button><a class="navbar-brand" href="./index.html">Yii 2.0 API 文档</a></div><div id="w479-collapse" class="collapse navbar-collapse"><ul id="w480" class="navbar-nav nav"><li><a href="./index.html">类参考</a></li>
<li class="dropdown"><a class="dropdown-toggle" href="#" data-toggle="dropdown">扩展 <b class="caret"></b></a><ul id="w481" class="dropdown-menu"><li><a href="./ext-apidoc-index.html" tabindex="-1">apidoc</a></li>
<li><a href="./ext-authclient-index.html" tabindex="-1">authclient</a></li>
<li><a href="./ext-bootstrap-index.html" tabindex="-1">bootstrap</a></li>
<li><a href="./ext-codeception-index.html" tabindex="-1">codeception</a></li>
<li><a href="./ext-composer-index.html" tabindex="-1">composer</a></li>
<li><a href="./ext-debug-index.html" tabindex="-1">debug</a></li>
<li><a href="./ext-elasticsearch-index.html" tabindex="-1">elasticsearch</a></li>
<li><a href="./ext-faker-index.html" tabindex="-1">faker</a></li>
<li><a href="./ext-gii-index.html" tabindex="-1">gii</a></li>
<li><a href="./ext-imagine-index.html" tabindex="-1">imagine</a></li>
<li><a href="./ext-jui-index.html" tabindex="-1">jui</a></li>
<li><a href="./ext-mongodb-index.html" tabindex="-1">mongodb</a></li>
<li><a href="./ext-redis-index.html" tabindex="-1">redis</a></li>
<li><a href="./ext-smarty-index.html" tabindex="-1">smarty</a></li>
<li><a href="./ext-sphinx-index.html" tabindex="-1">sphinx</a></li>
<li><a href="./ext-swiftmailer-index.html" tabindex="-1">swiftmailer</a></li>
<li><a href="./ext-twig-index.html" tabindex="-1">twig</a></li></ul></li>
<li><a href="./guide-README.html">权威指南</a></li>
<li class="dropdown"><a class="dropdown-toggle" href="#" data-toggle="dropdown">Github <b class="caret"></b></a><ul id="w482" class="dropdown-menu"><li><a href="https://github.com/yiisoft/yii2" tabindex="-1">Yii 2.0</a></li>
<li><a href="https://github.com/yii2-chinesization/yii2-zh-cn" tabindex="-1">Yii 2.0 中文化项目</a></li>
<li><a href="https://github.com/AbrahamGreyson/abrahamgreyson.github.io" tabindex="-1">docwithcn.com</a></li></ul></li></ul><div class="navbar-form navbar-left" role="search">
  <div class="form-group">
    <input id="searchbox" type="text" class="form-control" placeholder="Search">
  </div>
</div>
</div></nav>
    <div id="search-resultbox" style="display: none;" class="modal-content">
        <ul id="search-results">
        </ul>
    </div>

    
<div class="row">
    <div class="col-md-2">
                <div id="navigation" class="list-group"><a class="list-group-item" href="#navigation-462" data-toggle="collapse" data-parent="#navigation">介绍 <b class="caret"></b></a><div id="navigation-462" class="submenu panel-collapse collapse"><a class="list-group-item" href="./guide-intro-yii.html">关于 Yii</a>
<a class="list-group-item" href="./guide-intro-upgrade-from-v1.html">从 Yii 1.1 升级</a></div>
<a class="list-group-item" href="#navigation-463" data-toggle="collapse" data-parent="#navigation">入门 <b class="caret"></b></a><div id="navigation-463" class="submenu panel-collapse collapse"><a class="list-group-item" href="./guide-start-installation.html">安装 Yii</a>
<a class="list-group-item" href="./guide-start-workflow.html">运行应用</a>
<a class="list-group-item" href="./guide-start-hello.html">第一次问候</a>
<a class="list-group-item" href="./guide-start-forms.html">使用 Forms</a>
<a class="list-group-item" href="./guide-start-databases.html">玩转 Databases</a>
<a class="list-group-item" href="./guide-start-gii.html">用 Gii 生成代码</a>
<a class="list-group-item" href="./guide-start-looking-ahead.html">更上一层楼</a></div>
<a class="list-group-item" href="#navigation-464" data-toggle="collapse" data-parent="#navigation">应用结构 <b class="caret"></b></a><div id="navigation-464" class="submenu panel-collapse collapse"><a class="list-group-item" href="./guide-structure-overview.html">结构总览</a>
<a class="list-group-item" href="./guide-structure-entry-scripts.html">入口脚本</a>
<a class="list-group-item" href="./guide-structure-applications.html">应用</a>
<a class="list-group-item" href="./guide-structure-application-components.html">应用组件</a>
<a class="list-group-item" href="./guide-structure-controllers.html">控制器（Controller）</a>
<a class="list-group-item" href="./guide-structure-views.html">视图（View）</a>
<a class="list-group-item" href="./guide-structure-models.html">模型（Model）</a>
<a class="list-group-item" href="./guide-structure-filters.html">过滤器</a>
<a class="list-group-item" href="./guide-structure-widgets.html">小部件（Widget）</a>
<a class="list-group-item" href="./guide-structure-modules.html">模块（Module）</a>
<a class="list-group-item" href="./guide-structure-assets.html">前端资源（Asset）</a>
<a class="list-group-item" href="./guide-structure-extensions.html">扩展（extensions）</a></div>
<a class="list-group-item" href="#navigation-465" data-toggle="collapse" data-parent="#navigation">请求处理 <b class="caret"></b></a><div id="navigation-465" class="submenu panel-collapse collapse"><a class="list-group-item" href="./guide-runtime-bootstrapping.html">引导（Bootstrapping）</a>
<a class="list-group-item" href="./guide-runtime-routing.html">路由（Routing）</a>
<a class="list-group-item" href="./guide-runtime-requests.html">请求（Request）</a>
<a class="list-group-item" href="./guide-runtime-responses.html">响应（Response）</a>
<a class="list-group-item" href="./guide-runtime-sessions-cookies.html">Sessions（会话）和 Cookies</a>
<a class="list-group-item" href="./guide-runtime-url-handling.html">URL 解析和生成</a>
<a class="list-group-item" href="./guide-runtime-handling-errors.html">错误处理</a>
<a class="list-group-item" href="./guide-runtime-logging.html">日志</a></div>
<a class="list-group-item" href="#navigation-466" data-toggle="collapse" data-parent="#navigation">关键概念 <b class="caret"></b></a><div id="navigation-466" class="submenu panel-collapse collapse"><a class="list-group-item" href="./guide-concept-components.html">组件（Component）</a>
<a class="list-group-item" href="./guide-concept-properties.html">属性（Property）</a>
<a class="list-group-item" href="./guide-concept-events.html">事件（Event）</a>
<a class="list-group-item" href="./guide-concept-behaviors.html">行为（Behavior）</a>
<a class="list-group-item" href="./guide-concept-configurations.html">配置（Configurations）</a>
<a class="list-group-item" href="./guide-concept-autoloading.html">类自动加载（Autoloading）</a>
<a class="list-group-item" href="./guide-concept-alias.html">别名（Alias）</a>
<a class="list-group-item" href="./guide-concept-service-locator.html">服务定位器（Service Locator）</a>
<a class="list-group-item" href="./guide-concept-di-container.html">依赖注入容器（DI Container）</a></div>
<a class="list-group-item" href="#navigation-467" data-toggle="collapse" data-parent="#navigation">配合数据库工作 <b class="caret"></b></a><div id="navigation-467" class="submenu panel-collapse collapse"><a class="list-group-item" href="./guide-db-dao.html">数据访问对象（DAO）</a>
<a class="list-group-item" href="./guide-db-query-builder.html">查询生成器（Query Builder）</a>
<a class="list-group-item" href="./guide-db-active-record.html">活动记录（Active Record）</a>
<a class="list-group-item" href="./guide-db-migrations.html">数据库迁移（Migration）</a>
<a class="list-group-item" href="./guide-db-sphinx.html">Sphinx</a>
<a class="list-group-item" href="./guide-db-redis.html">Redis</a>
<a class="list-group-item" href="./guide-db-mongodb.html">MongoDB</a>
<a class="list-group-item" href="./guide-db-elastic-search.html">ElasticSearch</a></div>
<a class="list-group-item active" href="#navigation-468" data-toggle="collapse" data-parent="#navigation">接收用户数据 <b class="caret"></b></a><div id="navigation-468" class="submenu panel-collapse collapse in"><a class="list-group-item" href="./guide-input-forms.html">创建表单</a>
<a class="list-group-item active" href="./guide-input-validation.html">输入验证</a>
<a class="list-group-item" href="./guide-input-file-uploading.html">文件上传</a>
<a class="list-group-item" href="./guide-input-multiple-models.html">多模型同时输入</a></div>
<a class="list-group-item" href="#navigation-469" data-toggle="collapse" data-parent="#navigation">显示数据 <b class="caret"></b></a><div id="navigation-469" class="submenu panel-collapse collapse"><a class="list-group-item" href="./guide-output-formatting.html">格式化输出数据</a>
<a class="list-group-item" href="./guide-output-pagination.html">分页（Pagination）</a>
<a class="list-group-item" href="./guide-output-sorting.html">排序（Sorting）</a>
<a class="list-group-item" href="./guide-output-data-providers.html">数据提供器</a>
<a class="list-group-item" href="./guide-output-data-widgets.html">数据小部件</a>
<a class="list-group-item" href="./guide-output-theming.html">主题</a></div>
<a class="list-group-item" href="#navigation-470" data-toggle="collapse" data-parent="#navigation">安全 <b class="caret"></b></a><div id="navigation-470" class="submenu panel-collapse collapse"><a class="list-group-item" href="./guide-security-authentication.html">认证（Authentication）</a>
<a class="list-group-item" href="./guide-security-authorization.html">授权（Authorization）</a>
<a class="list-group-item" href="./guide-security-passwords.html">处理密码</a>
<a class="list-group-item" href="./guide-security-auth-clients.html">客户端认证</a>
<a class="list-group-item" href="./guide-security-best-practices.html">安全领域的最佳实践</a></div>
<a class="list-group-item" href="#navigation-471" data-toggle="collapse" data-parent="#navigation">缓存 <b class="caret"></b></a><div id="navigation-471" class="submenu panel-collapse collapse"><a class="list-group-item" href="./guide-caching-overview.html">概述</a>
<a class="list-group-item" href="./guide-caching-data.html">数据缓存</a>
<a class="list-group-item" href="./guide-caching-fragment.html">片段缓存</a>
<a class="list-group-item" href="./guide-caching-page.html">分页缓存</a>
<a class="list-group-item" href="./guide-caching-http.html">HTTP 缓存</a></div>
<a class="list-group-item" href="#navigation-472" data-toggle="collapse" data-parent="#navigation">RESTful Web 服务 <b class="caret"></b></a><div id="navigation-472" class="submenu panel-collapse collapse"><a class="list-group-item" href="./guide-rest-quick-start.html">快速入门</a>
<a class="list-group-item" href="./guide-rest-resources.html">资源</a>
<a class="list-group-item" href="./guide-rest-routing.html">路由</a>
<a class="list-group-item" href="./guide-rest-response-formatting.html">格式化响应</a>
<a class="list-group-item" href="./guide-rest-authentication.html">授权验证</a>
<a class="list-group-item" href="./guide-rest-rate-limiting.html">速率限制</a>
<a class="list-group-item" href="./guide-rest-versioning.html">版本化</a>
<a class="list-group-item" href="./guide-rest-error-handling.html">错误处理</a>
<a class="list-group-item" href="./guide-rest-testing.html">测试</a></div>
<a class="list-group-item" href="#navigation-473" data-toggle="collapse" data-parent="#navigation">开发工具 <b class="caret"></b></a><div id="navigation-473" class="submenu panel-collapse collapse"><a class="list-group-item" href="./guide-tool-debugger.html">调试工具栏和调试器</a>
<a class="list-group-item" href="./guide-tool-gii.html">使用 Gii 生成代码</a>
<a class="list-group-item" href="./guide-tool-api-doc.html">生成 API 文档</a></div>
<a class="list-group-item" href="#navigation-474" data-toggle="collapse" data-parent="#navigation">测试 <b class="caret"></b></a><div id="navigation-474" class="submenu panel-collapse collapse"><a class="list-group-item" href="./guide-test-overview.html">概述</a>
<a class="list-group-item" href="./guide-test-unit.html">单元测试</a>
<a class="list-group-item" href="./guide-test-functional.html">功能测试</a>
<a class="list-group-item" href="./guide-test-acceptance.html">验收测试</a>
<a class="list-group-item" href="./guide-test-fixtures.html">测试夹具</a></div>
<a class="list-group-item" href="#navigation-475" data-toggle="collapse" data-parent="#navigation">高级专题 <b class="caret"></b></a><div id="navigation-475" class="submenu panel-collapse collapse"><a class="list-group-item" href="./guide-tutorial-advanced-app.html">高级应用模版</a>
<a class="list-group-item" href="./guide-tutorial-start-from-scratch.html">从头构建自定义模版</a>
<a class="list-group-item" href="./guide-tutorial-console.html">控制台命令</a>
<a class="list-group-item" href="./guide-tutorial-core-validators.html">核心验证器</a>
<a class="list-group-item" href="./guide-tutorial-i18n.html">国际化</a>
<a class="list-group-item" href="./guide-tutorial-mailing.html">收发邮件</a>
<a class="list-group-item" href="./guide-tutorial-performance-tuning.html">性能优化</a>
<a class="list-group-item" href="./guide-tutorial-shared-hosting.html">共享主机环境</a>
<a class="list-group-item" href="./guide-tutorial-template-engines.html">模板引擎</a>
<a class="list-group-item" href="./guide-tutorial-yii-integration.html">集成第三方代码</a></div>
<a class="list-group-item" href="#navigation-476" data-toggle="collapse" data-parent="#navigation">小部件 <b class="caret"></b></a><div id="navigation-476" class="submenu panel-collapse collapse"><a class="list-group-item" href="./guide-widget-bootstrap.html">Bootstrap 小部件</a>
<a class="list-group-item" href="./guide-widget-jui.html">Jquery UI 小部件</a></div>
<a class="list-group-item" href="#navigation-477" data-toggle="collapse" data-parent="#navigation">助手类 <b class="caret"></b></a><div id="navigation-477" class="submenu panel-collapse collapse"><a class="list-group-item" href="./guide-helper-overview.html">助手一览</a>
<a class="list-group-item" href="./guide-helper-array.html">ArrayHelper</a>
<a class="list-group-item" href="./guide-helper-html.html">Html</a>
<a class="list-group-item" href="./guide-helper-url.html">Url</a>
<a class="list-group-item" href="./guide-helper-security.html">security</a></div>
<a class="list-group-item" href="#navigation-478" data-toggle="collapse" data-parent="#navigation">不在目录内的文件 <b class="caret"></b></a><div id="navigation-478" class="submenu panel-collapse collapse"><a class="list-group-item" href="./guide-glossary.html">glossary</a></div></div>    </div>
    <div class="col-md-9 guide-content" role="main">
        <h1>输入验证 <a href="#shu-ru-yan-zheng" name="shu-ru-yan-zheng" class="hashlink">&para;</a></h1>
<p>一般说来，程序猿永远不应该信任从最终用户直接接收到的数据，并且使用它们之前应始终先验证其可靠性。</p>
<p>要给 <a href="guide-structure-models.html">model</a> 填充其所需的用户输入数据，你可以调用 <a href="./yii-base-model.html#validate()-detail">yii\base\Model::validate()</a> 方法验证它们。该方法会返回一个布尔值，指明是否通过验证。若没有通过，你能通过 <a href="./yii-base-model.html#$errors-detail">yii\base\Model::$errors</a> 属性获取相应的报错信息。比如，</p>
<pre><code class="language-php"><span style="color: #0000BB">$model&nbsp;</span><span style="color: #007700">=&nbsp;new&nbsp;\</span><span style="color: #0000BB">app</span><span style="color: #007700">\</span><span style="color: #0000BB">models</span><span style="color: #007700">\</span><span style="color: #0000BB">ContactForm</span><span style="color: #007700">;<br /><br /></span><span style="color: #FF8000">//&nbsp;用用户输入来填充模型的特性<br /></span><span style="color: #0000BB">$model</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">attributes&nbsp;</span><span style="color: #007700">=&nbsp;\</span><span style="color: #0000BB">Yii</span><span style="color: #007700">::</span><span style="color: #0000BB">$app</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">request</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">post</span><span style="color: #007700">(</span><span style="color: #DD0000">'ContactForm'</span><span style="color: #007700">);<br /><br />if&nbsp;(</span><span style="color: #0000BB">$model</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">validate</span><span style="color: #007700">())&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">//&nbsp;若所有输入都是有效的<br /></span><span style="color: #007700">}&nbsp;else&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">//&nbsp;有效性验证失败：$errors&nbsp;属性就是存储错误信息的数组<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$errors&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$model</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">errors</span><span style="color: #007700">;<br />}</span></code></pre>
<p><code>validate()</code> 方法，在幕后为执行验证操作，进行了以下步骤：</p>
<ol>
<li>通过从 <a href="./yii-base-model.html#scenarios()-detail">yii\base\Model::scenarios()</a> 方法返回基于当前 <a href="./yii-base-model.html#$scenario-detail">场景（scenario）</a> 的特性属性列表，算出哪些特性应该进行有效性验证。这些属性被称作 <em>active attributes</em>（激活特性）。</li>
<li>通过从 <a href="./yii-base-model.html#rules()-detail">yii\base\Model::rules()</a> 方法返回基于当前 <a href="./yii-base-model.html#$scenario-detail">场景（scenario）</a> 的验证规则列表，这些规则被称作 <em>active rules</em>（激活规则）。</li>
<li>用每个激活规则去验证每个与之关联的激活特性。若失败，则记录下对应模型特性的错误信息。</li>
</ol>
<h2>声明规则（Rules） <a name="declaring-rules"></a> <a href="#sheng-ming-gui-ze-rules" name="sheng-ming-gui-ze-rules" class="hashlink">&para;</a></h2>
<p>要让 <code>validate()</code> 方法起作用，你需要声明与需验证模型特性相关的验证规则。为此，需要重写 <a href="./yii-base-model.html#rules()-detail">yii\base\Model::rules()</a> 方法。下面的例子展示了如何声明用于验证 <code>ContactForm</code> 模型的相关验证规则：</p>
<pre><code class="language-php"><span style="color: #0000BB"></span><span style="color: #007700">public&nbsp;function&nbsp;</span><span style="color: #0000BB">rules</span><span style="color: #007700">()<br />{<br />&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;[<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">//&nbsp;name，email，subject&nbsp;和&nbsp;body&nbsp;特性是&nbsp;`require`（必填）的<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">[[</span><span style="color: #DD0000">'name'</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">'email'</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">'subject'</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">'body'</span><span style="color: #007700">],&nbsp;</span><span style="color: #DD0000">'required'</span><span style="color: #007700">],<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">//&nbsp;email&nbsp;特性必须是一个有效的&nbsp;email&nbsp;地址<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">[</span><span style="color: #DD0000">'email'</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">'email'</span><span style="color: #007700">],<br />&nbsp;&nbsp;&nbsp;&nbsp;];<br />}</span></code></pre>
<p><a href="./yii-base-model.html#rules()-detail">rules()</a> 方法应返回一个由规则所组成的数组，每一个规则都呈现为以下这类格式的小数组：</p>
<pre><code class="language-php"><span style="color: #0000BB"></span><span style="color: #007700">[<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">//&nbsp;必须项，用于指定那些模型特性需要通过此规则的验证。<br />&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;对于只有一个特性的情况，可以直接写特性名，而不必用数组包裹。<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">[</span><span style="color: #DD0000">'attribute1'</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">'attribute2'</span><span style="color: #007700">,&nbsp;...],<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">//&nbsp;必填项，用于指定规则的类型。<br />&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;它可以是类名，验证器昵称，或者是验证方法的名称。<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #DD0000">'validator'</span><span style="color: #007700">,<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">//&nbsp;可选项，用于指定在场景（scenario）中，需要启用该规则<br />&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;若不提供，则代表该规则适用于所有场景<br />&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;若你需要提供除了某些特定场景以外的所有其他场景，你也可以配置&nbsp;"except"&nbsp;选项<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #DD0000">'on'&nbsp;</span><span style="color: #007700">=&gt;&nbsp;[</span><span style="color: #DD0000">'scenario1'</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">'scenario2'</span><span style="color: #007700">,&nbsp;...],<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">//&nbsp;可选项，用于指定对该验证器对象的其他配置选项<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #DD0000">'property1'&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #DD0000">'value1'</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">'property2'&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #DD0000">'value2'</span><span style="color: #007700">,&nbsp;...<br />]</span></code></pre>
<p>对于每个规则，你至少需要指定该规则适用于哪些特性，以及本规则的类型是什么。你可以指定以下的规则类型之一：</p>
<ul>
<li>核心验证器的昵称，比如 <code>required</code>、<code>in</code>、<code>date</code>，等等。请参考<a href="guide-tutorial-core-validators.html">核心验证器</a>章节查看完整的核心验证器列表。</li>
<li>模型类中的某个验证方法的名称，或者一个匿名方法。请参考<a href="#inline-validators">行内验证器</a>小节了解更多。</li>
<li>验证器类的名称。请参考<a href="#standalone-validators">独立验证器</a>小节了解更多。</li>
</ul>
<p>一个规则可用于验证一个或多个模型特性，且一个特性可以被一个或多个规则所验证。一个规则可以施用于特定<a href="guide-structure-models.html#scenarios">场景（scenario）</a>，只要指定 <code>on</code> 选项。如果你不指定 <code>on</code> 选项，那么该规则会适配于所有场景。</p>
<p>当调用 <code>validate()</code> 方法时，它将运行以下几个具体的验证步骤：</p>
<ol>
<li>检查从声明自 <a href="./yii-base-model.html#scenarios()-detail">yii\base\Model::scenarios()</a> 方法的场景中所挑选出的当前<a href="./yii-base-model.html#$scenario-detail">场景</a>的信息，从而确定出那些特性需要被验证。这些特性被称为激活特性。</li>
<li>检查从声明自 <a href="./yii-base-model.html#rules()-detail">yii\base\Model::rules()</a> 方法的众多规则中所挑选出的适用于当前<a href="./yii-base-model.html#$scenario-detail">场景</a>的规则，从而确定出需要验证哪些规则。这些规则被称为激活规则。</li>
<li>用每个激活规则去验证每个与之关联的激活特性。</li>
</ol>
<p>基于以上验证步骤，有且仅有声明在 <code>scenarios()</code> 方法里的激活特性，且它还必须与一或多个声明自 <code>rules()</code> 里的激活规则相关联才会被验证。</p>
<h3>自定义错误信息 <a name="customizing-error-messages"></a> <a href="#zi-ding-yi-cuo-wu-xin-xi" name="zi-ding-yi-cuo-wu-xin-xi" class="hashlink">&para;</a></h3>
<p>大多数的验证器都有默认的错误信息，当模型的某个特性验证失败的时候，该错误信息会被返回给模型。比如，用 <a href="./yii-validators-requiredvalidator.html">required</a> 验证器的规则检验 <code>username</code> 特性失败的话，会返还给模型 "Username cannot be blank." 信息。</p>
<p>你可以通过在声明规则的时候同时指定 <code>message</code> 属性，来定制某个规则的错误信息，比如这样：</p>
<pre><code class="language-php"><span style="color: #0000BB"></span><span style="color: #007700">public&nbsp;function&nbsp;</span><span style="color: #0000BB">rules</span><span style="color: #007700">()<br />{<br />&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;[<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[</span><span style="color: #DD0000">'username'</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">'required'</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">'message'&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #DD0000">'Please&nbsp;choose&nbsp;a&nbsp;username.'</span><span style="color: #007700">],<br />&nbsp;&nbsp;&nbsp;&nbsp;];<br />}</span></code></pre>
<p>一些验证器还支持用于针对不同原因的验证失败返回更加准确的额外错误信息。比如，<a href="./yii-validators-numbervalidator.html">number</a> 验证器就支持 <a href="./yii-validators-numbervalidator.html#$tooBig-detail">tooBig</a> 和 <a href="./yii-validators-numbervalidator.html#$tooSmall-detail">tooSmall</a> 两种错误消息用于分别返回输入值是太大还是太小。
你也可以像配置验证器的其他属性一样配置它们俩各自的错误信息。</p>
<h3>验证事件 <a name="validation-events"></a> <a href="#yan-zheng-shi-jian" name="yan-zheng-shi-jian" class="hashlink">&para;</a></h3>
<p>当调用 <a href="./yii-base-model.html#validate()-detail">yii\base\Model::validate()</a> 方法的过程里，它同时会调用两个特殊的方法，把它们重写掉可以实现自定义验证过程的目的：</p>
<ul>
<li><a href="./yii-base-model.html#beforeValidate()-detail">yii\base\Model::beforeValidate()</a>：在默认的实现中会触发 <a href="./yii-base-model.html#EVENT_BEFORE_VALIDATE-detail">yii\base\Model::EVENT_BEFORE_VALIDATE</a> 事件。你可以重写该方法或者响应此事件，来在验证开始之前，先进行一些预处理的工作。（比如，标准化数据输入）该方法应该返回一个布尔值，用于标明验证是否通过。</li>
<li><a href="./yii-base-model.html#afterValidate()-detail">yii\base\Model::afterValidate()</a>：在默认的实现中会触发 <a href="./yii-base-model.html#EVENT_AFTER_VALIDATE-detail">yii\base\Model::EVENT_AFTER_VALIDATE</a> 事件。你可以重写该方法或者响应此事件，来在验证结束之后，再进行一些收尾的工作。</li>
</ul>
<h3>条件式验证 <a name="conditional-validation"></a> <a href="#tiao-jian-shi-yan-zheng" name="tiao-jian-shi-yan-zheng" class="hashlink">&para;</a></h3>
<p>若要只在某些条件满足时，才验证相关特性，比如：是否验证某特性取决于另一特性的值，你可以通过
<a href="./yii-validators-validator.html#$when-detail">when</a> 属性来定义相关条件。举例而言，</p>
<pre><code class="language-php"><span style="color: #0000BB"></span><span style="color: #007700">[<br />&nbsp;&nbsp;&nbsp;&nbsp;[</span><span style="color: #DD0000">'state'</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">'required'</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">'when'&nbsp;</span><span style="color: #007700">=&gt;&nbsp;function(</span><span style="color: #0000BB">$model</span><span style="color: #007700">)&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;</span><span style="color: #0000BB">$model</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">country&nbsp;</span><span style="color: #007700">==&nbsp;</span><span style="color: #DD0000">'USA'</span><span style="color: #007700">;<br />&nbsp;&nbsp;&nbsp;&nbsp;}],<br />]</span></code></pre>
<p><a href="./yii-validators-validator.html#$when-detail">when</a> 属性会读入一个如下所示结构的 PHP callable 函数对象：</p>
<pre><code class="language-php"><span style="color: #0000BB"></span><span style="color: #FF8000">/**<br />&nbsp;*&nbsp;@param&nbsp;Model&nbsp;$model&nbsp;要验证的模型对象<br />&nbsp;*&nbsp;@param&nbsp;string&nbsp;$attribute&nbsp;待测特性名<br />&nbsp;*&nbsp;@return&nbsp;boolean&nbsp;返回是否启用该规则<br />&nbsp;*/<br /></span><span style="color: #007700">function&nbsp;(</span><span style="color: #0000BB">$model</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$attribute</span><span style="color: #007700">)</span></code></pre>
<p>若你需要支持客户端的条件验证，你应该配置
<a href="./yii-validators-validator.html#$whenClient-detail">whenClient</a> 属性，它会读入一条包含有 JavaScript 函数的字符串。这个函数将被用于确定该客户端验证规则是否被启用。比如，</p>
<pre><code class="language-php"><span style="color: #0000BB"></span><span style="color: #007700">[<br />&nbsp;&nbsp;&nbsp;&nbsp;[</span><span style="color: #DD0000">'state'</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">'required'</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">'when'&nbsp;</span><span style="color: #007700">=&gt;&nbsp;function&nbsp;(</span><span style="color: #0000BB">$model</span><span style="color: #007700">)&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;</span><span style="color: #0000BB">$model</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">country&nbsp;</span><span style="color: #007700">==&nbsp;</span><span style="color: #DD0000">'USA'</span><span style="color: #007700">;<br />&nbsp;&nbsp;&nbsp;&nbsp;},&nbsp;</span><span style="color: #DD0000">'whenClient'&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #DD0000">"function&nbsp;(attribute,&nbsp;value)&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;$('#country').value&nbsp;==&nbsp;'USA';<br />&nbsp;&nbsp;&nbsp;&nbsp;}"</span><span style="color: #007700">],<br />]</span></code></pre>
<h3>数据预处理 <a name="data-filtering"></a> <a href="#shu-ju-yu-chu-li" name="shu-ju-yu-chu-li" class="hashlink">&para;</a></h3>
<p>用户输入经常需要进行数据过滤，或者叫预处理。比如你可能会需要先去掉 <code>username</code> 输入的收尾空格。你可以通过使用验证规则来实现此目的。</p>
<p>下面的例子展示了如何去掉输入信息的首尾空格，并将空输入返回为 null。具体方法为通过调用 <a href="guide-tutorial-core-validators.html#trim">trim</a> 和 <a href="tutorial-core-validators.md#default">default</a> 核心验证器：</p>
<pre><code class="language-php"><span style="color: #0000BB"></span><span style="color: #007700">[<br />&nbsp;&nbsp;&nbsp;&nbsp;[[</span><span style="color: #DD0000">'username'</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">'email'</span><span style="color: #007700">],&nbsp;</span><span style="color: #DD0000">'trim'</span><span style="color: #007700">],<br />&nbsp;&nbsp;&nbsp;&nbsp;[[</span><span style="color: #DD0000">'username'</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">'email'</span><span style="color: #007700">],&nbsp;</span><span style="color: #DD0000">'default'</span><span style="color: #007700">],<br />]</span></code></pre>
<p>也还可以用更加通用的 <a href="guide-tutorial-core-validators.html#filter">filter（滤镜）</a> 核心验证器来执行更加复杂的数据过滤。</p>
<p>如你所见，这些验证规则并不真的对输入数据进行任何验证。而是，对输入数据进行一些处理，然后把它们存回当前被验证的模型特性。</p>
<h3>处理空输入 <a name="handling-empty-inputs"></a> <a href="#chu-li-kong-shu-ru" name="chu-li-kong-shu-ru" class="hashlink">&para;</a></h3>
<p>当输入数据是通过 HTML 表单，你经常会需要给空的输入项赋默认值。你可以通过调整
<a href="guide-tutorial-core-validators.html#default">default</a> 验证器来实现这一点。举例来说，</p>
<pre><code class="language-php"><span style="color: #0000BB"></span><span style="color: #007700">[<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">//&nbsp;若&nbsp;"username"&nbsp;和&nbsp;"email"&nbsp;为空，则设为&nbsp;null<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">[[</span><span style="color: #DD0000">'username'</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">'email'</span><span style="color: #007700">],&nbsp;</span><span style="color: #DD0000">'default'</span><span style="color: #007700">],<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">//&nbsp;若&nbsp;"level"&nbsp;为空，则设其为&nbsp;1<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">[</span><span style="color: #DD0000">'level'</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">'default'</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">'value'&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #0000BB">1</span><span style="color: #007700">],<br />]</span></code></pre>
<p>默认情况下，当输入项为空字符串，空数组，或 null 时，会被视为“空值”。你也可以通过配置
<a href="./yii-validators-validator.html#isEmpty()-detail">yii\validators\Validator::isEmpty()</a> 属性来自定义空值的判定规则。比如，</p>
<pre><code class="language-php"><span style="color: #0000BB"></span><span style="color: #007700">[<br />&nbsp;&nbsp;&nbsp;&nbsp;[</span><span style="color: #DD0000">'agree'</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">'required'</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">'isEmpty'&nbsp;</span><span style="color: #007700">=&gt;&nbsp;function&nbsp;(</span><span style="color: #0000BB">$value</span><span style="color: #007700">)&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;empty(</span><span style="color: #0000BB">$value</span><span style="color: #007700">);<br />&nbsp;&nbsp;&nbsp;&nbsp;}],<br />]</span></code></pre>
<blockquote><p>注意：对于绝大多数验证器而言，若其 <span style="background: #f00;">yii\base\Validator::skipOnEmpty</span> 属性为默认值
true，则它们不会对空值进行任何处理。也就是当他们的关联特性接收到空值时，相关验证会被直接略过。在
<a href="guide-tutorial-core-validators.html">核心验证器</a> 之中，只有 <code>captcha</code>（验证码），<code>default</code>（默认值），<code>filter</code>（滤镜），<code>required</code>（必填），以及 <code>trim</code>（去首尾空格），这几个验证器会处理空输入。</p>
</blockquote>
<h2>临时验证 <a name="ad-hoc-validation"></a> <a href="#lin-shi-yan-zheng" name="lin-shi-yan-zheng" class="hashlink">&para;</a></h2>
<p>有时，你需要对某些没有绑定任何模型类的值进行 <strong>临时验证</strong>。</p>
<p>若你只需要进行一种类型的验证 (e.g. 验证邮箱地址)，你可以调用所需验证器的
<a href="./yii-validators-validator.html#validate()-detail">validate()</a> 方法。像这样：</p>
<pre><code class="language-php"><span style="color: #0000BB">$email&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #DD0000">'test@example.com'</span><span style="color: #007700">;<br /></span><span style="color: #0000BB">$validator&nbsp;</span><span style="color: #007700">=&nbsp;new&nbsp;</span><span style="color: #0000BB">yii</span><span style="color: #007700">\</span><span style="color: #0000BB">validators</span><span style="color: #007700">\</span><span style="color: #0000BB">EmailValidator</span><span style="color: #007700">();<br /><br />if&nbsp;(</span><span style="color: #0000BB">$validator</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">validate</span><span style="color: #007700">(</span><span style="color: #0000BB">$email</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$error</span><span style="color: #007700">))&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;echo&nbsp;</span><span style="color: #DD0000">'有效的&nbsp;Email&nbsp;地址。'</span><span style="color: #007700">;<br />}&nbsp;else&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;echo&nbsp;</span><span style="color: #0000BB">$error</span><span style="color: #007700">;<br />}</span></code></pre>
<blockquote><p>注意：不是所有的验证器都支持这种形式的验证。比如 <a href="guide-tutorial-core-validators.html#unique">unique（唯一性）</a>核心验证器就就是一个例子，它的设计初衷就是只作用于模型类内部的。</p>
</blockquote>
<p>若你需要针对一系列值执行多项验证，你可以使用 <a href="./yii-base-dynamicmodel.html">yii\base\DynamicModel</a>
。它支持即时添加特性和验证规则的定义。它的使用规则是这样的：</p>
<pre><code class="language-php"><span style="color: #0000BB"></span><span style="color: #007700">public&nbsp;function&nbsp;</span><span style="color: #0000BB">actionSearch</span><span style="color: #007700">(</span><span style="color: #0000BB">$name</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$email</span><span style="color: #007700">)<br />{<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$model&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">DynamicModel</span><span style="color: #007700">::</span><span style="color: #0000BB">validateData</span><span style="color: #007700">(</span><span style="color: #0000BB">compact</span><span style="color: #007700">(</span><span style="color: #DD0000">'name'</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">'email'</span><span style="color: #007700">),&nbsp;[<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[[</span><span style="color: #DD0000">'name'</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">'email'</span><span style="color: #007700">],&nbsp;</span><span style="color: #DD0000">'string'</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">'max'&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #0000BB">128</span><span style="color: #007700">],<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[</span><span style="color: #DD0000">'email'</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">'email'</span><span style="color: #007700">],<br />&nbsp;&nbsp;&nbsp;&nbsp;]);<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(</span><span style="color: #0000BB">$model</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">hasErrors</span><span style="color: #007700">())&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">//&nbsp;验证失败<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">}&nbsp;else&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">//&nbsp;验证成功<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">}<br />}</span></code></pre>
<p><a href="./yii-base-dynamicmodel.html#validateData()-detail">yii\base\DynamicModel::validateData()</a> 方法会创建一个 <code>DynamicModel</code> 的实例对象，并通过给定数据定义模型特性（以 <code>name</code> 和 <code>email</code> 为例），之后用给定规则调用
<a href="./yii-base-model.html#validate()-detail">yii\base\Model::validate()</a> 方法。</p>
<p>除此之外呢，你也可以用如下的更加“传统”的语法来执行临时数据验证：</p>
<pre><code class="language-php"><span style="color: #0000BB"></span><span style="color: #007700">public&nbsp;function&nbsp;</span><span style="color: #0000BB">actionSearch</span><span style="color: #007700">(</span><span style="color: #0000BB">$name</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$email</span><span style="color: #007700">)<br />{<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$model&nbsp;</span><span style="color: #007700">=&nbsp;new&nbsp;</span><span style="color: #0000BB">DynamicModel</span><span style="color: #007700">(</span><span style="color: #0000BB">compact</span><span style="color: #007700">(</span><span style="color: #DD0000">'name'</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">'email'</span><span style="color: #007700">));<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$model</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">addRule</span><span style="color: #007700">([</span><span style="color: #DD0000">'name'</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">'email'</span><span style="color: #007700">],&nbsp;</span><span style="color: #DD0000">'string'</span><span style="color: #007700">,&nbsp;[</span><span style="color: #DD0000">'max'&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #0000BB">128</span><span style="color: #007700">])<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&gt;</span><span style="color: #0000BB">addRule</span><span style="color: #007700">(</span><span style="color: #DD0000">'email'</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">'email'</span><span style="color: #007700">)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&gt;</span><span style="color: #0000BB">validate</span><span style="color: #007700">();<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(</span><span style="color: #0000BB">$model</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">hasErrors</span><span style="color: #007700">())&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">//&nbsp;验证失败<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">}&nbsp;else&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">//&nbsp;验证成功<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">}<br />}</span></code></pre>
<p>验证之后你可以通过调用 <a href="./yii-base-model.html#hasErrors()-detail">hasErrors()</a>
方法来检查验证通过与否，并通过 <a href="./yii-base-dynamicmodel.html#$errors-detail">errors</a>
属性获得验证的错误信息，过程与普通模型类一致。你也可以访问模型对象内定义的动态特性，就像：
<code>$model-&gt;name</code> 和 <code>$model-&gt;email</code>。</p>
<h2>创建验证器（Validators） <a name="creating-validators"></a> <a href="#chuang-jian-yan-zheng-qi-validators" name="chuang-jian-yan-zheng-qi-validators" class="hashlink">&para;</a></h2>
<p>除了使用 Yii 的发布版里所包含的<a href="guide-tutorial-core-validators.html">核心验证器</a>之外，你也可以创建你自己的验证器。自定义的验证器可以是<strong>行内验证器</strong>，也可以是<strong>独立验证器</strong>。</p>
<h3>行内验证器（Inline Validators） <a name="inline-validators"></a> <a href="#xing-nei-yan-zheng-qi-inline-validators" name="xing-nei-yan-zheng-qi-inline-validators" class="hashlink">&para;</a></h3>
<p>行内验证器是一种以模型方法或匿名函数的形式定义的验证器。这些方法/函数的结构如下：</p>
<pre><code class="language-php"><span style="color: #0000BB"></span><span style="color: #FF8000">/**<br />&nbsp;*&nbsp;@param&nbsp;string&nbsp;$attribute&nbsp;当前被验证的特性<br />&nbsp;*&nbsp;@param&nbsp;array&nbsp;$params&nbsp;以名-值对形式提供的额外参数<br />&nbsp;*/<br /></span><span style="color: #007700">function&nbsp;(</span><span style="color: #0000BB">$attribute</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$params</span><span style="color: #007700">)</span></code></pre>
<p>若某特性的验证失败了，该方法/函数应该调用 <a href="./yii-base-model.html#addError()-detail">yii\base\Model::addError()</a> 保存错误信息到模型内。这样这些错误就能在之后的操作中，被读取并展现给终端用户。</p>
<p>下面是一些例子：</p>
<pre><code class="language-php"><span style="color: #0000BB"></span><span style="color: #007700">use&nbsp;</span><span style="color: #0000BB">yii</span><span style="color: #007700">\</span><span style="color: #0000BB">base</span><span style="color: #007700">\</span><span style="color: #0000BB">Model</span><span style="color: #007700">;<br /><br />class&nbsp;</span><span style="color: #0000BB">MyForm&nbsp;</span><span style="color: #007700">extends&nbsp;</span><span style="color: #0000BB">Model<br /></span><span style="color: #007700">{<br />&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;</span><span style="color: #0000BB">$country</span><span style="color: #007700">;<br />&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;</span><span style="color: #0000BB">$token</span><span style="color: #007700">;<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;function&nbsp;</span><span style="color: #0000BB">rules</span><span style="color: #007700">()<br />&nbsp;&nbsp;&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;[<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">//&nbsp;以模型方法&nbsp;validateCountry()&nbsp;形式定义的行内验证器<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">[</span><span style="color: #DD0000">'country'</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">'validateCountry'</span><span style="color: #007700">],<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">//&nbsp;以匿名函数形式定义的行内验证器<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">[</span><span style="color: #DD0000">'token'</span><span style="color: #007700">,&nbsp;function&nbsp;(</span><span style="color: #0000BB">$attribute</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$params</span><span style="color: #007700">)&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(!</span><span style="color: #0000BB">ctype_alnum</span><span style="color: #007700">(</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">$attribute</span><span style="color: #007700">))&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">addError</span><span style="color: #007700">(</span><span style="color: #0000BB">$attribute</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">'令牌本身必须包含字母或数字。'</span><span style="color: #007700">);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}],<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;];<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;function&nbsp;</span><span style="color: #0000BB">validateCountry</span><span style="color: #007700">(</span><span style="color: #0000BB">$attribute</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$params</span><span style="color: #007700">)<br />&nbsp;&nbsp;&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(!</span><span style="color: #0000BB">in_array</span><span style="color: #007700">(</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">$attribute</span><span style="color: #007700">,&nbsp;[</span><span style="color: #DD0000">'兲朝'</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">'墙外'</span><span style="color: #007700">]))&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">addError</span><span style="color: #007700">(</span><span style="color: #0000BB">$attribute</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">'国家必须为&nbsp;"兲朝"&nbsp;或&nbsp;"墙外"&nbsp;中的一个。'</span><span style="color: #007700">);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br />}</span></code></pre>
<blockquote><p>注意：缺省状态下，行内验证器不会在关联特性的输入值为空或该特性已经在其他验证中失败的情况下起效。若你想要确保该验证器始终启用的话，你可以在定义规则时，酌情将 <a href="./yii-validators-validator.html#$skipOnEmpty-detail">skipOnEmpty</a> 以及 <a href="./yii-validators-validator.html#$skipOnError-detail">skipOnError</a>
  属性设为 false，比如，
<code>`</code>php
[</p>
<pre><code>['country', 'validateCountry', 'skipOnEmpty' =&gt; false, 'skipOnError' =&gt; false],
</code></pre>
<p>]
<code>`</code></p>
</blockquote>
<h3>独立验证器（Standalone Validators） <a name="standalone-validators"></a> <a href="#du-li-yan-zheng-qi-standalone-validators" name="du-li-yan-zheng-qi-standalone-validators" class="hashlink">&para;</a></h3>
<p>独立验证器是继承自 <a href="./yii-validators-validator.html">yii\validators\Validator</a> 或其子类的类。你可以通过重写
<a href="./yii-validators-validator.html#validateAttribute()-detail">yii\validators\Validator::validateAttribute()</a> 来实现它的验证规则。若特性验证失败，可以调用
<a href="./yii-base-model.html#addError()-detail">yii\base\Model::addError()</a> 以保存错误信息到模型内，操作与 <a href="#inline-validators">inline validators</a> 所需操作完全一样。比如，</p>
<pre><code class="language-php"><span style="color: #0000BB"></span><span style="color: #007700">namespace&nbsp;</span><span style="color: #0000BB">app</span><span style="color: #007700">\</span><span style="color: #0000BB">components</span><span style="color: #007700">;<br /><br />use&nbsp;</span><span style="color: #0000BB">yii</span><span style="color: #007700">\</span><span style="color: #0000BB">validators</span><span style="color: #007700">\</span><span style="color: #0000BB">Validator</span><span style="color: #007700">;<br /><br />class&nbsp;</span><span style="color: #0000BB">CountryValidator&nbsp;</span><span style="color: #007700">extends&nbsp;</span><span style="color: #0000BB">Validator<br /></span><span style="color: #007700">{<br />&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;function&nbsp;</span><span style="color: #0000BB">validateAttribute</span><span style="color: #007700">(</span><span style="color: #0000BB">$model</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$attribute</span><span style="color: #007700">)<br />&nbsp;&nbsp;&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(!</span><span style="color: #0000BB">in_array</span><span style="color: #007700">(</span><span style="color: #0000BB">$model</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">$attribute</span><span style="color: #007700">,&nbsp;[</span><span style="color: #DD0000">'兲朝'</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">'墙外'</span><span style="color: #007700">]))&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">addError</span><span style="color: #007700">(</span><span style="color: #0000BB">$attribute</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">'国家必须为&nbsp;"兲朝"&nbsp;或&nbsp;"墙外"&nbsp;中的一个。'</span><span style="color: #007700">);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br />}</span></code></pre>
<p>若你想要验证器支持不使用 model 的数据验证，你还应该重写
<a href="./yii-validators-validator.html#validate()-detail">yii\validators\Validator::validate()</a> 方法。你也可以通过重写
<a href="./yii-validators-validator.html#validateValue()-detail">yii\validators\Validator::validateValue()</a> 方法替代
<code>validateAttribute()</code> 和 <code>validate()</code>，因为默认状态下，后两者的实现使用过调用
<code>validateValue()</code>实现的。</p>
<h2>客户端验证器（Client-Side Validation） <a name="client-side-validation"></a> <a href="#ke-hu-duan-yan-zheng-qi-client-side-validation" name="ke-hu-duan-yan-zheng-qi-client-side-validation" class="hashlink">&para;</a></h2>
<p>当终端用户通过 HTML 表单提供相关输入信息时，我们可能会需要用到基于 JavaScript 的客户端验证。因为，它可以让用户更快速的得到错误信息，也因此可以提供更好的用户体验。你可以使用或自己实现除服务器端验证之外，<strong>还能额外</strong>客户端验证功能的验证器。</p>
<blockquote><p>补充：尽管客户端验证为加分项，但它不是必须项。它存在的主要意义在于给用户提供更好的客户体验。正如“永远不要相信来自终端用户的输入信息”，也同样永远不要相信客户端验证。基于这个理由，你应该始终如前文所描述的那样，通过调用 <a href="./yii-base-model.html#validate()-detail">yii\base\Model::validate()</a> 方法执行服务器端验证。</p>
</blockquote>
<h3>使用客户端验证 <a name="using-client-side-validation"></a> <a href="#shi-yong-ke-hu-duan-yan-zheng" name="shi-yong-ke-hu-duan-yan-zheng" class="hashlink">&para;</a></h3>
<p>许多<a href="guide-tutorial-core-validators.html">核心验证器</a>都支持开箱即用的客户端验证。你只需要用 <a href="./yii-widgets-activeform.html">yii\widgets\ActiveForm</a> 的方式构建 HTML 表单即可。比如，下面的 <code>LoginForm</code>（登录表单）声明了两个规则：其一为 <a href="guide-tutorial-core-validators.html#required">required</a> 核心验证器，它同时支持客户端与服务器端的验证；另一个则采用 <code>validatePassword</code> 行内验证器，它只支持服务器端。</p>
<pre><code class="language-php"><span style="color: #0000BB"></span><span style="color: #007700">namespace&nbsp;</span><span style="color: #0000BB">app</span><span style="color: #007700">\</span><span style="color: #0000BB">models</span><span style="color: #007700">;<br /><br />use&nbsp;</span><span style="color: #0000BB">yii</span><span style="color: #007700">\</span><span style="color: #0000BB">base</span><span style="color: #007700">\</span><span style="color: #0000BB">Model</span><span style="color: #007700">;<br />use&nbsp;</span><span style="color: #0000BB">app</span><span style="color: #007700">\</span><span style="color: #0000BB">models</span><span style="color: #007700">\</span><span style="color: #0000BB">User</span><span style="color: #007700">;<br /><br />class&nbsp;</span><span style="color: #0000BB">LoginForm&nbsp;</span><span style="color: #007700">extends&nbsp;</span><span style="color: #0000BB">Model<br /></span><span style="color: #007700">{<br />&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;</span><span style="color: #0000BB">$username</span><span style="color: #007700">;<br />&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;</span><span style="color: #0000BB">$password</span><span style="color: #007700">;<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;function&nbsp;</span><span style="color: #0000BB">rules</span><span style="color: #007700">()<br />&nbsp;&nbsp;&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;[<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">//&nbsp;username&nbsp;和&nbsp;password&nbsp;都是必填项<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">[[</span><span style="color: #DD0000">'username'</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">'password'</span><span style="color: #007700">],&nbsp;</span><span style="color: #DD0000">'required'</span><span style="color: #007700">],<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">//&nbsp;用&nbsp;validatePassword()&nbsp;验证&nbsp;password<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">[</span><span style="color: #DD0000">'password'</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">'validatePassword'</span><span style="color: #007700">],<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;];<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;function&nbsp;</span><span style="color: #0000BB">validatePassword</span><span style="color: #007700">()<br />&nbsp;&nbsp;&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$user&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">User</span><span style="color: #007700">::</span><span style="color: #0000BB">findByUsername</span><span style="color: #007700">(</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">username</span><span style="color: #007700">);<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(!</span><span style="color: #0000BB">$user&nbsp;</span><span style="color: #007700">||&nbsp;!</span><span style="color: #0000BB">$user</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">validatePassword</span><span style="color: #007700">(</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">password</span><span style="color: #007700">))&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">addError</span><span style="color: #007700">(</span><span style="color: #DD0000">'password'</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">'Incorrect&nbsp;username&nbsp;or&nbsp;password.'</span><span style="color: #007700">);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br />}</span></code></pre>
<p>使用如下代码构建的 HTML 表单包含两个输入框 <code>username</code> 以及 <code>password</code>。如果你在没有输入任何东西之前提交表单，就会在没有任何与服务器端的通讯的情况下，立刻收到一个要求你填写空白项的错误信息。</p>
<pre><code class="language-php"><span style="color: #0000BB">&lt;?php&nbsp;$form&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">yii</span><span style="color: #007700">\</span><span style="color: #0000BB">widgets</span><span style="color: #007700">\</span><span style="color: #0000BB">ActiveForm</span><span style="color: #007700">::</span><span style="color: #0000BB">begin</span><span style="color: #007700">();&nbsp;</span><span style="color: #0000BB">?&gt;<br /></span>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #0000BB">&lt;?=&nbsp;$form</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">field</span><span style="color: #007700">(</span><span style="color: #0000BB">$model</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">'username'</span><span style="color: #007700">)&nbsp;</span><span style="color: #0000BB">?&gt;<br /></span>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #0000BB">&lt;?=&nbsp;$form</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">field</span><span style="color: #007700">(</span><span style="color: #0000BB">$model</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">'password'</span><span style="color: #007700">)-&gt;</span><span style="color: #0000BB">passwordInput</span><span style="color: #007700">()&nbsp;</span><span style="color: #0000BB">?&gt;<br /></span>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #0000BB">&lt;?=&nbsp;Html</span><span style="color: #007700">::</span><span style="color: #0000BB">submitButton</span><span style="color: #007700">(</span><span style="color: #DD0000">'Login'</span><span style="color: #007700">)&nbsp;</span><span style="color: #0000BB">?&gt;<br />&lt;?php&nbsp;yii</span><span style="color: #007700">\</span><span style="color: #0000BB">widgets</span><span style="color: #007700">\</span><span style="color: #0000BB">ActiveForm</span><span style="color: #007700">::</span><span style="color: #0000BB">end</span><span style="color: #007700">();&nbsp;</span><span style="color: #0000BB">?&gt;</span></code></pre>
<p>幕后的运作过程是这样的：<a href="./yii-widgets-activeform.html">yii\widgets\ActiveForm</a> 会读取声明在模型类中的验证规则，并生成那些支持支持客户端验证的验证器所需的 JavaScript 代码。当用户修改输入框的值，或者提交表单时，就会触发相应的客户端验证 JS 代码。</p>
<p>若你需要完全关闭客户端验证，你只需配置 <a href="./yii-widgets-activeform.html#$enableClientValidation-detail">yii\widgets\ActiveForm::$enableClientValidation</a> 属性为 false。你同样可以关闭各个输入框各自的客户端验证，只要把它们的 <a href="./yii-widgets-activefield.html#$enableClientValidation-detail">yii\widgets\ActiveField::$enableClientValidation</a> 属性设为 false。</p>
<h3>自己实现客户端验证 <a name="implementing-client-side-validation"></a> <a href="#zi-ji-shi-xian-ke-hu-duan-yan-zheng" name="zi-ji-shi-xian-ke-hu-duan-yan-zheng" class="hashlink">&para;</a></h3>
<p>要穿件一个支持客户端验证的验证器，你需要实现
<a href="./yii-validators-validator.html#clientValidateAttribute()-detail">yii\validators\Validator::clientValidateAttribute()</a> 方法，用于返回一段用于运行客户端验证的 JavaScript 代码。在这段 JavaScript 代码中，你可以使用以下预定义的变量：</p>
<ul>
<li><code>attribute</code>：正在被验证的模型特性的名称。</li>
<li><code>value</code>：进行验证的值。</li>
<li><code>messages</code>：一个用于暂存模型特性的报错信息的数组。</li>
</ul>
<p>在下面的例子里，我们会创建一个 <code>StatusValidator</code>，它会通过比对现有的状态数据，验证输入值是否为一个有效的状态。该验证器同时支持客户端以及服务器端验证。</p>
<pre><code class="language-php"><span style="color: #0000BB"></span><span style="color: #007700">namespace&nbsp;</span><span style="color: #0000BB">app</span><span style="color: #007700">\</span><span style="color: #0000BB">components</span><span style="color: #007700">;<br /><br />use&nbsp;</span><span style="color: #0000BB">yii</span><span style="color: #007700">\</span><span style="color: #0000BB">validators</span><span style="color: #007700">\</span><span style="color: #0000BB">Validator</span><span style="color: #007700">;<br />use&nbsp;</span><span style="color: #0000BB">app</span><span style="color: #007700">\</span><span style="color: #0000BB">models</span><span style="color: #007700">\</span><span style="color: #0000BB">Status</span><span style="color: #007700">;<br /><br />class&nbsp;</span><span style="color: #0000BB">StatusValidator&nbsp;</span><span style="color: #007700">extends&nbsp;</span><span style="color: #0000BB">Validator<br /></span><span style="color: #007700">{<br />&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;function&nbsp;</span><span style="color: #0000BB">init</span><span style="color: #007700">()<br />&nbsp;&nbsp;&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">parent</span><span style="color: #007700">::</span><span style="color: #0000BB">init</span><span style="color: #007700">();<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">message&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #DD0000">'无效的状态输入。'</span><span style="color: #007700">;<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;function&nbsp;</span><span style="color: #0000BB">validateAttribute</span><span style="color: #007700">(</span><span style="color: #0000BB">$model</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$attribute</span><span style="color: #007700">)<br />&nbsp;&nbsp;&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$value&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$model</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">$attribute</span><span style="color: #007700">;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(!</span><span style="color: #0000BB">Status</span><span style="color: #007700">::</span><span style="color: #0000BB">find</span><span style="color: #007700">()-&gt;</span><span style="color: #0000BB">where</span><span style="color: #007700">([</span><span style="color: #DD0000">'id'&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #0000BB">$value</span><span style="color: #007700">])-&gt;</span><span style="color: #0000BB">exists</span><span style="color: #007700">())&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$model</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">addError</span><span style="color: #007700">(</span><span style="color: #0000BB">$attribute</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">message</span><span style="color: #007700">);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;function&nbsp;</span><span style="color: #0000BB">clientValidateAttribute</span><span style="color: #007700">(</span><span style="color: #0000BB">$model</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$attribute</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$view</span><span style="color: #007700">)<br />&nbsp;&nbsp;&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$statuses&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">json_encode</span><span style="color: #007700">(</span><span style="color: #0000BB">Status</span><span style="color: #007700">::</span><span style="color: #0000BB">find</span><span style="color: #007700">()-&gt;</span><span style="color: #0000BB">select</span><span style="color: #007700">(</span><span style="color: #DD0000">'id'</span><span style="color: #007700">)-&gt;</span><span style="color: #0000BB">asArray</span><span style="color: #007700">()-&gt;</span><span style="color: #0000BB">column</span><span style="color: #007700">());<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$message&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">json_encode</span><span style="color: #007700">(</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">message</span><span style="color: #007700">);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;&lt;&lt;&lt;JS<br /></span><span style="color: #DD0000">if&nbsp;(!$.inArray(value,&nbsp;</span><span style="color: #0000BB">$statuses</span><span style="color: #DD0000">))&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;messages.push(</span><span style="color: #0000BB">$message</span><span style="color: #DD0000">);<br />}<br /></span><span style="color: #007700">JS;<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br />}</span></code></pre>
<blockquote><p>技巧：上述代码主要是演示了如何支持客户端验证。在具体实践中，你可以使用 <a href="guide-tutorial-core-validators.html#in">in</a> 核心验证器来达到同样的目的。比如这样的验证规则：
<code>`</code>php
[</p>
<pre><code>['status', 'in', 'range' =&gt; Status::find()-&gt;select('id')-&gt;asArray()-&gt;column()],
</code></pre>
<p>]
<code>`</code></p>
</blockquote>
        <div class="toplink"><a href="#" class="h1" title="go to top"><span class="glyphicon glyphicon-arrow-up"></a></div>
    </div>
</div>


</div>

<footer class="footer">
        <p class="pull-right"><small>Page generated on Tue, 16 Sep 2014 19:18:23 +0200</small></p>
    Powered by <a href="http://www.yiiframework.com/" rel="external">Yii Framework</a></footer>

<script type="text/javascript">jQuery(document).ready(function () {
    var shiftWindow = function () { scrollBy(0, -50) };
    if (location.hash) shiftWindow();
    window.addEventListener("hashchange", shiftWindow);
var element = document.createElement("script");
element.src = "./jssearch.index.js";
document.body.appendChild(element);

var searchBox = $('#searchbox');

// focus the search field
searchBox.focus();

// search when typing in search field
searchBox.on("keyup", function(event) {
    var query = $(this).val();

    if (query == '' || event.which == 27) {
        $('#search-resultbox').hide();
        return;
    } else if (event.which == 13) {
        var selectedLink = $('#search-resultbox a.selected');
        if (selectedLink.length != 0) {
            document.location = selectedLink.attr('href');
            return;
        }
    } else if (event.which == 38 || event.which == 40) {
        $('#search-resultbox').show();

        var selected = $('#search-resultbox a.selected');
        if (selected.length == 0) {
            $('#search-results').find('a').first().addClass('selected');
        } else {
            var next;
            if (event.which == 40) {
                next = selected.parent().next().find('a').first();
            } else {
                next = selected.parent().prev().find('a').first();
            }
            if (next.length != 0) {
                var resultbox = $('#search-results');
                var position = next.position();

//              TODO scrolling is buggy and jumps around
//                resultbox.scrollTop(Math.floor(position.top));
//                console.log(position.top);

                selected.removeClass('selected');
                next.addClass('selected');
            }
        }

        return;
    }
    $('#search-resultbox').show();
    $('#search-results').html('<li><span class="no-results">No results</span></li>');

    var result = jssearch.search(query);

    if (result.length > 0) {
        var i = 0;
        var resHtml = '';

        for (var key in result) {
            if (i++ > 20) {
                break;
            }
            resHtml = resHtml +
            '<li><a href="' + result[key].file.u.substr(3) +'"><span class="title">' + result[key].file.t + '</span>' +
            '<span class="description">' + result[key].file.d + '</span></a></li>';
        }
        $('#search-results').html(resHtml);
    }
});

// hide the search results on ESC
$(document).on("keyup", function(event) { if (event.which == 27) { $('#search-resultbox').hide(); } });
// hide search results on click to document
$(document).bind('click', function (e) { $('#search-resultbox').hide(); });
// except the following:
searchBox.bind('click', function(e) { e.stopPropagation(); });
$('#search-resultbox').bind('click', function(e) { e.stopPropagation(); });

});</script></body>
</html>
