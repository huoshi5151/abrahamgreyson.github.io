<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="language" content="en" />
        <link href="./assets/41d5631d/css/bootstrap.css" rel="stylesheet">
<link href="./assets/bad56eea/style.css" rel="stylesheet">
<script src="./assets/e17319cf/jquery.js"></script>
<script src="./assets/41d5631d/js/bootstrap.js"></script>
<script src="./assets/b52a7f0/jssearch.js"></script>    <title>Yii Framework 2.0 API Documentation</title>
</head>
<body>

<div class="wrap">
    <nav id="w416" class="navbar-inverse navbar-fixed-top navbar" role="navigation"><div class="navbar-header"><button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#w416-collapse"><span class="sr-only">Toggle navigation</span>
<span class="icon-bar"></span>
<span class="icon-bar"></span>
<span class="icon-bar"></span></button><a class="navbar-brand" href="./index.html">Yii 2.0 API 文档</a></div><div id="w416-collapse" class="collapse navbar-collapse"><ul id="w417" class="navbar-nav nav"><li><a href="./index.html">类参考</a></li>
<li class="dropdown"><a class="dropdown-toggle" href="#" data-toggle="dropdown">扩展 <b class="caret"></b></a><ul id="w418" class="dropdown-menu"><li><a href="./ext-apidoc-index.html" tabindex="-1">apidoc</a></li>
<li><a href="./ext-authclient-index.html" tabindex="-1">authclient</a></li>
<li><a href="./ext-bootstrap-index.html" tabindex="-1">bootstrap</a></li>
<li><a href="./ext-codeception-index.html" tabindex="-1">codeception</a></li>
<li><a href="./ext-composer-index.html" tabindex="-1">composer</a></li>
<li><a href="./ext-debug-index.html" tabindex="-1">debug</a></li>
<li><a href="./ext-elasticsearch-index.html" tabindex="-1">elasticsearch</a></li>
<li><a href="./ext-faker-index.html" tabindex="-1">faker</a></li>
<li><a href="./ext-gii-index.html" tabindex="-1">gii</a></li>
<li><a href="./ext-imagine-index.html" tabindex="-1">imagine</a></li>
<li><a href="./ext-jui-index.html" tabindex="-1">jui</a></li>
<li><a href="./ext-mongodb-index.html" tabindex="-1">mongodb</a></li>
<li><a href="./ext-redis-index.html" tabindex="-1">redis</a></li>
<li><a href="./ext-smarty-index.html" tabindex="-1">smarty</a></li>
<li><a href="./ext-sphinx-index.html" tabindex="-1">sphinx</a></li>
<li><a href="./ext-swiftmailer-index.html" tabindex="-1">swiftmailer</a></li>
<li><a href="./ext-twig-index.html" tabindex="-1">twig</a></li></ul></li>
<li><a href="./guide-README.html">权威指南</a></li>
<li class="dropdown"><a class="dropdown-toggle" href="#" data-toggle="dropdown">Github <b class="caret"></b></a><ul id="w419" class="dropdown-menu"><li><a href="https://github.com/yiisoft/yii2" tabindex="-1">Yii 2.0</a></li>
<li><a href="https://github.com/yii2-chinesization/yii2-zh-cn" tabindex="-1">Yii 2.0 中文化项目</a></li>
<li><a href="https://github.com/AbrahamGreyson/abrahamgreyson.github.io" tabindex="-1">docwithcn.com</a></li>
<li><a href="https://github.com/AbrahamGreyson/abrahamgreyson.github.io/download/guide.pdf" tabindex="-1">下载 PDF</a></li></ul></li></ul><div class="navbar-form navbar-left" role="search">
  <div class="form-group">
    <input id="searchbox" type="text" class="form-control" placeholder="Search">
  </div>
</div>
</div></nav>
    <div id="search-resultbox" style="display: none;" class="modal-content">
        <ul id="search-results">
        </ul>
    </div>

    
<div class="row">
    <div class="col-md-2">
                <div id="navigation" class="list-group"><a class="list-group-item" href="#navigation-399" data-toggle="collapse" data-parent="#navigation">介绍 <b class="caret"></b></a><div id="navigation-399" class="submenu panel-collapse collapse"><a class="list-group-item" href="./guide-intro-yii.html">关于 Yii</a>
<a class="list-group-item" href="./guide-intro-upgrade-from-v1.html">从 Yii 1.1 升级</a></div>
<a class="list-group-item" href="#navigation-400" data-toggle="collapse" data-parent="#navigation">入门 <b class="caret"></b></a><div id="navigation-400" class="submenu panel-collapse collapse"><a class="list-group-item" href="./guide-start-installation.html">安装 Yii</a>
<a class="list-group-item" href="./guide-start-workflow.html">运行应用</a>
<a class="list-group-item" href="./guide-start-hello.html">第一次问候</a>
<a class="list-group-item" href="./guide-start-forms.html">使用 Forms</a>
<a class="list-group-item" href="./guide-start-databases.html">玩转 Databases</a>
<a class="list-group-item" href="./guide-start-gii.html">用 Gii 生成代码</a>
<a class="list-group-item" href="./guide-start-looking-ahead.html">更上一层楼</a></div>
<a class="list-group-item" href="#navigation-401" data-toggle="collapse" data-parent="#navigation">应用结构 <b class="caret"></b></a><div id="navigation-401" class="submenu panel-collapse collapse"><a class="list-group-item" href="./guide-structure-overview.html">结构概述</a>
<a class="list-group-item" href="./guide-structure-entry-scripts.html">入口脚本</a>
<a class="list-group-item" href="./guide-structure-applications.html">应用</a>
<a class="list-group-item" href="./guide-structure-application-components.html">应用组件</a>
<a class="list-group-item" href="./guide-structure-controllers.html">控制器（Controller）</a>
<a class="list-group-item" href="./guide-structure-views.html">视图（View）</a>
<a class="list-group-item" href="./guide-structure-models.html">模型（Model）</a>
<a class="list-group-item" href="./guide-structure-filters.html">过滤器</a>
<a class="list-group-item" href="./guide-structure-widgets.html">小部件（Widget）</a>
<a class="list-group-item" href="./guide-structure-modules.html">模块（Module）</a>
<a class="list-group-item" href="./guide-structure-assets.html">前端资源（Asset）</a>
<a class="list-group-item" href="./guide-structure-extensions.html">扩展（extensions）</a></div>
<a class="list-group-item" href="#navigation-402" data-toggle="collapse" data-parent="#navigation">请求处理 <b class="caret"></b></a><div id="navigation-402" class="submenu panel-collapse collapse"><a class="list-group-item" href="./guide-runtime-overview.html">运行概述</a>
<a class="list-group-item" href="./guide-runtime-bootstrapping.html">引导（Bootstrapping）</a>
<a class="list-group-item" href="./guide-runtime-routing.html">路由（Routing）</a>
<a class="list-group-item" href="./guide-runtime-requests.html">请求（Request）</a>
<a class="list-group-item" href="./guide-runtime-responses.html">响应（Response）</a>
<a class="list-group-item" href="./guide-runtime-sessions-cookies.html">Sessions（会话）和 Cookies</a>
<a class="list-group-item" href="./guide-runtime-url-handling.html">URL 解析和生成</a>
<a class="list-group-item" href="./guide-runtime-handling-errors.html">错误处理</a>
<a class="list-group-item" href="./guide-runtime-logging.html">日志</a></div>
<a class="list-group-item" href="#navigation-403" data-toggle="collapse" data-parent="#navigation">关键概念 <b class="caret"></b></a><div id="navigation-403" class="submenu panel-collapse collapse"><a class="list-group-item" href="./guide-concept-components.html">组件（Component）</a>
<a class="list-group-item" href="./guide-concept-properties.html">属性（Property）</a>
<a class="list-group-item" href="./guide-concept-events.html">事件（Event）</a>
<a class="list-group-item" href="./guide-concept-behaviors.html">行为（Behavior）</a>
<a class="list-group-item" href="./guide-concept-configurations.html">配置（Configurations）</a>
<a class="list-group-item" href="./guide-concept-autoloading.html">类自动加载（Autoloading）</a>
<a class="list-group-item" href="./guide-concept-alias.html">别名（Alias）</a>
<a class="list-group-item" href="./guide-concept-service-locator.html">服务定位器（Service Locator）</a>
<a class="list-group-item" href="./guide-concept-di-container.html">依赖注入容器（DI Container）</a></div>
<a class="list-group-item active" href="#navigation-404" data-toggle="collapse" data-parent="#navigation">配合数据库工作 <b class="caret"></b></a><div id="navigation-404" class="submenu panel-collapse collapse in"><a class="list-group-item" href="./guide-db-dao.html">数据访问对象（DAO）</a>
<a class="list-group-item active" href="./guide-db-query-builder.html">查询生成器（Query Builder）</a>
<a class="list-group-item" href="./guide-db-active-record.html">活动记录（Active Record）</a>
<a class="list-group-item" href="./guide-db-migrations.html">数据库迁移（Migration）</a>
<a class="list-group-item" href="./guide-db-sphinx.html">Sphinx</a>
<a class="list-group-item" href="./guide-db-redis.html">Redis</a>
<a class="list-group-item" href="./guide-db-mongodb.html">MongoDB</a>
<a class="list-group-item" href="./guide-db-elastic-search.html">ElasticSearch</a></div>
<a class="list-group-item" href="#navigation-405" data-toggle="collapse" data-parent="#navigation">接收用户数据 <b class="caret"></b></a><div id="navigation-405" class="submenu panel-collapse collapse"><a class="list-group-item" href="./guide-input-forms.html">创建表单</a>
<a class="list-group-item" href="./guide-input-validation.html">输入验证</a>
<a class="list-group-item" href="./guide-input-file-uploading.html">文件上传</a>
<a class="list-group-item" href="./guide-input-multiple-models.html">多模型同时输入</a></div>
<a class="list-group-item" href="#navigation-406" data-toggle="collapse" data-parent="#navigation">显示数据 <b class="caret"></b></a><div id="navigation-406" class="submenu panel-collapse collapse"><a class="list-group-item" href="./guide-output-formatter.html">格式化输出数据</a>
<a class="list-group-item" href="./guide-output-pagination.html">分页（Pagination）</a>
<a class="list-group-item" href="./guide-output-sorting.html">排序（Sorting）</a>
<a class="list-group-item" href="./guide-output-data-providers.html">数据提供器</a>
<a class="list-group-item" href="./guide-output-data-widgets.html">数据小部件</a>
<a class="list-group-item" href="./guide-output-theming.html">主题</a></div>
<a class="list-group-item" href="#navigation-407" data-toggle="collapse" data-parent="#navigation">安全 <b class="caret"></b></a><div id="navigation-407" class="submenu panel-collapse collapse"><a class="list-group-item" href="./guide-security-authentication.html">认证（Authentication）</a>
<a class="list-group-item" href="./guide-security-authorization.html">授权（Authorization）</a>
<a class="list-group-item" href="./guide-security-passwords.html">处理密码</a>
<a class="list-group-item" href="./guide-security-auth-clients.html">客户端认证</a>
<a class="list-group-item" href="./guide-security-best-practices.html">安全领域的最佳实践</a></div>
<a class="list-group-item" href="#navigation-408" data-toggle="collapse" data-parent="#navigation">缓存 <b class="caret"></b></a><div id="navigation-408" class="submenu panel-collapse collapse"><a class="list-group-item" href="./guide-caching-overview.html">概述</a>
<a class="list-group-item" href="./guide-caching-data.html">数据缓存</a>
<a class="list-group-item" href="./guide-caching-fragment.html">片段缓存</a>
<a class="list-group-item" href="./guide-caching-page.html">分页缓存</a>
<a class="list-group-item" href="./guide-caching-http.html">HTTP 缓存</a></div>
<a class="list-group-item" href="#navigation-409" data-toggle="collapse" data-parent="#navigation">RESTful Web 服务 <b class="caret"></b></a><div id="navigation-409" class="submenu panel-collapse collapse"><a class="list-group-item" href="./guide-rest-quick-start.html">快速入门</a>
<a class="list-group-item" href="./guide-rest-resources.html">资源</a>
<a class="list-group-item" href="./guide-rest-routing.html">路由</a>
<a class="list-group-item" href="./guide-rest-response-formatting.html">格式化响应</a>
<a class="list-group-item" href="./guide-rest-authentication.html">授权验证</a>
<a class="list-group-item" href="./guide-rest-rate-limiting.html">速率限制</a>
<a class="list-group-item" href="./guide-rest-versioning.html">版本化</a>
<a class="list-group-item" href="./guide-rest-error-handling.html">错误处理</a>
<a class="list-group-item" href="./guide-rest-testing.html">测试</a></div>
<a class="list-group-item" href="#navigation-410" data-toggle="collapse" data-parent="#navigation">开发工具 <b class="caret"></b></a><div id="navigation-410" class="submenu panel-collapse collapse"><a class="list-group-item" href="./guide-tool-debugger.html">调试工具栏和调试器</a>
<a class="list-group-item" href="./guide-tool-gii.html">使用 Gii 生成代码</a>
<a class="list-group-item" href="./guide-tool-api-doc.html">生成 API 文档</a></div>
<a class="list-group-item" href="#navigation-411" data-toggle="collapse" data-parent="#navigation">测试 <b class="caret"></b></a><div id="navigation-411" class="submenu panel-collapse collapse"><a class="list-group-item" href="./guide-test-overview.html">概述</a>
<a class="list-group-item" href="./guide-test-endvironment-setup.html">搭建测试环境</a>
<a class="list-group-item" href="./guide-test-unit.html">单元测试</a>
<a class="list-group-item" href="./guide-test-functional.html">功能测试</a>
<a class="list-group-item" href="./guide-test-acceptance.html">验收测试</a>
<a class="list-group-item" href="./guide-test-fixtures.html">测试夹具</a></div>
<a class="list-group-item" href="#navigation-412" data-toggle="collapse" data-parent="#navigation">高级专题 <b class="caret"></b></a><div id="navigation-412" class="submenu panel-collapse collapse"><a class="list-group-item" href="./guide-tutorial-advanced-app.html">高级应用模版</a>
<a class="list-group-item" href="./guide-tutorial-start-from-scratch.html">从头构建自定义模版</a>
<a class="list-group-item" href="./guide-tutorial-console.html">控制台命令</a>
<a class="list-group-item" href="./guide-tutorial-core-validators.html">核心验证器</a>
<a class="list-group-item" href="./guide-tutorial-i18n.html">国际化</a>
<a class="list-group-item" href="./guide-tutorial-mailing.html">收发邮件</a>
<a class="list-group-item" href="./guide-tutorial-performance-tuning.html">性能优化</a>
<a class="list-group-item" href="./guide-tutorial-shared-hosting.html">共享主机环境</a>
<a class="list-group-item" href="./guide-tutorial-template-engines.html">模板引擎</a>
<a class="list-group-item" href="./guide-tutorial-yii-integration.html">集成第三方代码</a></div>
<a class="list-group-item" href="#navigation-413" data-toggle="collapse" data-parent="#navigation">小部件 <b class="caret"></b></a><div id="navigation-413" class="submenu panel-collapse collapse"><a class="list-group-item" href="./guide-widget-bootstrap.html">Bootstrap 小部件</a>
<a class="list-group-item" href="./guide-widget-jui.html">Jquery UI 小部件</a></div>
<a class="list-group-item" href="#navigation-414" data-toggle="collapse" data-parent="#navigation">助手类 <b class="caret"></b></a><div id="navigation-414" class="submenu panel-collapse collapse"><a class="list-group-item" href="./guide-helper-overview.html">助手一览</a>
<a class="list-group-item" href="./guide-helper-array.html">ArrayHelper</a>
<a class="list-group-item" href="./guide-helper-html.html">Html</a>
<a class="list-group-item" href="./guide-helper-url.html">Url</a>
<a class="list-group-item" href="./guide-helper-security.html">security</a></div>
<a class="list-group-item" href="#navigation-415" data-toggle="collapse" data-parent="#navigation">不在目录内的文件 <b class="caret"></b></a><div id="navigation-415" class="submenu panel-collapse collapse"><a class="list-group-item" href="./guide-glossary.html">glossary</a></div></div>    </div>
    <div class="col-md-9 guide-content" role="main">
        <h1>Query Builder and Query <a href="#query-builder-and-query" name="query-builder-and-query" class="hashlink">&para;</a></h1><blockquote><p>Note: This section is under development.</p>
</blockquote>
<p>Yii provides a basic database access layer as described in the <a href="guide-database-basics.html">Database basics</a> section.
The database access layer provides a low-level way to interact with the database. While useful in some situations,
it can be tedious and error-prone to write raw SQLs. An alternative approach is to use the Query Builder.
The Query Builder provides an object-oriented vehicle for generating queries to be executed.</p>
<p>A typical usage of the query builder looks like the following:</p>
<pre><code class="language-php"><span style="color: #0000BB">$rows&nbsp;</span><span style="color: #007700">=&nbsp;(new&nbsp;\</span><span style="color: #0000BB">yii</span><span style="color: #007700">\</span><span style="color: #0000BB">db</span><span style="color: #007700">\</span><span style="color: #0000BB">Query</span><span style="color: #007700">())<br />&nbsp;&nbsp;&nbsp;&nbsp;-&gt;</span><span style="color: #0000BB">select</span><span style="color: #007700">(</span><span style="color: #DD0000">'id,&nbsp;name'</span><span style="color: #007700">)<br />&nbsp;&nbsp;&nbsp;&nbsp;-&gt;</span><span style="color: #0000BB">from</span><span style="color: #007700">(</span><span style="color: #DD0000">'user'</span><span style="color: #007700">)<br />&nbsp;&nbsp;&nbsp;&nbsp;-&gt;</span><span style="color: #0000BB">limit</span><span style="color: #007700">(</span><span style="color: #0000BB">10</span><span style="color: #007700">)<br />&nbsp;&nbsp;&nbsp;&nbsp;-&gt;</span><span style="color: #0000BB">all</span><span style="color: #007700">();<br /><br /></span><span style="color: #FF8000">//&nbsp;which&nbsp;is&nbsp;equivalent&nbsp;to&nbsp;the&nbsp;following&nbsp;code:<br /><br /></span><span style="color: #0000BB">$query&nbsp;</span><span style="color: #007700">=&nbsp;(new&nbsp;\</span><span style="color: #0000BB">yii</span><span style="color: #007700">\</span><span style="color: #0000BB">db</span><span style="color: #007700">\</span><span style="color: #0000BB">Query</span><span style="color: #007700">())<br />&nbsp;&nbsp;&nbsp;&nbsp;-&gt;</span><span style="color: #0000BB">select</span><span style="color: #007700">(</span><span style="color: #DD0000">'id,&nbsp;name'</span><span style="color: #007700">)<br />&nbsp;&nbsp;&nbsp;&nbsp;-&gt;</span><span style="color: #0000BB">from</span><span style="color: #007700">(</span><span style="color: #DD0000">'user'</span><span style="color: #007700">)<br />&nbsp;&nbsp;&nbsp;&nbsp;-&gt;</span><span style="color: #0000BB">limit</span><span style="color: #007700">(</span><span style="color: #0000BB">10</span><span style="color: #007700">);<br /><br /></span><span style="color: #FF8000">//&nbsp;Create&nbsp;a&nbsp;command.&nbsp;You&nbsp;can&nbsp;get&nbsp;the&nbsp;actual&nbsp;SQL&nbsp;using&nbsp;$command-&gt;sql<br /></span><span style="color: #0000BB">$command&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$query</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">createCommand</span><span style="color: #007700">();<br /><br /></span><span style="color: #FF8000">//&nbsp;Execute&nbsp;the&nbsp;command:<br /></span><span style="color: #0000BB">$rows&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$command</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">queryAll</span><span style="color: #007700">();</span></code></pre>
<h2>Query Methods <a href="#query-methods" name="query-methods" class="hashlink">&para;</a></h2><p>As you can see, <a href="./yii-db-query.html">yii\db\Query</a> is the main player that you need to deal with. Behind the scene,
<code>Query</code> is actually only responsible for representing various query information. The actual query
building logic is done by <a href="./yii-db-querybuilder.html">yii\db\QueryBuilder</a> when you call the <code>createCommand()</code> method,
and the query execution is done by <a href="./yii-db-command.html">yii\db\Command</a>.</p>
<p>For convenience, <a href="./yii-db-query.html">yii\db\Query</a> provides a set of commonly used query methods that will build
the query, execute it, and return the result. For example,</p>
<ul>
<li><a href="./yii-db-query.html#all()-detail">all()</a>: builds the query, executes it and returns all results as an array.</li>
<li><a href="./yii-db-query.html#one()-detail">one()</a>: returns the first row of the result.</li>
<li><a href="./yii-db-query.html#column()-detail">column()</a>: returns the first column of the result.</li>
<li><a href="./yii-db-query.html#scalar()-detail">scalar()</a>: returns the first column in the first row of the result.</li>
<li><a href="./yii-db-query.html#exists()-detail">exists()</a>: returns a value indicating whether the query results in anything.</li>
<li><a href="./yii-db-query.html#count()-detail">count()</a>: returns the result of a <code>COUNT</code> query. Other similar methods
include <code>sum($q)</code>, <code>average($q)</code>, <code>max($q)</code>, <code>min($q)</code>, which support the so-called aggregational data query. <code>$q</code>
parameter is mandatory for these methods and can be either the column name or expression.</li>
</ul>
<h2>Building Query <a href="#building-query" name="building-query" class="hashlink">&para;</a></h2><p>In the following, we will explain how to build various clauses in a SQL statement. For simplicity,
we use <code>$query</code> to represent a <a href="./yii-db-query.html">yii\db\Query</a> object.</p>
<h3><code>SELECT</code> <a href="#select" name="select" class="hashlink">&para;</a></h3><p>In order to form a basic <code>SELECT</code> query, you need to specify what columns to select and from what table:</p>
<pre><code class="language-php"><span style="color: #0000BB">$query</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">select</span><span style="color: #007700">(</span><span style="color: #DD0000">'id,&nbsp;name'</span><span style="color: #007700">)<br />&nbsp;&nbsp;&nbsp;&nbsp;-&gt;</span><span style="color: #0000BB">from</span><span style="color: #007700">(</span><span style="color: #DD0000">'user'</span><span style="color: #007700">);</span></code></pre>
<p>Select options can be specified as a comma-separated string, as in the above, or as an array.
The array syntax is especially useful when forming the selection dynamically:</p>
<pre><code class="language-php"><span style="color: #0000BB">$query</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">select</span><span style="color: #007700">([</span><span style="color: #DD0000">'id'</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">'name'</span><span style="color: #007700">])<br />&nbsp;&nbsp;&nbsp;&nbsp;-&gt;</span><span style="color: #0000BB">from</span><span style="color: #007700">(</span><span style="color: #DD0000">'user'</span><span style="color: #007700">);</span></code></pre>
<blockquote><p>Info: You should always use the array format if your <code>SELECT</code> clause contains SQL expressions.
This is because a SQL expression like <code>CONCAT(first_name, last_name) AS full_name</code> may contain commas.
If you list it together with other columns in a string, the expression may be split into several parts
by commas, which is not what you want to see.</p>
</blockquote>
<p>When specifying columns, you may include the table prefixes or column aliases, e.g., <code>user.id</code>, <code>user.id AS user_id</code>.
If you are using array to specify the columns, you may also use the array keys to specify the column aliases,
e.g., <code>['user_id' =&gt; 'user.id', 'user_name' =&gt; 'user.name']</code>.</p>
<p>Starting from version 2.0.1, you may also select sub-queries as columns. For example,</p>
<pre><code class="language-php"><span style="color: #0000BB">$subQuery&nbsp;</span><span style="color: #007700">=&nbsp;(new&nbsp;</span><span style="color: #0000BB">Query</span><span style="color: #007700">)-&gt;</span><span style="color: #0000BB">select</span><span style="color: #007700">(</span><span style="color: #DD0000">'COUNT(*)'</span><span style="color: #007700">)-&gt;</span><span style="color: #0000BB">from</span><span style="color: #007700">(</span><span style="color: #DD0000">'user'</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">$query&nbsp;</span><span style="color: #007700">=&nbsp;(new&nbsp;</span><span style="color: #0000BB">Query</span><span style="color: #007700">)-&gt;</span><span style="color: #0000BB">select</span><span style="color: #007700">([</span><span style="color: #DD0000">'id'</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">'count'&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #0000BB">$subQuery</span><span style="color: #007700">])-&gt;</span><span style="color: #0000BB">from</span><span style="color: #007700">(</span><span style="color: #DD0000">'post'</span><span style="color: #007700">);<br /></span><span style="color: #FF8000">//&nbsp;$query&nbsp;represents&nbsp;the&nbsp;following&nbsp;SQL:<br />//&nbsp;SELECT&nbsp;`id`,&nbsp;(SELECT&nbsp;COUNT(*)&nbsp;FROM&nbsp;`user`)&nbsp;AS&nbsp;`count`&nbsp;FROM&nbsp;`post`</span></code></pre>
<p>To select distinct rows, you may call <code>distinct()</code>, like the following:</p>
<pre><code class="language-php"><span style="color: #0000BB">$query</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">select</span><span style="color: #007700">(</span><span style="color: #DD0000">'user_id'</span><span style="color: #007700">)-&gt;</span><span style="color: #0000BB">distinct</span><span style="color: #007700">()-&gt;</span><span style="color: #0000BB">from</span><span style="color: #007700">(</span><span style="color: #DD0000">'post'</span><span style="color: #007700">);</span></code></pre>
<h3><code>FROM</code> <a href="#from" name="from" class="hashlink">&para;</a></h3><p>To specify which table(s) to select data from, call <code>from()</code>:</p>
<pre><code class="language-php"><span style="color: #0000BB">$query</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">select</span><span style="color: #007700">(</span><span style="color: #DD0000">'*'</span><span style="color: #007700">)-&gt;</span><span style="color: #0000BB">from</span><span style="color: #007700">(</span><span style="color: #DD0000">'user'</span><span style="color: #007700">);</span></code></pre>
<p>You may specify multiple tables using a comma-separated string or an array.
Table names can contain schema prefixes (e.g. <code>'public.user'</code>) and/or table aliases (e.g. <code>'user u'</code>).
The method will automatically quote the table names unless it contains some parenthesis
(which means the table is given as a sub-query or DB expression). For example,</p>
<pre><code class="language-php"><span style="color: #0000BB">$query</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">select</span><span style="color: #007700">(</span><span style="color: #DD0000">'u.*,&nbsp;p.*'</span><span style="color: #007700">)-&gt;</span><span style="color: #0000BB">from</span><span style="color: #007700">([</span><span style="color: #DD0000">'user&nbsp;u'</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">'post&nbsp;p'</span><span style="color: #007700">]);</span></code></pre>
<p>When the tables are specified as an array, you may also use the array keys as the table aliases
(if a table does not need alias, do not use a string key). For example,</p>
<pre><code class="language-php"><span style="color: #0000BB">$query</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">select</span><span style="color: #007700">(</span><span style="color: #DD0000">'u.*,&nbsp;p.*'</span><span style="color: #007700">)-&gt;</span><span style="color: #0000BB">from</span><span style="color: #007700">([</span><span style="color: #DD0000">'u'&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #DD0000">'user'</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">'p'&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #DD0000">'post'</span><span style="color: #007700">]);</span></code></pre>
<p>You may specify a sub-query using a <code>Query</code> object. In this case, the corresponding array key will be used
as the alias for the sub-query.</p>
<pre><code class="language-php"><span style="color: #0000BB">$subQuery&nbsp;</span><span style="color: #007700">=&nbsp;(new&nbsp;</span><span style="color: #0000BB">Query</span><span style="color: #007700">())-&gt;</span><span style="color: #0000BB">select</span><span style="color: #007700">(</span><span style="color: #DD0000">'id'</span><span style="color: #007700">)-&gt;</span><span style="color: #0000BB">from</span><span style="color: #007700">(</span><span style="color: #DD0000">'user'</span><span style="color: #007700">)-&gt;</span><span style="color: #0000BB">where</span><span style="color: #007700">(</span><span style="color: #DD0000">'status=1'</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">$query</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">select</span><span style="color: #007700">(</span><span style="color: #DD0000">'*'</span><span style="color: #007700">)-&gt;</span><span style="color: #0000BB">from</span><span style="color: #007700">([</span><span style="color: #DD0000">'u'&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #0000BB">$subQuery</span><span style="color: #007700">]);</span></code></pre>
<h3><code>WHERE</code> <a href="#where" name="where" class="hashlink">&para;</a></h3><p>Usually data is selected based upon certain criteria. Query Builder has some useful methods to specify these, the most powerful of which being <code>where</code>. It can be used in multiple ways.</p>
<p>The simplest way to apply a condition is to use a string:</p>
<pre><code class="language-php"><span style="color: #0000BB">$query</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">where</span><span style="color: #007700">(</span><span style="color: #DD0000">'status=:status'</span><span style="color: #007700">,&nbsp;[</span><span style="color: #DD0000">':status'&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #0000BB">$status</span><span style="color: #007700">]);</span></code></pre>
<p>When using strings, make sure you're binding the query parameters, not creating a query by string concatenation. The above approach is safe to use, the following is not:</p>
<pre><code class="language-php"><span style="color: #0000BB">$query</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">where</span><span style="color: #007700">(</span><span style="color: #DD0000">"status=</span><span style="color: #0000BB">$status</span><span style="color: #DD0000">"</span><span style="color: #007700">);&nbsp;</span><span style="color: #FF8000">//&nbsp;Dangerous!</span></code></pre>
<p>Instead of binding the status value immediately, you can do so using <code>params</code> or <code>addParams</code>:</p>
<pre><code class="language-php"><span style="color: #0000BB">$query</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">where</span><span style="color: #007700">(</span><span style="color: #DD0000">'status=:status'</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">$query</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">addParams</span><span style="color: #007700">([</span><span style="color: #DD0000">':status'&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #0000BB">$status</span><span style="color: #007700">]);</span></code></pre>
<p>Multiple conditions can simultaneously be set in <code>where</code> using the <em>hash format</em>:</p>
<pre><code class="language-php"><span style="color: #0000BB">$query</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">where</span><span style="color: #007700">([<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #DD0000">'status'&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #0000BB">10</span><span style="color: #007700">,<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #DD0000">'type'&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #0000BB">2</span><span style="color: #007700">,<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #DD0000">'id'&nbsp;</span><span style="color: #007700">=&gt;&nbsp;[</span><span style="color: #0000BB">4</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">8</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">15</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">16</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">23</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">42</span><span style="color: #007700">],<br />]);</span></code></pre>
<p>That code will generate the following SQL:</p>
<pre><code class="language-sql">WHERE (`status` = 10) AND (`type` = 2) AND (`id` IN (4, 8, 15, 16, 23, 42))
</code></pre>
<p>NULL is a special value in databases, and is handled smartly by the Query Builder. This code:</p>
<pre><code class="language-php"><span style="color: #0000BB">$query</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">where</span><span style="color: #007700">([</span><span style="color: #DD0000">'status'&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #0000BB">null</span><span style="color: #007700">]);</span></code></pre>
<p>results in this WHERE clause:</p>
<pre><code class="language-sql">WHERE (`status` IS NULL)
</code></pre>
<p>You can also create sub-queries with <code>Query</code> objects like the following,</p>
<pre><code class="language-php"><span style="color: #0000BB">$userQuery&nbsp;</span><span style="color: #007700">=&nbsp;(new&nbsp;</span><span style="color: #0000BB">Query</span><span style="color: #007700">)-&gt;</span><span style="color: #0000BB">select</span><span style="color: #007700">(</span><span style="color: #DD0000">'id'</span><span style="color: #007700">)-&gt;</span><span style="color: #0000BB">from</span><span style="color: #007700">(</span><span style="color: #DD0000">'user'</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">$query</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">where</span><span style="color: #007700">([</span><span style="color: #DD0000">'id'&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #0000BB">$userQuery</span><span style="color: #007700">]);</span></code></pre>
<p>which will generate the following SQL:</p>
<pre><code class="language-sql">WHERE `id` IN (SELECT `id` FROM `user`)
</code></pre>
<p>Another way to use the method is the operand format which is <code>[operator, operand1, operand2, ...]</code>.</p>
<p>Operator can be one of the following (see also <a href="./yii-db-queryinterface.html#where()-detail">yii\db\QueryInterface::where()</a>):</p>
<ul>
<li><p><code>and</code>: the operands should be concatenated together using <code>AND</code>. For example,
<code>['and', 'id=1', 'id=2']</code> will generate <code>id=1 AND id=2</code>. If an operand is an array,
it will be converted into a string using the rules described here. For example,
<code>['and', 'type=1', ['or', 'id=1', 'id=2']]</code> will generate <code>type=1 AND (id=1 OR id=2)</code>.
The method will NOT do any quoting or escaping.</p>
</li>
<li><p><code>or</code>: similar to the <code>and</code> operator except that the operands are concatenated using <code>OR</code>.</p>
</li>
<li><p><code>between</code>: operand 1 should be the column name, and operand 2 and 3 should be the
 starting and ending values of the range that the column is in.
 For example, <code>['between', 'id', 1, 10]</code> will generate <code>id BETWEEN 1 AND 10</code>.</p>
</li>
<li><p><code>not between</code>: similar to <code>between</code> except the <code>BETWEEN</code> is replaced with <code>NOT BETWEEN</code>
in the generated condition.</p>
</li>
<li><p><code>in</code>: operand 1 should be a column or DB expression. Operand 2 can be either an array or a <code>Query</code> object.
It will generate an <code>IN</code> condition. If Operand 2 is an array, it will represent the range of the values
that the column or DB expression should be; If Operand 2 is a <code>Query</code> object, a sub-query will be generated
and used as the range of the column or DB expression. For example,
<code>['in', 'id', [1, 2, 3]]</code> will generate <code>id IN (1, 2, 3)</code>.
The method will properly quote the column name and escape values in the range.
The <code>in</code> operator also supports composite columns. In this case, operand 1 should be an array of the columns,
while operand 2 should be an array of arrays or a <code>Query</code> object representing the range of the columns.</p>
</li>
<li><p><code>not in</code>: similar to the <code>in</code> operator except that <code>IN</code> is replaced with <code>NOT IN</code> in the generated condition.</p>
</li>
<li><p><code>like</code>: operand 1 should be a column or DB expression, and operand 2 be a string or an array representing
the values that the column or DB expression should be like.
For example, <code>['like', 'name', 'tester']</code> will generate <code>name LIKE '%tester%'</code>.
When the value range is given as an array, multiple <code>LIKE</code> predicates will be generated and concatenated
using <code>AND</code>. For example, <code>['like', 'name', ['test', 'sample']]</code> will generate
<code>name LIKE '%test%' AND name LIKE '%sample%'</code>.
You may also provide an optional third operand to specify how to escape special characters in the values.
The operand should be an array of mappings from the special characters to their
escaped counterparts. If this operand is not provided, a default escape mapping will be used.
You may use <code>false</code> or an empty array to indicate the values are already escaped and no escape
should be applied. Note that when using an escape mapping (or the third operand is not provided),
the values will be automatically enclosed within a pair of percentage characters.</p>
<blockquote><p>Note: When using PostgreSQL you may also use <a href="http://www.postgresql.org/docs/8.3/static/functions-matching.html#FUNCTIONS-LIKE"><code>ilike</code></a>
instead of <code>like</code> for case-insensitive matching.</p>
</blockquote>
</li>
<li><p><code>or like</code>: similar to the <code>like</code> operator except that <code>OR</code> is used to concatenate the <code>LIKE</code>
predicates when operand 2 is an array.</p>
</li>
<li><p><code>not like</code>: similar to the <code>like</code> operator except that <code>LIKE</code> is replaced with <code>NOT LIKE</code>
in the generated condition.</p>
</li>
<li><p><code>or not like</code>: similar to the <code>not like</code> operator except that <code>OR</code> is used to concatenate
the <code>NOT LIKE</code> predicates.</p>
</li>
<li><p><code>exists</code>: requires one operand which must be an instance of <a href="./yii-db-query.html">yii\db\Query</a> representing the sub-query.
It will build a <code>EXISTS (sub-query)</code> expression.</p>
</li>
<li><p><code>not exists</code>: similar to the <code>exists</code> operator and builds a <code>NOT EXISTS (sub-query)</code> expression.</p>
</li>
</ul>
<p>Additionally you can specify anything as operator:</p>
<pre><code class="language-php"><span style="color: #0000BB">$userQuery&nbsp;</span><span style="color: #007700">=&nbsp;(new&nbsp;</span><span style="color: #0000BB">Query</span><span style="color: #007700">)-&gt;</span><span style="color: #0000BB">select</span><span style="color: #007700">(</span><span style="color: #DD0000">'id'</span><span style="color: #007700">)-&gt;</span><span style="color: #0000BB">from</span><span style="color: #007700">(</span><span style="color: #DD0000">'user'</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">$query</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">where</span><span style="color: #007700">([</span><span style="color: #DD0000">'&gt;='</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">'id'</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">10</span><span style="color: #007700">]);</span></code></pre>
<p>It will result in:</p>
<pre><code class="language-sql">SELECT id FROM user WHERE id &gt;= 10;
</code></pre>
<p>If you are building parts of condition dynamically it's very convenient to use <code>andWhere()</code> and <code>orWhere()</code>:</p>
<pre><code class="language-php"><span style="color: #0000BB">$status&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">10</span><span style="color: #007700">;<br /></span><span style="color: #0000BB">$search&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #DD0000">'yii'</span><span style="color: #007700">;<br /><br /></span><span style="color: #0000BB">$query</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">where</span><span style="color: #007700">([</span><span style="color: #DD0000">'status'&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #0000BB">$status</span><span style="color: #007700">]);<br />if&nbsp;(!empty(</span><span style="color: #0000BB">$search</span><span style="color: #007700">))&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$query</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">andWhere</span><span style="color: #007700">([</span><span style="color: #DD0000">'like'</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">'title'</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$search</span><span style="color: #007700">]);<br />}</span></code></pre>
<p>In case <code>$search</code> isn't empty the following SQL will be generated:</p>
<pre><code class="language-sql">WHERE (`status` = 10) AND (`title` LIKE '%yii%')
</code></pre>
<h4>Building Filter Conditions <a href="#building-filter-conditions" name="building-filter-conditions" class="hashlink">&para;</a></h4><p>When building filter conditions based on user inputs, you usually want to specially handle "empty inputs"
by ignoring them in the filters. For example, you have an HTML form that takes username and email inputs.
If the user only enters something in the username input, you may want to build a query that only tries to
match the entered username. You may use the <code>filterWhere()</code> method achieve this goal:</p>
<pre><code class="language-php"><span style="color: #0000BB"></span><span style="color: #FF8000">//&nbsp;$username&nbsp;and&nbsp;$email&nbsp;are&nbsp;from&nbsp;user&nbsp;inputs<br /></span><span style="color: #0000BB">$query</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">filterWhere</span><span style="color: #007700">([<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #DD0000">'username'&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #0000BB">$username</span><span style="color: #007700">,<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #DD0000">'email'&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #0000BB">$email</span><span style="color: #007700">,<br />]);</span></code></pre>
<p>The <code>filterWhere()</code> method is very similar to <code>where()</code>. The main difference is that <code>filterWhere()</code>
will remove empty values from the provided condition. So if <code>$email</code> is "empty", the resulting query
will be <code>...WHERE username=:username</code>; and if both <code>$username</code> and <code>$email</code> are "empty", the query
will have no <code>WHERE</code> part.</p>
<p>A value is <em>empty</em> if it is null, an empty string, a string consisting of whitespaces, or an empty array.</p>
<p>You may also use <code>andFilterWhere()</code> and <code>orFilterWhere()</code> to append more filter conditions.</p>
<h3><code>ORDER BY</code> <a href="#order-by" name="order-by" class="hashlink">&para;</a></h3><p>For ordering results <code>orderBy</code> and <code>addOrderBy</code> could be used:</p>
<pre><code class="language-php"><span style="color: #0000BB">$query</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">orderBy</span><span style="color: #007700">([<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #DD0000">'id'&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #0000BB">SORT_ASC</span><span style="color: #007700">,<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #DD0000">'name'&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #0000BB">SORT_DESC</span><span style="color: #007700">,<br />]);</span></code></pre>
<p>Here we are ordering by <code>id</code> ascending and then by <code>name</code> descending.</p>
<h3><code>GROUP BY</code> and <code>HAVING</code> <a href="#group-by-and-having" name="group-by-and-having" class="hashlink">&para;</a></h3><p>In order to add <code>GROUP BY</code> to generated SQL you can use the following:</p>
<pre><code class="language-php"><span style="color: #0000BB">$query</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">groupBy</span><span style="color: #007700">(</span><span style="color: #DD0000">'id,&nbsp;status'</span><span style="color: #007700">);</span></code></pre>
<p>If you want to add another field after using <code>groupBy</code>:</p>
<pre><code class="language-php"><span style="color: #0000BB">$query</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">addGroupBy</span><span style="color: #007700">([</span><span style="color: #DD0000">'created_at'</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">'updated_at'</span><span style="color: #007700">]);</span></code></pre>
<p>To add a <code>HAVING</code> condition the corresponding <code>having</code> method and its <code>andHaving</code> and <code>orHaving</code> can be used. Parameters
for these are similar to the ones for <code>where</code> methods group:</p>
<pre><code class="language-php"><span style="color: #0000BB">$query</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">having</span><span style="color: #007700">([</span><span style="color: #DD0000">'status'&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #0000BB">$status</span><span style="color: #007700">]);</span></code></pre>
<h3><code>LIMIT</code> and <code>OFFSET</code> <a href="#limit-and-offset" name="limit-and-offset" class="hashlink">&para;</a></h3><p>To limit result to 10 rows <code>limit</code> can be used:</p>
<pre><code class="language-php"><span style="color: #0000BB">$query</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">limit</span><span style="color: #007700">(</span><span style="color: #0000BB">10</span><span style="color: #007700">);</span></code></pre>
<p>To skip 100 fist rows use:</p>
<pre><code class="language-php"><span style="color: #0000BB">$query</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">offset</span><span style="color: #007700">(</span><span style="color: #0000BB">100</span><span style="color: #007700">);</span></code></pre>
<h3><code>JOIN</code> <a href="#join" name="join" class="hashlink">&para;</a></h3><p>The <code>JOIN</code> clauses are generated in the Query Builder by using the applicable join method:</p>
<ul>
<li><code>innerJoin()</code></li>
<li><code>leftJoin()</code></li>
<li><code>rightJoin()</code></li>
</ul>
<p>This left join selects data from two related tables in one query:</p>
<pre><code class="language-php"><span style="color: #0000BB">$query</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">select</span><span style="color: #007700">([</span><span style="color: #DD0000">'user.name&nbsp;AS&nbsp;author'</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">'post.title&nbsp;as&nbsp;title'</span><span style="color: #007700">])<br />&nbsp;&nbsp;&nbsp;&nbsp;-&gt;</span><span style="color: #0000BB">from</span><span style="color: #007700">(</span><span style="color: #DD0000">'user'</span><span style="color: #007700">)<br />&nbsp;&nbsp;&nbsp;&nbsp;-&gt;</span><span style="color: #0000BB">leftJoin</span><span style="color: #007700">(</span><span style="color: #DD0000">'post'</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">'post.user_id&nbsp;=&nbsp;user.id'</span><span style="color: #007700">);</span></code></pre>
<p>In the code, the <code>leftJoin()</code> method's first parameter
specifies the table to join to. The second parameter defines the join condition.</p>
<p>If your database application supports other join types, you can use those via the  generic <code>join</code> method:</p>
<pre><code class="language-php"><span style="color: #0000BB">$query</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">join</span><span style="color: #007700">(</span><span style="color: #DD0000">'FULL&nbsp;OUTER&nbsp;JOIN'</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">'post'</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">'post.user_id&nbsp;=&nbsp;user.id'</span><span style="color: #007700">);</span></code></pre>
<p>The first argument is the join type to perform. The second is the table to join to, and the third is the condition.</p>
<p>Like <code>FROM</code>, you may also join with sub-queries. To do so, specify the sub-query as an array
which must contain one element. The array value must be a <code>Query</code> object representing the sub-query,
while the array key is the alias for the sub-query. For example,</p>
<pre><code class="language-php"><span style="color: #0000BB">$query</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">leftJoin</span><span style="color: #007700">([</span><span style="color: #DD0000">'u'&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #0000BB">$subQuery</span><span style="color: #007700">],&nbsp;</span><span style="color: #DD0000">'u.id=author_id'</span><span style="color: #007700">);</span></code></pre>
<h3><code>UNION</code> <a href="#union" name="union" class="hashlink">&para;</a></h3><p><code>UNION</code> in SQL adds results of one query to results of another query. Columns returned by both queries should match.
In Yii in order to build it you can first form two query objects and then use <code>union</code> method:</p>
<pre><code class="language-php"><span style="color: #0000BB">$query&nbsp;</span><span style="color: #007700">=&nbsp;new&nbsp;</span><span style="color: #0000BB">Query</span><span style="color: #007700">();<br /></span><span style="color: #0000BB">$query</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">select</span><span style="color: #007700">(</span><span style="color: #DD0000">"id,&nbsp;category_id&nbsp;as&nbsp;type,&nbsp;name"</span><span style="color: #007700">)-&gt;</span><span style="color: #0000BB">from</span><span style="color: #007700">(</span><span style="color: #DD0000">'post'</span><span style="color: #007700">)-&gt;</span><span style="color: #0000BB">limit</span><span style="color: #007700">(</span><span style="color: #0000BB">10</span><span style="color: #007700">);<br /><br /></span><span style="color: #0000BB">$anotherQuery&nbsp;</span><span style="color: #007700">=&nbsp;new&nbsp;</span><span style="color: #0000BB">Query</span><span style="color: #007700">();<br /></span><span style="color: #0000BB">$anotherQuery</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">select</span><span style="color: #007700">(</span><span style="color: #DD0000">'id,&nbsp;type,&nbsp;name'</span><span style="color: #007700">)-&gt;</span><span style="color: #0000BB">from</span><span style="color: #007700">(</span><span style="color: #DD0000">'user'</span><span style="color: #007700">)-&gt;</span><span style="color: #0000BB">limit</span><span style="color: #007700">(</span><span style="color: #0000BB">10</span><span style="color: #007700">);<br /><br /></span><span style="color: #0000BB">$query</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">union</span><span style="color: #007700">(</span><span style="color: #0000BB">$anotherQuery</span><span style="color: #007700">);</span></code></pre>
<h2>Batch Query <a href="#batch-query" name="batch-query" class="hashlink">&para;</a></h2><p>When working with large amount of data, methods such as <a href="./yii-db-query.html#all()-detail">yii\db\Query::all()</a> are not suitable
because they require loading all data into the memory. To keep the memory requirement low, Yii
provides the so-called batch query support. A batch query makes uses of data cursor and fetches
data in batches.</p>
<p>Batch query can be used like the following:</p>
<pre><code class="language-php"><span style="color: #0000BB"></span><span style="color: #007700">use&nbsp;</span><span style="color: #0000BB">yii</span><span style="color: #007700">\</span><span style="color: #0000BB">db</span><span style="color: #007700">\</span><span style="color: #0000BB">Query</span><span style="color: #007700">;<br /><br /></span><span style="color: #0000BB">$query&nbsp;</span><span style="color: #007700">=&nbsp;(new&nbsp;</span><span style="color: #0000BB">Query</span><span style="color: #007700">())<br />&nbsp;&nbsp;&nbsp;&nbsp;-&gt;</span><span style="color: #0000BB">from</span><span style="color: #007700">(</span><span style="color: #DD0000">'user'</span><span style="color: #007700">)<br />&nbsp;&nbsp;&nbsp;&nbsp;-&gt;</span><span style="color: #0000BB">orderBy</span><span style="color: #007700">(</span><span style="color: #DD0000">'id'</span><span style="color: #007700">);<br /><br />foreach&nbsp;(</span><span style="color: #0000BB">$query</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">batch</span><span style="color: #007700">()&nbsp;as&nbsp;</span><span style="color: #0000BB">$users</span><span style="color: #007700">)&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">//&nbsp;$users&nbsp;is&nbsp;an&nbsp;array&nbsp;of&nbsp;100&nbsp;or&nbsp;fewer&nbsp;rows&nbsp;from&nbsp;the&nbsp;user&nbsp;table<br /></span><span style="color: #007700">}<br /><br /></span><span style="color: #FF8000">//&nbsp;or&nbsp;if&nbsp;you&nbsp;want&nbsp;to&nbsp;iterate&nbsp;the&nbsp;row&nbsp;one&nbsp;by&nbsp;one<br /></span><span style="color: #007700">foreach&nbsp;(</span><span style="color: #0000BB">$query</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">each</span><span style="color: #007700">()&nbsp;as&nbsp;</span><span style="color: #0000BB">$user</span><span style="color: #007700">)&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">//&nbsp;$user&nbsp;represents&nbsp;one&nbsp;row&nbsp;of&nbsp;data&nbsp;from&nbsp;the&nbsp;user&nbsp;table<br /></span><span style="color: #007700">}</span></code></pre>
<p>The method <a href="./yii-db-query.html#batch()-detail">yii\db\Query::batch()</a> and <a href="./yii-db-query.html#each()-detail">yii\db\Query::each()</a> return an <a href="./yii-db-batchqueryresult.html">yii\db\BatchQueryResult</a> object
which implements the <code>Iterator</code> interface and thus can be used in the <code>foreach</code> construct.
During the first iteration, a SQL query is made to the database. Data are since then fetched in batches
in the iterations. By default, the batch size is 100, meaning 100 rows of data are being fetched in each batch.
You can change the batch size by passing the first parameter to the <code>batch()</code> or <code>each()</code> method.</p>
<p>Compared to the <a href="./yii-db-query.html#all()-detail">yii\db\Query::all()</a>, the batch query only loads 100 rows of data at a time into the memory.
If you process the data and then discard it right away, the batch query can help keep the memory usage under a limit.</p>
<p>If you specify the query result to be indexed by some column via <a href="./yii-db-querytrait.html#indexBy()-detail">yii\db\Query::indexBy()</a>, the batch query
will still keep the proper index. For example,</p>
<pre><code class="language-php"><span style="color: #0000BB"></span><span style="color: #007700">use&nbsp;</span><span style="color: #0000BB">yii</span><span style="color: #007700">\</span><span style="color: #0000BB">db</span><span style="color: #007700">\</span><span style="color: #0000BB">Query</span><span style="color: #007700">;<br /><br /></span><span style="color: #0000BB">$query&nbsp;</span><span style="color: #007700">=&nbsp;(new&nbsp;</span><span style="color: #0000BB">Query</span><span style="color: #007700">())<br />&nbsp;&nbsp;&nbsp;&nbsp;-&gt;</span><span style="color: #0000BB">from</span><span style="color: #007700">(</span><span style="color: #DD0000">'user'</span><span style="color: #007700">)<br />&nbsp;&nbsp;&nbsp;&nbsp;-&gt;</span><span style="color: #0000BB">indexBy</span><span style="color: #007700">(</span><span style="color: #DD0000">'username'</span><span style="color: #007700">);<br /><br />foreach&nbsp;(</span><span style="color: #0000BB">$query</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">batch</span><span style="color: #007700">()&nbsp;as&nbsp;</span><span style="color: #0000BB">$users</span><span style="color: #007700">)&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">//&nbsp;$users&nbsp;is&nbsp;indexed&nbsp;by&nbsp;the&nbsp;"username"&nbsp;column<br /></span><span style="color: #007700">}<br /><br />foreach&nbsp;(</span><span style="color: #0000BB">$query</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">each</span><span style="color: #007700">()&nbsp;as&nbsp;</span><span style="color: #0000BB">$username&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #0000BB">$user</span><span style="color: #007700">)&nbsp;{<br />}</span></code></pre>
        <div class="toplink"><a href="#" class="h1" title="go to top"><span class="glyphicon glyphicon-arrow-up"></a></div>
    </div>
</div>


</div>

<footer class="footer">
        <p class="pull-right"><small>Page generated on Sat, 25 Oct 2014 15:17:26 +0200</small></p>
    Powered by <a href="http://www.yiiframework.com/" rel="external">Yii Framework</a></footer>

<script type="text/javascript">jQuery(document).ready(function () {
    var shiftWindow = function () { scrollBy(0, -50) };
    if (location.hash) shiftWindow();
    window.addEventListener("hashchange", shiftWindow);
var element = document.createElement("script");
element.src = "./jssearch.index.js";
document.body.appendChild(element);

var searchBox = $('#searchbox');

// focus the search field
searchBox.focus();

// search when typing in search field
searchBox.on("keyup", function(event) {
    var query = $(this).val();

    if (query == '' || event.which == 27) {
        $('#search-resultbox').hide();
        return;
    } else if (event.which == 13) {
        var selectedLink = $('#search-resultbox a.selected');
        if (selectedLink.length != 0) {
            document.location = selectedLink.attr('href');
            return;
        }
    } else if (event.which == 38 || event.which == 40) {
        $('#search-resultbox').show();

        var selected = $('#search-resultbox a.selected');
        if (selected.length == 0) {
            $('#search-results').find('a').first().addClass('selected');
        } else {
            var next;
            if (event.which == 40) {
                next = selected.parent().next().find('a').first();
            } else {
                next = selected.parent().prev().find('a').first();
            }
            if (next.length != 0) {
                var resultbox = $('#search-results');
                var position = next.position();

//              TODO scrolling is buggy and jumps around
//                resultbox.scrollTop(Math.floor(position.top));
//                console.log(position.top);

                selected.removeClass('selected');
                next.addClass('selected');
            }
        }

        return;
    }
    $('#search-resultbox').show();
    $('#search-results').html('<li><span class="no-results">No results</span></li>');

    var result = jssearch.search(query);

    if (result.length > 0) {
        var i = 0;
        var resHtml = '';

        for (var key in result) {
            if (i++ > 20) {
                break;
            }
            resHtml = resHtml +
            '<li><a href="' + result[key].file.u.substr(3) +'"><span class="title">' + result[key].file.t + '</span>' +
            '<span class="description">' + result[key].file.d + '</span></a></li>';
        }
        $('#search-results').html(resHtml);
    }
});

// hide the search results on ESC
$(document).on("keyup", function(event) { if (event.which == 27) { $('#search-resultbox').hide(); } });
// hide search results on click to document
$(document).bind('click', function (e) { $('#search-resultbox').hide(); });
// except the following:
searchBox.bind('click', function(e) { e.stopPropagation(); });
$('#search-resultbox').bind('click', function(e) { e.stopPropagation(); });

});</script></body>
</html>
