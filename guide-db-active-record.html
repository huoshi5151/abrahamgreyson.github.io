<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="language" content="en" />
        <link href="./assets/41d5631d/css/bootstrap.css" rel="stylesheet">
<link href="./assets/bad56eea/style.css" rel="stylesheet">
<script src="./assets/e17319cf/jquery.js"></script>
<script src="./assets/41d5631d/js/bootstrap.js"></script>
<script src="./assets/b52a7f0/jssearch.js"></script>    <title>Yii Framework 2.0 API Documentation</title>
</head>
<body>

<div class="wrap">
    <nav id="w311" class="navbar-inverse navbar-fixed-top navbar" role="navigation"><div class="navbar-header"><button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#w311-collapse"><span class="sr-only">Toggle navigation</span>
<span class="icon-bar"></span>
<span class="icon-bar"></span>
<span class="icon-bar"></span></button><a class="navbar-brand" href="./index.html">Yii 2.0 API æ–‡æ¡£</a></div><div id="w311-collapse" class="collapse navbar-collapse"><ul id="w312" class="navbar-nav nav"><li><a href="./index.html">ç±»å‚è€ƒ</a></li>
<li class="dropdown"><a class="dropdown-toggle" href="#" data-toggle="dropdown">æ‰©å±• <b class="caret"></b></a><ul id="w313" class="dropdown-menu"><li><a href="./ext-apidoc-index.html" tabindex="-1">apidoc</a></li>
<li><a href="./ext-authclient-index.html" tabindex="-1">authclient</a></li>
<li><a href="./ext-bootstrap-index.html" tabindex="-1">bootstrap</a></li>
<li><a href="./ext-codeception-index.html" tabindex="-1">codeception</a></li>
<li><a href="./ext-composer-index.html" tabindex="-1">composer</a></li>
<li><a href="./ext-debug-index.html" tabindex="-1">debug</a></li>
<li><a href="./ext-elasticsearch-index.html" tabindex="-1">elasticsearch</a></li>
<li><a href="./ext-faker-index.html" tabindex="-1">faker</a></li>
<li><a href="./ext-gii-index.html" tabindex="-1">gii</a></li>
<li><a href="./ext-imagine-index.html" tabindex="-1">imagine</a></li>
<li><a href="./ext-jui-index.html" tabindex="-1">jui</a></li>
<li><a href="./ext-mongodb-index.html" tabindex="-1">mongodb</a></li>
<li><a href="./ext-redis-index.html" tabindex="-1">redis</a></li>
<li><a href="./ext-smarty-index.html" tabindex="-1">smarty</a></li>
<li><a href="./ext-sphinx-index.html" tabindex="-1">sphinx</a></li>
<li><a href="./ext-swiftmailer-index.html" tabindex="-1">swiftmailer</a></li>
<li><a href="./ext-twig-index.html" tabindex="-1">twig</a></li></ul></li>
<li><a href="./guide-README.html">æƒå¨æŒ‡å—</a></li>
<li class="dropdown"><a class="dropdown-toggle" href="#" data-toggle="dropdown">Github <b class="caret"></b></a><ul id="w314" class="dropdown-menu"><li><a href="https://github.com/yiisoft/yii2" tabindex="-1">Yii 2.0</a></li>
<li><a href="https://github.com/yii2-chinesization/yii2-zh-cn" tabindex="-1">Yii 2.0 ä¸­æ–‡åŒ–é¡¹ç›®</a></li>
<li><a href="https://github.com/AbrahamGreyson/abrahamgreyson.github.io" tabindex="-1">docwithcn.com</a></li></ul></li></ul><div class="navbar-form navbar-left" role="search">
  <div class="form-group">
    <input id="searchbox" type="text" class="form-control" placeholder="Search">
  </div>
</div>
</div></nav>
    <div id="search-resultbox" style="display: none;" class="modal-content">
        <ul id="search-results">
        </ul>
    </div>

    
<div class="row">
    <div class="col-md-2">
                <div id="navigation" class="list-group"><a class="list-group-item" href="#navigation-294" data-toggle="collapse" data-parent="#navigation">ä»‹ç» <b class="caret"></b></a><div id="navigation-294" class="submenu panel-collapse collapse"><a class="list-group-item" href="./guide-intro-yii.html">ï¿½
ï¿½äº Yii</a>
<a class="list-group-item" href="./guide-intro-upgrade-from-v1.html">ä» Yii 1.1 å‡çº§</a></div>
<a class="list-group-item" href="#navigation-295" data-toggle="collapse" data-parent="#navigation">ï¿½é—¨ <b class="caret"></b></a><div id="navigation-295" class="submenu panel-collapse collapse"><a class="list-group-item" href="./guide-start-installation.html">å®‰ï¿½
 Yii</a>
<a class="list-group-item" href="./guide-start-workflow.html">è¿è¡Œåº”ç”¨</a>
<a class="list-group-item" href="./guide-start-hello.html">ç¬¬ä¸€æ¬¡é—®å€™</a>
<a class="list-group-item" href="./guide-start-forms.html">ä½¿ç”¨ Forms</a>
<a class="list-group-item" href="./guide-start-databases.html">ç©è½¬ Databases</a>
<a class="list-group-item" href="./guide-start-gii.html">ç”¨ Gii ç”Ÿæˆä»£ç </a>
<a class="list-group-item" href="./guide-start-looking-ahead.html">æ›´ä¸Šä¸€å±‚æ¥¼</a></div>
<a class="list-group-item" href="#navigation-296" data-toggle="collapse" data-parent="#navigation">åº”ç”¨ç»“æ„ <b class="caret"></b></a><div id="navigation-296" class="submenu panel-collapse collapse"><a class="list-group-item" href="./guide-structure-overview.html">ç»“æ„æ¦‚è¿°</a>
<a class="list-group-item" href="./guide-structure-entry-scripts.html">ï¿½
ï¿½å£è„šæœ¬</a>
<a class="list-group-item" href="./guide-structure-applications.html">åº”ç”¨</a>
<a class="list-group-item" href="./guide-structure-application-components.html">åº”ç”¨ç»„ä»¶</a>
<a class="list-group-item" href="./guide-structure-controllers.html">æ§åˆ¶å™¨ï¼ˆControllerï¼‰</a>
<a class="list-group-item" href="./guide-structure-views.html">è§†å›¾ï¼ˆViewï¼‰</a>
<a class="list-group-item" href="./guide-structure-models.html">æ¨¡å‹ï¼ˆModelï¼‰</a>
<a class="list-group-item" href="./guide-structure-filters.html">è¿‡æ»¤å™¨</a>
<a class="list-group-item" href="./guide-structure-widgets.html">å°éƒ¨ä»¶ï¼ˆWidgetï¼‰</a>
<a class="list-group-item" href="./guide-structure-modules.html">æ¨¡å—ï¼ˆModuleï¼‰</a>
<a class="list-group-item" href="./guide-structure-assets.html">å‰ç«¯èµ„æºï¼ˆAssetï¼‰</a>
<a class="list-group-item" href="./guide-structure-extensions.html">æ‰©å±•ï¼ˆextensionsï¼‰</a></div>
<a class="list-group-item" href="#navigation-297" data-toggle="collapse" data-parent="#navigation">è¯·æ±‚å¤„ç† <b class="caret"></b></a><div id="navigation-297" class="submenu panel-collapse collapse"><a class="list-group-item" href="./guide-runtime-overview.html">è¿è¡Œæ¦‚è¿°</a>
<a class="list-group-item" href="./guide-runtime-bootstrapping.html">å¼•å¯¼ï¼ˆBootstrappingï¼‰</a>
<a class="list-group-item" href="./guide-runtime-routing.html">è·¯ç”±ï¼ˆRoutingï¼‰</a>
<a class="list-group-item" href="./guide-runtime-requests.html">è¯·æ±‚ï¼ˆRequestï¼‰</a>
<a class="list-group-item" href="./guide-runtime-responses.html">å“åº”ï¼ˆResponseï¼‰</a>
<a class="list-group-item" href="./guide-runtime-sessions-cookies.html">Sessionsï¼ˆä¼šè¯ï¼‰å’Œ Cookies</a>
<a class="list-group-item" href="./guide-runtime-url-handling.html">URL è§£æå’Œç”Ÿæˆ</a>
<a class="list-group-item" href="./guide-runtime-handling-errors.html">é”™è¯¯å¤„ç†</a>
<a class="list-group-item" href="./guide-runtime-logging.html">æ—¥å¿—</a></div>
<a class="list-group-item" href="#navigation-298" data-toggle="collapse" data-parent="#navigation">ï¿½é”®æ¦‚å¿µ <b class="caret"></b></a><div id="navigation-298" class="submenu panel-collapse collapse"><a class="list-group-item" href="./guide-concept-components.html">ç»„ä»¶ï¼ˆComponentï¼‰</a>
<a class="list-group-item" href="./guide-concept-properties.html">å±æ€§ï¼ˆPropertyï¼‰</a>
<a class="list-group-item" href="./guide-concept-events.html">äº‹ä»¶ï¼ˆEventï¼‰</a>
<a class="list-group-item" href="./guide-concept-behaviors.html">è¡Œä¸ºï¼ˆBehaviorï¼‰</a>
<a class="list-group-item" href="./guide-concept-configurations.html">ï¿½
ï¿½ç½®ï¼ˆConfigurationsï¼‰</a>
<a class="list-group-item" href="./guide-concept-autoloading.html">ç±»è‡ªåŠ¨åŠ è½½ï¼ˆAutoloadingï¼‰</a>
<a class="list-group-item" href="./guide-concept-alias.html">åˆ«åï¼ˆAliasï¼‰</a>
<a class="list-group-item" href="./guide-concept-service-locator.html">æœåŠ¡å®šä½å™¨ï¼ˆService Locatorï¼‰</a>
<a class="list-group-item" href="./guide-concept-di-container.html">ä¾èµ–æ³¨ï¿½
ï¿½å®¹å™¨ï¼ˆDI Containerï¼‰</a></div>
<a class="list-group-item active" href="#navigation-299" data-toggle="collapse" data-parent="#navigation">ï¿½åˆæ•°æ®åº“å·¥ä½œ <b class="caret"></b></a><div id="navigation-299" class="submenu panel-collapse collapse in"><a class="list-group-item" href="./guide-db-dao.html">æ•°æ®è®¿é—®å¯¹è±¡ï¼ˆDAOï¼‰</a>
<a class="list-group-item" href="./guide-db-query-builder.html">æŸ¥è¯¢ç”Ÿæˆå™¨ï¼ˆQuery Builderï¼‰</a>
<a class="list-group-item active" href="./guide-db-active-record.html">æ´»åŠ¨è®°å½•ï¼ˆActive Recordï¼‰</a>
<a class="list-group-item" href="./guide-db-migrations.html">æ•°æ®åº“è¿ç§»ï¼ˆMigrationï¼‰</a>
<a class="list-group-item" href="./guide-db-sphinx.html">Sphinx</a>
<a class="list-group-item" href="./guide-db-redis.html">Redis</a>
<a class="list-group-item" href="./guide-db-mongodb.html">MongoDB</a>
<a class="list-group-item" href="./guide-db-elastic-search.html">ElasticSearch</a></div>
<a class="list-group-item" href="#navigation-300" data-toggle="collapse" data-parent="#navigation">æ¥æ”¶ç”¨æˆ·æ•°æ® <b class="caret"></b></a><div id="navigation-300" class="submenu panel-collapse collapse"><a class="list-group-item" href="./guide-input-forms.html">åˆ›å»ºè¡¨å•</a>
<a class="list-group-item" href="./guide-input-validation.html">è¾“ï¿½
ï¿½éªŒè¯</a>
<a class="list-group-item" href="./guide-input-file-uploading.html">æ–‡ä»¶ä¸Šä¼ </a>
<a class="list-group-item" href="./guide-input-multiple-models.html">å¤šæ¨¡å‹åŒæ—¶è¾“ï¿½
ï¿½</a></div>
<a class="list-group-item" href="#navigation-301" data-toggle="collapse" data-parent="#navigation">æ˜¾ç¤ºæ•°æ® <b class="caret"></b></a><div id="navigation-301" class="submenu panel-collapse collapse"><a class="list-group-item" href="./guide-output-formatter.html">æ ¼å¼åŒ–è¾“å‡ºæ•°æ®</a>
<a class="list-group-item" href="./guide-output-pagination.html">åˆ†é¡µï¼ˆPaginationï¼‰</a>
<a class="list-group-item" href="./guide-output-sorting.html">æ’åºï¼ˆSortingï¼‰</a>
<a class="list-group-item" href="./guide-output-data-providers.html">æ•°æ®æä¾›å™¨</a>
<a class="list-group-item" href="./guide-output-data-widgets.html">æ•°æ®å°éƒ¨ä»¶</a>
<a class="list-group-item" href="./guide-output-theming.html">ä¸»é¢˜</a></div>
<a class="list-group-item" href="#navigation-302" data-toggle="collapse" data-parent="#navigation">ï¿½ <b class="caret"></b></a><div id="navigation-302" class="submenu panel-collapse collapse"><a class="list-group-item" href="./guide-security-authentication.html">è®¤è¯ï¼ˆAuthenticationï¼‰</a>
<a class="list-group-item" href="./guide-security-authorization.html">æˆæƒï¼ˆAuthorizationï¼‰</a>
<a class="list-group-item" href="./guide-security-passwords.html">å¤„ç†å¯†ç </a>
<a class="list-group-item" href="./guide-security-auth-clients.html">å®¢æˆ·ç«¯è®¤è¯</a>
<a class="list-group-item" href="./guide-security-best-practices.html">å®‰ï¿½
ï¿½é¢†åŸŸçš„æœ€ä½³å®è·µ</a></div>
<a class="list-group-item" href="#navigation-303" data-toggle="collapse" data-parent="#navigation">ç¼“å­˜ <b class="caret"></b></a><div id="navigation-303" class="submenu panel-collapse collapse"><a class="list-group-item" href="./guide-caching-overview.html">æ¦‚è¿°</a>
<a class="list-group-item" href="./guide-caching-data.html">æ•°æ®ç¼“å­˜</a>
<a class="list-group-item" href="./guide-caching-fragment.html">ç‰‡æ®µç¼“å­˜</a>
<a class="list-group-item" href="./guide-caching-page.html">åˆ†é¡µç¼“å­˜</a>
<a class="list-group-item" href="./guide-caching-http.html">HTTP ç¼“å­˜</a></div>
<a class="list-group-item" href="#navigation-304" data-toggle="collapse" data-parent="#navigation">RESTful Web æœåŠ¡ <b class="caret"></b></a><div id="navigation-304" class="submenu panel-collapse collapse"><a class="list-group-item" href="./guide-rest-quick-start.html">å¿«é€Ÿï¿½
ï¿½é—¨</a>
<a class="list-group-item" href="./guide-rest-resources.html">èµ„æº</a>
<a class="list-group-item" href="./guide-rest-routing.html">è·¯ç”±</a>
<a class="list-group-item" href="./guide-rest-response-formatting.html">æ ¼å¼åŒ–å“åº”</a>
<a class="list-group-item" href="./guide-rest-authentication.html">æˆæƒéªŒè¯</a>
<a class="list-group-item" href="./guide-rest-rate-limiting.html">é€Ÿç‡é™åˆ¶</a>
<a class="list-group-item" href="./guide-rest-versioning.html">ç‰ˆæœ¬åŒ–</a>
<a class="list-group-item" href="./guide-rest-error-handling.html">é”™è¯¯å¤„ç†</a>
<a class="list-group-item" href="./guide-rest-testing.html">æµ‹è¯•</a></div>
<a class="list-group-item" href="#navigation-305" data-toggle="collapse" data-parent="#navigation">ï¿½ <b class="caret"></b></a><div id="navigation-305" class="submenu panel-collapse collapse"><a class="list-group-item" href="./guide-tool-debugger.html">è°ƒè¯•å·¥ï¿½
ï¿½æ å’Œè°ƒè¯•å™¨</a>
<a class="list-group-item" href="./guide-tool-gii.html">ä½¿ç”¨ Gii ç”Ÿæˆä»£ç </a>
<a class="list-group-item" href="./guide-tool-api-doc.html">ç”Ÿæˆ API æ–‡æ¡£</a></div>
<a class="list-group-item" href="#navigation-306" data-toggle="collapse" data-parent="#navigation">æµ‹è¯• <b class="caret"></b></a><div id="navigation-306" class="submenu panel-collapse collapse"><a class="list-group-item" href="./guide-test-overview.html">æ¦‚è¿°</a>
<a class="list-group-item" href="./guide-test-endvironment-setup.html">æ­å»ºæµ‹è¯•ç¯å¢ƒ</a>
<a class="list-group-item" href="./guide-test-unit.html">å•ï¿½
ï¿½æµ‹è¯•</a>
<a class="list-group-item" href="./guide-test-functional.html">åŠŸèƒ½æµ‹è¯•</a>
<a class="list-group-item" href="./guide-test-acceptance.html">éªŒæ”¶æµ‹è¯•</a>
<a class="list-group-item" href="./guide-test-fixtures.html">æµ‹è¯•å¤¹ï¿½
ï¿½</a></div>
<a class="list-group-item" href="#navigation-307" data-toggle="collapse" data-parent="#navigation">é«˜çº§ä¸“é¢˜ <b class="caret"></b></a><div id="navigation-307" class="submenu panel-collapse collapse"><a class="list-group-item" href="./guide-tutorial-advanced-app.html">é«˜çº§åº”ç”¨æ¨¡ç‰ˆ</a>
<a class="list-group-item" href="./guide-tutorial-start-from-scratch.html">ä»å¤´æ„å»ºè‡ªå®šä¹‰æ¨¡ç‰ˆ</a>
<a class="list-group-item" href="./guide-tutorial-console.html">æ§åˆ¶å°å‘½ä»¤</a>
<a class="list-group-item" href="./guide-tutorial-core-validators.html">æ ¸å¿ƒéªŒè¯å™¨</a>
<a class="list-group-item" href="./guide-tutorial-i18n.html">å›½ï¿½
åŒ–</a>
<a class="list-group-item" href="./guide-tutorial-mailing.html">æ”¶å‘é‚®ä»¶</a>
<a class="list-group-item" href="./guide-tutorial-performance-tuning.html">æ€§èƒ½ä¼˜åŒ–</a>
<a class="list-group-item" href="./guide-tutorial-shared-hosting.html">ï¿½
ï¿½äº«ä¸»æœºç¯å¢ƒ</a>
<a class="list-group-item" href="./guide-tutorial-template-engines.html">æ¨¡æ¿å¼•æ“</a>
<a class="list-group-item" href="./guide-tutorial-yii-integration.html">é›†æˆç¬¬ä¸‰æ–¹ä»£ç </a></div>
<a class="list-group-item" href="#navigation-308" data-toggle="collapse" data-parent="#navigation">å°éƒ¨ä»¶ <b class="caret"></b></a><div id="navigation-308" class="submenu panel-collapse collapse"><a class="list-group-item" href="./guide-widget-bootstrap.html">Bootstrap å°éƒ¨ä»¶</a>
<a class="list-group-item" href="./guide-widget-jui.html">Jquery UI å°éƒ¨ä»¶</a></div>
<a class="list-group-item" href="#navigation-309" data-toggle="collapse" data-parent="#navigation">åŠ©æ‰‹ç±» <b class="caret"></b></a><div id="navigation-309" class="submenu panel-collapse collapse"><a class="list-group-item" href="./guide-helper-overview.html">åŠ©æ‰‹ä¸€è§ˆ</a>
<a class="list-group-item" href="./guide-helper-array.html">ArrayHelper</a>
<a class="list-group-item" href="./guide-helper-html.html">Html</a>
<a class="list-group-item" href="./guide-helper-url.html">Url</a>
<a class="list-group-item" href="./guide-helper-security.html">security</a></div>
<a class="list-group-item" href="#navigation-310" data-toggle="collapse" data-parent="#navigation">çš„æ–‡ä»¶ <b class="caret"></b></a><div id="navigation-310" class="submenu panel-collapse collapse"><a class="list-group-item" href="./guide-glossary.html">glossary</a></div></div>    </div>
    <div class="col-md-9 guide-content" role="main">
        <h1>Active Record <a href="#active-record" name="active-record" class="hashlink">&para;</a></h1><blockquote><p>æ³¨æ„ï¼šè¯¥ç« èŠ‚è¿˜åœ¨å¼€å‘ä¸­ã€‚</p>
</blockquote>
<p><a href="http://zh.wikipedia.org/wiki/Active_Record">Active Record</a> ï¼ˆæ´»åŠ¨è®°å½•ï¼Œä»¥ä¸‹ç®€ç§°ARï¼‰æä¾›äº†ä¸€ä¸ªé¢å‘å¯¹è±¡çš„æ¥å£ï¼Œ
ç”¨ä»¥è®¿é—®æ•°æ®åº“ä¸­çš„æ•°æ®ã€‚ä¸€ä¸ª AR ç±»å
³è”ä¸€å¼ æ•°æ®è¡¨ï¼Œ
æ¯ä¸ª AR å¯¹è±¡å¯¹åº”è¡¨ä¸­çš„ä¸€è¡Œï¼Œå¯¹è±¡çš„å±æ€§ï¼ˆå³ AR çš„ç‰¹æ€§Attributeï¼‰æ˜ å°„åˆ°æ•°æ®è¡Œçš„å¯¹åº”åˆ—ã€‚
ä¸€æ¡æ´»åŠ¨è®°å½•ï¼ˆARå¯¹è±¡ï¼‰å¯¹åº”æ•°æ®è¡¨çš„ä¸€è¡Œï¼ŒARå¯¹è±¡çš„å±æ€§åˆ™æ˜ å°„è¯¥è¡Œçš„ç›¸åº”åˆ—ã€‚
æ‚¨å¯ä»¥ç›´æ¥ä»¥é¢å‘å¯¹è±¡çš„æ–¹å¼æ¥æ“çºµæ•°æ®è¡¨ä¸­çš„æ•°æ®ï¼Œå¦ˆå¦ˆå†ä¸ç”¨æ‹
å¿ƒæˆ‘éœ€è¦å†™åŸç”Ÿ SQL è¯­å¥å•¦ã€‚</p>
<p>ä¾‹å¦‚ï¼Œå‡å®š <code>Customer</code> AR ç±»å
³è”ç€ <code>customer</code> è¡¨ï¼Œä¸”è¯¥ç±»çš„ <code>name</code> å±æ€§ä»£è¡¨ <code>customer</code> è¡¨çš„ <code>name</code> åˆ—ã€‚
ä½ å¯ä»¥å†™ä»¥ä¸‹ä»£ç æ¥å“‰ <code>customer</code> è¡¨é‡Œæ’å
¥ä¸€è¡Œæ–°çš„è®°å½•:</p>
<p>ç”¨ AR è€Œä¸æ˜¯åŸç”Ÿçš„ SQL è¯­å¥å»æ‰§è¡Œæ•°æ®åº“æŸ¥è¯¢ï¼Œå¯ä»¥è°ƒç”¨ç›´è§‚æ–¹æ³•æ¥å®ç°ç›¸åŒç›®æ ‡ã€‚å¦‚ï¼Œè°ƒç”¨ <a href="./yii-db-baseactiverecord.html#save()-detail">save()</a> æ–¹æ³•å°†æ‰§è¡Œæ’å
¥æˆ–æ›´æ–°è½®è¯¢ï¼Œå°†åœ¨è¯¥ AR ç±»å
³è”çš„æ•°æ®è¡¨æ–°å»ºæˆ–æ›´æ–°ä¸€è¡Œæ•°æ®ï¼š</p>
<pre><code class="language-php"><span style="color: #0000BB">$customer&nbsp;</span><span style="color: #007700">=&nbsp;new&nbsp;</span><span style="color: #0000BB">Customer</span><span style="color: #007700">();<br /></span><span style="color: #0000BB">$customer</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">name&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #DD0000">'æç‹—è›‹'</span><span style="color: #007700">;<br /></span><span style="color: #0000BB">$customer</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">save</span><span style="color: #007700">();&nbsp;&nbsp;</span><span style="color: #FF8000">//&nbsp;ä¸€è¡Œæ–°æ•°æ®æ’å<br /></span><span style="color: #0000BB">¥&nbsp;customer&nbsp;è¡¨</span></code></pre>
<p>ä¸Šé¢çš„ä»£ç å’Œä½¿ç”¨ä¸‹é¢çš„åŸç”Ÿ SQL è¯­å¥æ˜¯ç­‰æ•ˆçš„ï¼Œä½†æ˜¾ç„¶å‰è€
æ›´ç›´è§‚ï¼Œ
æ›´ä¸æ˜“å‡ºé”™ï¼Œå¹¶ä¸”é¢å¯¹ä¸åŒçš„æ•°æ®åº“ç³»ç»Ÿï¼ˆDBMS, Database Management Systemï¼‰æ—¶æ›´ä¸å®¹æ˜“äº§ç”Ÿå
¼å®¹æ€§é—®é¢˜ã€‚</p>
<pre><code class="language-php"><span style="color: #0000BB">$db</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">createCommand</span><span style="color: #007700">(</span><span style="color: #DD0000">'INSERT&nbsp;INTO&nbsp;customer&nbsp;(name)&nbsp;VALUES&nbsp;(:name)'</span><span style="color: #007700">,&nbsp;[<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #DD0000">':name'&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #DD0000">'æç‹—è›‹'</span><span style="color: #007700">,<br />])-&gt;</span><span style="color: #0000BB">execute</span><span style="color: #007700">();</span></code></pre>
<p>ä¸‹é¢æ˜¯æ‰€æœ‰ç›®å‰è¢« Yii çš„ AR åŠŸèƒ½æ‰€æ”¯æŒçš„æ•°æ®åº“åˆ—è¡¨ï¼š</p>
<ul>
<li>MySQL 4.1 åŠä»¥ä¸Šï¼šé€šè¿‡ <a href="./yii-db-activerecord.html">yii\db\ActiveRecord</a></li>
<li>PostgreSQL 7.3 åŠä»¥ä¸Šï¼šé€šè¿‡ <a href="./yii-db-activerecord.html">yii\db\ActiveRecord</a></li>
<li>SQLite 2 å’Œ 3ï¼šé€šè¿‡ <a href="./yii-db-activerecord.html">yii\db\ActiveRecord</a></li>
<li>Microsoft SQL Server 2010 åŠä»¥ä¸Šï¼šé€šè¿‡ <a href="./yii-db-activerecord.html">yii\db\ActiveRecord</a></li>
<li>Oracle: é€šè¿‡ <a href="./yii-db-activerecord.html">yii\db\ActiveRecord</a></li>
<li>CUBRID 9.1 åŠä»¥ä¸Šï¼šé€šè¿‡ <a href="./yii-db-activerecord.html">yii\db\ActiveRecord</a></li>
<li>Sphnixï¼šé€šè¿‡ <a href="./yii-sphinx-activerecord.html">yii\sphinx\ActiveRecord</a>ï¼Œéœ€æ±‚ <code>yii2-sphinx</code> æ‰©å±•</li>
<li>ElasticSearchï¼šé€šè¿‡ <a href="./yii-elasticsearch-activerecord.html">yii\elasticsearch\ActiveRecord</a>ï¼Œéœ€æ±‚ <code>yii2-elasticsearch</code> æ‰©å±•</li>
<li>Redis 2.6.12 åŠä»¥ä¸Šï¼šé€šè¿‡ <a href="./yii-redis-activerecord.html">yii\redis\ActiveRecord</a>ï¼Œéœ€æ±‚ <code>yii2-redis</code> æ‰©å±•</li>
<li>MongoDB 1.3.0 åŠä»¥ä¸Šï¼šé€šè¿‡ <a href="./yii-mongodb-activerecord.html">yii\mongodb\ActiveRecord</a>ï¼Œéœ€æ±‚ <code>yii2-mongodb</code> æ‰©å±•</li>
</ul>
<p>å¦‚ä½ æ‰€è§ï¼ŒYii ä¸ä»
æä¾›äº†å¯¹å
³ç³»å‹æ•°æ®åº“çš„ AR æ”¯æŒï¼Œè¿˜æä¾›äº† NoSQL æ•°æ®åº“çš„æ”¯æŒã€‚
åœ¨è¿™ä¸ªæ•™ç¨‹ä¸­ï¼Œæˆ‘ä»¬ä¼šä¸»è¦æè¿°å¯¹å
³ç³»å‹æ•°æ®åº“çš„ AR ç”¨æ³•ã€‚
ç„¶è€Œï¼Œç»å¤§å¤šæ•°çš„å†
å®¹åœ¨ NoSQL çš„ AR é‡ŒåŒæ ·é€‚ç”¨ã€‚</p>
<h2>å£°æ˜ AR ç±» <a href="#ar" name="ar" class="hashlink">&para;</a></h2><p>è¦æƒ³å£°æ˜ä¸€ä¸ª AR ç±»ï¼Œä½ éœ€è¦æ‰©å±• <a href="./yii-db-activerecord.html">yii\db\ActiveRecord</a> åŸºç±»ï¼Œ
å¹¶å®ç° <code>tableName</code> æ–¹æ³•ï¼Œè¿”å›ä¸ä¹‹ç›¸å
³è”çš„çš„æ•°æ®è¡¨çš„åç§°ï¼š</p>
<pre><code class="language-php"><span style="color: #0000BB"></span><span style="color: #007700">namespace&nbsp;</span><span style="color: #0000BB">app</span><span style="color: #007700">\</span><span style="color: #0000BB">models</span><span style="color: #007700">;<br /><br />use&nbsp;</span><span style="color: #0000BB">yii</span><span style="color: #007700">\</span><span style="color: #0000BB">db</span><span style="color: #007700">\</span><span style="color: #0000BB">ActiveRecord</span><span style="color: #007700">;<br /><br />class&nbsp;</span><span style="color: #0000BB">Customer&nbsp;</span><span style="color: #007700">extends&nbsp;</span><span style="color: #0000BB">ActiveRecord<br /></span><span style="color: #007700">{<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">/**<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@return&nbsp;string&nbsp;è¿”å›è¯¥ARç±»å<br />³è”çš„æ•°æ®è¡¨å<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">public&nbsp;static&nbsp;function&nbsp;</span><span style="color: #0000BB">tableName</span><span style="color: #007700">()<br />&nbsp;&nbsp;&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;</span><span style="color: #DD0000">'customer'</span><span style="color: #007700">;<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br />}</span></code></pre>
<h2>è®¿é—®åˆ—æ•°æ® <a href="#" name="" class="hashlink">&para;</a></h2><p>AR æŠŠç›¸åº”æ•°æ®è¡Œçš„æ¯ä¸€ä¸ªå­—æ®µæ˜ å°„ä¸º AR å¯¹è±¡çš„ä¸€ä¸ªä¸ªç‰¹æ€§å˜é‡ï¼ˆAttributeï¼‰
ä¸€ä¸ªç‰¹æ€§å°±å¥½åƒä¸€ä¸ªæ™®é€šå¯¹è±¡çš„å
¬å
±å±æ€§ä¸€æ ·ï¼ˆpublic propertyï¼‰ã€‚
ç‰¹æ€§å˜é‡çš„åç§°å’Œå¯¹åº”å­—æ®µçš„åç§°æ˜¯ä¸€æ ·çš„ï¼Œä¸”å¤§å°å§“åã€‚</p>
<p>ä½¿ç”¨ä»¥ä¸‹è¯­æ³•è¯»å–åˆ—çš„å€¼ï¼š</p>
<pre><code class="language-php"><span style="color: #0000BB"></span><span style="color: #FF8000">//&nbsp;"id"&nbsp;å’Œ&nbsp;"mail"&nbsp;æ˜¯&nbsp;$customer&nbsp;å¯¹è±¡æ‰€å<br /></span><span style="color: #0000BB">³è”çš„æ•°æ®è¡¨çš„å¯¹åº”å­—æ®µå<br />$id&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$customer</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">id</span><span style="color: #007700">;<br /></span><span style="color: #0000BB">$email&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$customer</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">email</span><span style="color: #007700">;</span></code></pre>
<p>è¦æ”¹å˜åˆ—å€¼ï¼Œåªè¦ç»™å
³è”å±æ€§èµ‹æ–°å€¼å¹¶ä¿å­˜å¯¹è±¡å³å¯ï¼š</p>
<pre><code class="language-php"><span style="color: #0000BB">$customer</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">email&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #DD0000">'å“ªå’@example.com'</span><span style="color: #007700">;<br /></span><span style="color: #0000BB">$customer</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">save</span><span style="color: #007700">();</span></code></pre>
<h2>å»ºç«‹æ•°æ®åº“è¿æ¥ <a href="#" name="" class="hashlink">&para;</a></h2><p>AR ç”¨ä¸€ä¸ª <a href="./yii-db-connection.html">DB connection</a> å¯¹è±¡ä¸æ•°æ®åº“äº¤æ¢æ•°æ®ã€‚
é»˜è®¤çš„ï¼Œå®ƒä½¿ç”¨ <code>db</code> ç»„ä»¶ä½œä¸ºå
¶è¿æ¥å¯¹è±¡ã€‚è¯¦è§<a href="guide-database-basics.html">æ•°æ®åº“åŸºç¡€</a>ç« èŠ‚ï¼Œ
ä½ å¯ä»¥åœ¨åº”ç”¨ç¨‹åºé
ç½®æ–‡ä»¶ä¸­è®¾ç½®ä¸‹ <code>db</code> ç»„ä»¶ï¼Œå°±åƒè¿™æ ·ï¼Œ</p>
<pre><code class="language-php"><span style="color: #0000BB"></span><span style="color: #007700">return&nbsp;[<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #DD0000">'components'&nbsp;</span><span style="color: #007700">=&gt;&nbsp;[<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #DD0000">'db'&nbsp;</span><span style="color: #007700">=&gt;&nbsp;[<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #DD0000">'class'&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #DD0000">'yii\db\Connection'</span><span style="color: #007700">,<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #DD0000">'dsn'&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #DD0000">'mysql:host=localhost;dbname=testdb'</span><span style="color: #007700">,<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #DD0000">'username'&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #DD0000">'demo'</span><span style="color: #007700">,<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #DD0000">'password'&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #DD0000">'demo'</span><span style="color: #007700">,<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;],<br />&nbsp;&nbsp;&nbsp;&nbsp;],<br />];</span></code></pre>
<p>å¦‚æœåœ¨ä½ çš„åº”ç”¨ä¸­åº”ç”¨äº†ä¸æ­¢ä¸€ä¸ªæ•°æ®åº“ï¼Œä¸”ä½ éœ€è¦ç»™ä½ çš„ AR ç±»ä½¿ç”¨ä¸åŒçš„æ•°æ®åº“é“¾æ¥ï¼ˆDB connectionï¼‰
ï¼Œä½ å¯ä»¥è¦†ç›–æ‰ <a href="./yii-db-activerecord.html#getDb()-detail">getDb()</a> æ–¹æ³•ï¼š</p>
<pre><code class="language-php"><span style="color: #0000BB"></span><span style="color: #007700">class&nbsp;</span><span style="color: #0000BB">Customer&nbsp;</span><span style="color: #007700">extends&nbsp;</span><span style="color: #0000BB">ActiveRecord<br /></span><span style="color: #007700">{<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">//&nbsp;...<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">public&nbsp;static&nbsp;function&nbsp;</span><span style="color: #0000BB">getDb</span><span style="color: #007700">()<br />&nbsp;&nbsp;&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;\</span><span style="color: #0000BB">Yii</span><span style="color: #007700">::</span><span style="color: #0000BB">$app</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">db2</span><span style="color: #007700">;&nbsp;&nbsp;</span><span style="color: #FF8000">//&nbsp;ä½¿ç”¨åä¸º&nbsp;"db2"&nbsp;çš„åº”ç”¨ç»„ä»¶<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">}<br />}</span></code></pre>
<h2>æŸ¥è¯¢æ•°æ® <a href="#" name="" class="hashlink">&para;</a></h2><p>AR æä¾›äº†ä¸¤ç§æ–¹æ³•æ¥æ„å»º DB æŸ¥è¯¢å¹¶å‘ AR å®ä¾‹é‡Œå¡«å</p>
<p>æ•°æ®ï¼š</p>
<ul>
<li><a href="./yii-db-activerecord.html#find()-detail">yii\db\ActiveRecord::find()</a></li>
<li><a href="./yii-db-activerecord.html#findBySql()-detail">yii\db\ActiveRecord::findBySql()</a></li>
</ul>
<p>ä»¥ä¸Šä¸¤ä¸ªæ–¹æ³•éƒ½ä¼šè¿”å› <a href="./yii-db-activequery.html">yii\db\ActiveQuery</a> å®ä¾‹ï¼Œè¯¥ç±»ç»§æ‰¿è‡ª<a href="./yii-db-query.html">yii\db\Query</a>ï¼Œ
å› æ­¤ï¼Œä»–ä»¬éƒ½æ”¯æŒåŒä¸€å¥—çµæ´»ä¸”å¼ºå¤§çš„ DB æŸ¥è¯¢æ–¹æ³•ï¼Œå¦‚ <code>where()</code>ï¼Œ<code>join()</code>ï¼Œ<code>orderBy()</code>ï¼Œç­‰ç­‰ã€‚ 
ä¸‹é¢çš„è¿™äº›æ¡ˆä¾‹å±•ç¤ºäº†ä¸€äº›å¯èƒ½çš„ç©æ³•ï¼š</p>
<pre><code class="language-php"><span style="color: #0000BB"></span><span style="color: #FF8000">//&nbsp;å–å›æ‰€æœ‰æ´»è·ƒå®¢æˆ·(çŠ¶æ€ä¸º&nbsp;*active*&nbsp;çš„å®¢æˆ·ï¼‰å¹¶ä»¥ä»–ä»¬çš„&nbsp;ID&nbsp;æ’åºï¼š<br /></span><span style="color: #0000BB">$customers&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">Customer</span><span style="color: #007700">::</span><span style="color: #0000BB">find</span><span style="color: #007700">()<br />&nbsp;&nbsp;&nbsp;&nbsp;-&gt;</span><span style="color: #0000BB">where</span><span style="color: #007700">([</span><span style="color: #DD0000">'status'&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #0000BB">Customer</span><span style="color: #007700">::</span><span style="color: #0000BB">STATUS_ACTIVE</span><span style="color: #007700">])<br />&nbsp;&nbsp;&nbsp;&nbsp;-&gt;</span><span style="color: #0000BB">orderBy</span><span style="color: #007700">(</span><span style="color: #DD0000">'id'</span><span style="color: #007700">)<br />&nbsp;&nbsp;&nbsp;&nbsp;-&gt;</span><span style="color: #0000BB">all</span><span style="color: #007700">();<br /><br /></span><span style="color: #FF8000">//&nbsp;è¿”å›IDä¸º1çš„å®¢æˆ·ï¼š<br /></span><span style="color: #0000BB">$customer&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">Customer</span><span style="color: #007700">::</span><span style="color: #0000BB">find</span><span style="color: #007700">()<br />&nbsp;&nbsp;&nbsp;&nbsp;-&gt;</span><span style="color: #0000BB">where</span><span style="color: #007700">([</span><span style="color: #DD0000">'id'&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #0000BB">1</span><span style="color: #007700">])<br />&nbsp;&nbsp;&nbsp;&nbsp;-&gt;</span><span style="color: #0000BB">one</span><span style="color: #007700">();<br /><br /></span><span style="color: #FF8000">//&nbsp;å–å›æ´»è·ƒå®¢æˆ·çš„æ•°é‡ï¼š<br /></span><span style="color: #0000BB">$count&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">Customer</span><span style="color: #007700">::</span><span style="color: #0000BB">find</span><span style="color: #007700">()<br />&nbsp;&nbsp;&nbsp;&nbsp;-&gt;</span><span style="color: #0000BB">where</span><span style="color: #007700">([</span><span style="color: #DD0000">'status'&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #0000BB">Customer</span><span style="color: #007700">::</span><span style="color: #0000BB">STATUS_ACTIVE</span><span style="color: #007700">])<br />&nbsp;&nbsp;&nbsp;&nbsp;-&gt;</span><span style="color: #0000BB">count</span><span style="color: #007700">();<br /><br /></span><span style="color: #FF8000">//&nbsp;ä»¥å®¢æˆ·IDç´¢å¼•ç»“æœé›†ï¼š<br /></span><span style="color: #0000BB">$customers&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">Customer</span><span style="color: #007700">::</span><span style="color: #0000BB">find</span><span style="color: #007700">()-&gt;</span><span style="color: #0000BB">indexBy</span><span style="color: #007700">(</span><span style="color: #DD0000">'id'</span><span style="color: #007700">)-&gt;</span><span style="color: #0000BB">all</span><span style="color: #007700">();<br /></span><span style="color: #FF8000">//&nbsp;$customers&nbsp;æ•°ç»„ä»¥&nbsp;ID&nbsp;ä¸ºç´¢å¼•<br /><br />//&nbsp;ç”¨åŸç”Ÿ&nbsp;SQL&nbsp;è¯­å¥æ£€ç´¢å®¢æˆ·ï¼š<br /></span><span style="color: #0000BB">$sql&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #DD0000">'SELECT&nbsp;*&nbsp;FROM&nbsp;customer'</span><span style="color: #007700">;<br /></span><span style="color: #0000BB">$customers&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">Customer</span><span style="color: #007700">::</span><span style="color: #0000BB">findBySql</span><span style="color: #007700">(</span><span style="color: #0000BB">$sql</span><span style="color: #007700">)-&gt;</span><span style="color: #0000BB">all</span><span style="color: #007700">();</span></code></pre>
<blockquote><p>å°æŠ€å·§ï¼šåœ¨ä¸Šé¢çš„ä»£ç ä¸­ï¼Œ<code>Customer::STATUS_ACTIVE</code> æ˜¯ä¸€ä¸ªåœ¨ <code>Customer</code> ç±»é‡Œå®šä¹‰çš„å¸¸é‡ã€‚ï¼ˆè¯‘è€
æ³¨ï¼šè¿™ç§å¸¸é‡çš„å€¼ä¸€èˆ¬éƒ½æ˜¯tinyintï¼‰ç›¸è¾ƒäºç›´æ¥åœ¨ä»£ç ä¸­å†™æ­»å­—ç¬¦ä¸²æˆ–æ•°å­—ï¼Œä½¿ç”¨ä¸€ä¸ªæ›´æœ‰æ„ä¹‰çš„å¸¸é‡åç§°æ˜¯ä¸€ç§æ›´å¥½çš„ç¼–ç¨‹ä¹ æƒ¯ã€‚</p>
</blockquote>
<p>æœ‰ä¸¤ä¸ªå¿«æ·æ–¹æ³•ï¼š<code>findOne</code> å’Œ <code>findAll()</code> ç”¨æ¥è¿”å›ä¸€ä¸ªæˆ–è€
ä¸€ç»„<code>ActiveRecord</code>å®ä¾‹ã€‚å‰è€
è¿”å›ç¬¬ä¸€ä¸ªåŒ¹é
åˆ°çš„å®ä¾‹ï¼Œåè€
è¿”å›æ‰€æœ‰ã€‚
ä¾‹å¦‚ï¼š</p>
<pre><code class="language-php"><span style="color: #0000BB"></span><span style="color: #FF8000">//&nbsp;è¿”å›&nbsp;id&nbsp;ä¸º&nbsp;1&nbsp;çš„å®¢æˆ·<br /></span><span style="color: #0000BB">$customer&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">Customer</span><span style="color: #007700">::</span><span style="color: #0000BB">findOne</span><span style="color: #007700">(</span><span style="color: #0000BB">1</span><span style="color: #007700">);<br /><br /></span><span style="color: #FF8000">//&nbsp;è¿”å›&nbsp;id&nbsp;ä¸º&nbsp;1&nbsp;ä¸”çŠ¶æ€ä¸º&nbsp;*active*&nbsp;çš„å®¢æˆ·<br /></span><span style="color: #0000BB">$customer&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">Customer</span><span style="color: #007700">::</span><span style="color: #0000BB">findOne</span><span style="color: #007700">([<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #DD0000">'id'&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #0000BB">1</span><span style="color: #007700">,<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #DD0000">'status'&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #0000BB">Customer</span><span style="color: #007700">::</span><span style="color: #0000BB">STATUS_ACTIVE</span><span style="color: #007700">,<br />]);<br /><br /></span><span style="color: #FF8000">//&nbsp;è¿”å›idä¸º1ã€2ã€3çš„ä¸€ç»„å®¢æˆ·<br /></span><span style="color: #0000BB">$customers&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">Customer</span><span style="color: #007700">::</span><span style="color: #0000BB">findAll</span><span style="color: #007700">([</span><span style="color: #0000BB">1</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">2</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">3</span><span style="color: #007700">]);<br /><br /></span><span style="color: #FF8000">//&nbsp;è¿”å›æ‰€æœ‰çŠ¶æ€ä¸º&nbsp;"deleted"&nbsp;çš„å®¢æˆ·<br /></span><span style="color: #0000BB">$customer&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">Customer</span><span style="color: #007700">::</span><span style="color: #0000BB">findAll</span><span style="color: #007700">([<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #DD0000">'status'&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #0000BB">Customer</span><span style="color: #007700">::</span><span style="color: #0000BB">STATUS_DELETED</span><span style="color: #007700">,<br />]);</span></code></pre>
<h3>ä»¥æ•°ç»„å½¢å¼è·å–æ•°æ® <a href="#" name="" class="hashlink">&para;</a></h3><p>æœ‰æ—¶å€™ï¼Œæˆ‘ä»¬éœ€è¦å¤„ç†å¾ˆå¤§é‡çš„æ•°æ®ï¼Œè¿™æ—¶å¯èƒ½éœ€è¦ç”¨ä¸€ä¸ªæ•°ç»„æ¥å­˜å‚¨å–åˆ°çš„æ•°æ®ï¼Œ
ä»è€ŒèŠ‚çœå†
å­˜ã€‚ä½ å¯ä»¥ç”¨ <code>asArray()</code> å‡½æ•°åšåˆ°è¿™ä¸€ç‚¹ï¼š</p>
<pre><code class="language-php"><span style="color: #0000BB"></span><span style="color: #FF8000">//&nbsp;ä»¥æ•°ç»„è€Œä¸æ˜¯å¯¹è±¡å½¢å¼å–å›å®¢æˆ·ä¿¡æ¯ï¼š<br /></span><span style="color: #0000BB">$customers&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">Customer</span><span style="color: #007700">::</span><span style="color: #0000BB">find</span><span style="color: #007700">()<br />&nbsp;&nbsp;&nbsp;&nbsp;-&gt;</span><span style="color: #0000BB">asArray</span><span style="color: #007700">()<br />&nbsp;&nbsp;&nbsp;&nbsp;-&gt;</span><span style="color: #0000BB">all</span><span style="color: #007700">();<br /></span><span style="color: #FF8000">//&nbsp;$customers&nbsp;çš„æ¯ä¸ªå<br /></span><span style="color: #0000BB">ƒç´ éƒ½æ˜¯é”®å€¼å¯¹æ•°ç»„</span></code></pre>
<h3>æ‰¹é‡è·å–æ•°æ® <a href="#" name="" class="hashlink">&para;</a></h3><p>åœ¨ <a href="guide-query-builder.html">Query Builderï¼ˆæŸ¥è¯¢æ„é€ å™¨ï¼‰</a> é‡Œï¼Œæˆ‘ä»¬å·²ç»è§£é‡Šäº†å½“éœ€è¦ä»æ•°æ®åº“ä¸­æŸ¥è¯¢å¤§é‡æ•°æ®æ—¶ï¼Œä½ å¯ä»¥ç”¨ <em>batch queryï¼ˆæ‰¹é‡æŸ¥è¯¢ï¼‰</em>æ¥é™åˆ¶å†
å­˜çš„å ç”¨ã€‚
ä½ å¯èƒ½ä¹Ÿæƒ³åœ¨ AR é‡Œä½¿ç”¨ç›¸åŒçš„æŠ€å·§ï¼Œæ¯”å¦‚è¿™æ ·â€¦â€¦</p>
<pre><code class="language-php"><span style="color: #0000BB"></span><span style="color: #FF8000">//&nbsp;ä¸€æ¬¡æå–&nbsp;10&nbsp;ä¸ªå®¢æˆ·ä¿¡æ¯<br /></span><span style="color: #007700">foreach&nbsp;(</span><span style="color: #0000BB">Customer</span><span style="color: #007700">::</span><span style="color: #0000BB">find</span><span style="color: #007700">()-&gt;</span><span style="color: #0000BB">batch</span><span style="color: #007700">(</span><span style="color: #0000BB">10</span><span style="color: #007700">)&nbsp;as&nbsp;</span><span style="color: #0000BB">$customers</span><span style="color: #007700">)&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">//&nbsp;$customers&nbsp;æ˜¯&nbsp;10&nbsp;ä¸ªæˆ–æ›´å°‘çš„å®¢æˆ·å¯¹è±¡çš„æ•°ç»„<br /></span><span style="color: #007700">}<br /></span><span style="color: #FF8000">//&nbsp;ä¸€æ¬¡æå–&nbsp;10&nbsp;ä¸ªå®¢æˆ·å¹¶ä¸€ä¸ªä¸€ä¸ªåœ°éå†å¤„ç†<br /></span><span style="color: #007700">foreach&nbsp;(</span><span style="color: #0000BB">Customer</span><span style="color: #007700">::</span><span style="color: #0000BB">find</span><span style="color: #007700">()-&gt;</span><span style="color: #0000BB">each</span><span style="color: #007700">(</span><span style="color: #0000BB">10</span><span style="color: #007700">)&nbsp;as&nbsp;</span><span style="color: #0000BB">$customer</span><span style="color: #007700">)&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">//&nbsp;$customer&nbsp;æ˜¯ä¸€ä¸ª&nbsp;â€Customerâ€œ&nbsp;å¯¹è±¡<br /></span><span style="color: #007700">}<br /></span><span style="color: #FF8000">//&nbsp;è´ªå©ªåŠ è½½æ¨¡å¼çš„æ‰¹å¤„ç†æŸ¥è¯¢<br /></span><span style="color: #007700">foreach&nbsp;(</span><span style="color: #0000BB">Customer</span><span style="color: #007700">::</span><span style="color: #0000BB">find</span><span style="color: #007700">()-&gt;</span><span style="color: #0000BB">with</span><span style="color: #007700">(</span><span style="color: #DD0000">'orders'</span><span style="color: #007700">)-&gt;</span><span style="color: #0000BB">each</span><span style="color: #007700">()&nbsp;as&nbsp;</span><span style="color: #0000BB">$customer</span><span style="color: #007700">)&nbsp;{<br />}</span></code></pre>
<h2>æ“ä½œæ•°æ® <a href="#" name="" class="hashlink">&para;</a></h2><p>AR æä¾›ä»¥ä¸‹æ–¹æ³•æ’å
¥ã€æ›´æ–°å’Œåˆ é™¤ä¸ AR å¯¹è±¡å
³è”çš„é‚£å¼ è¡¨ä¸­çš„æŸä¸€è¡Œï¼š</p>
<ul>
<li><a href="./yii-db-baseactiverecord.html#save()-detail">save()</a></li>
<li><a href="./yii-db-activerecord.html#insert()-detail">insert()</a></li>
<li><a href="./yii-db-activerecord.html#update()-detail">update()</a></li>
<li><a href="./yii-db-activerecord.html#delete()-detail">delete()</a></li>
</ul>
<p>AR åŒæ—¶æä¾›äº†ä¸€ä¸‹é™æ€æ–¹æ³•ï¼Œå¯ä»¥åº”ç”¨åœ¨ä¸æŸ AR ç±»æ‰€å
³è”çš„æ•´å¼ è¡¨ä¸Šã€‚
ç”¨è¿™äº›æ–¹æ³•çš„æ—¶å€™åƒä¸‡è¦å°å¿ƒï¼Œå› ä¸ºä»–ä»¬ä½œç”¨äºæ•´å¼ è¡¨ï¼
æ¯”å¦‚ï¼Œ<code>deleteAll()</code>  ä¼šåˆ é™¤æ‰è¡¨é‡Œ<strong>æ‰€æœ‰</strong>çš„è®°å½•ã€‚</p>
<ul>
<li><a href="./yii-db-baseactiverecord.html#updateCounters()-detail">updateCounters()</a></li>
<li><a href="./yii-db-activerecord.html#updateAll()-detail">updateAll()</a></li>
<li><a href="./yii-db-activerecord.html#updateAllCounters()-detail">updateAllCounters()</a></li>
<li><a href="./yii-db-activerecord.html#deleteAll()-detail">deleteAll()</a></li>
</ul>
<p>ä¸‹é¢çš„è¿™äº›ä¾‹å­é‡Œï¼Œè¯¦ç»†å±•ç°äº†å¦‚ä½•ä½¿ç”¨è¿™äº›æ–¹æ³•ï¼š</p>
<pre><code class="language-php"><span style="color: #0000BB"></span><span style="color: #FF8000">//&nbsp;æ’å<br /></span><span style="color: #0000BB">¥æ–°å®¢æˆ·çš„è®°å½•<br />$customer&nbsp;</span><span style="color: #007700">=&nbsp;new&nbsp;</span><span style="color: #0000BB">Customer</span><span style="color: #007700">();<br /></span><span style="color: #0000BB">$customer</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">name&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #DD0000">'James'</span><span style="color: #007700">;<br /></span><span style="color: #0000BB">$customer</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">email&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #DD0000">'james@example.com'</span><span style="color: #007700">;<br /></span><span style="color: #0000BB">$customer</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">save</span><span style="color: #007700">();&nbsp;&nbsp;</span><span style="color: #FF8000">//&nbsp;ç­‰åŒäº&nbsp;$customer-&gt;insert();<br /><br />//&nbsp;æ›´æ–°ç°æœ‰å®¢æˆ·è®°å½•<br /></span><span style="color: #0000BB">$customer&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">Customer</span><span style="color: #007700">::</span><span style="color: #0000BB">findOne</span><span style="color: #007700">(</span><span style="color: #0000BB">$id</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">$customer</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">email&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #DD0000">'james@example.com'</span><span style="color: #007700">;<br /></span><span style="color: #0000BB">$customer</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">save</span><span style="color: #007700">();&nbsp;&nbsp;</span><span style="color: #FF8000">//&nbsp;ç­‰åŒäº&nbsp;$customer-&gt;update();<br /><br />//&nbsp;åˆ é™¤å·²æœ‰å®¢æˆ·è®°å½•<br /></span><span style="color: #0000BB">$customer&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">Customer</span><span style="color: #007700">::</span><span style="color: #0000BB">findOne</span><span style="color: #007700">(</span><span style="color: #0000BB">$id</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">$customer</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">delete</span><span style="color: #007700">();<br /><br /></span><span style="color: #FF8000">//&nbsp;åˆ é™¤å¤šä¸ªå¹´é¾„å¤§äº20ï¼Œæ€§åˆ«ä¸ºç”·ï¼ˆMaleï¼‰çš„å®¢æˆ·è®°å½•<br /></span><span style="color: #0000BB">Customer</span><span style="color: #007700">::</span><span style="color: #0000BB">deleteAll</span><span style="color: #007700">(</span><span style="color: #DD0000">'age&nbsp;&gt;&nbsp;:age&nbsp;AND&nbsp;gender&nbsp;=&nbsp;:gender'</span><span style="color: #007700">,&nbsp;[</span><span style="color: #DD0000">':age'&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #0000BB">20</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">':gender'&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #DD0000">'M'</span><span style="color: #007700">]);<br /><br /></span><span style="color: #FF8000">//&nbsp;æ‰€æœ‰å®¢æˆ·çš„ageï¼ˆå¹´é¾„ï¼‰å­—æ®µåŠ 1ï¼š<br /></span><span style="color: #0000BB">Customer</span><span style="color: #007700">::</span><span style="color: #0000BB">updateAllCounters</span><span style="color: #007700">([</span><span style="color: #DD0000">'age'&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #0000BB">1</span><span style="color: #007700">]);</span></code></pre>
<blockquote><p>é¡»çŸ¥ï¼š<code>save()</code> æ–¹æ³•ä¼šè°ƒç”¨ <code>insert()</code> å’Œ <code>update()</code> ä¸­çš„ä¸€ä¸ªï¼Œ
ç”¨å“ªä¸ªå–å†³äºå½“å‰ AR å¯¹è±¡æ˜¯ä¸æ˜¯æ–°å¯¹è±¡ï¼ˆåœ¨å‡½æ•°å†
éƒ¨ï¼Œä»–ä¼šæ£€æŸ¥ <a href="./yii-db-activerecord.html#$isNewRecord-detail">yii\db\ActiveRecord::$isNewRecord</a> çš„å€¼ï¼‰ã€‚
è‹¥ AR å¯¹è±¡æ˜¯ç”± <code>new</code> æ“ä½œç¬¦ åˆå§‹åŒ–å‡ºæ¥çš„ï¼Œ<code>save()</code> æ–¹æ³•ä¼šåœ¨è¡¨é‡Œ<em>æ’å
¥</em>ä¸€æ¡æ•°æ®ï¼›
å¦‚æœä¸€ä¸ª AR æ˜¯ç”± <code>find()</code> æ–¹æ³•è·å–æ¥çš„ï¼Œ
åˆ™ <code>save()</code> ä¼š<em>æ›´æ–°</em>è¡¨é‡Œçš„å¯¹åº”è¡Œè®°å½•ã€‚</p>
</blockquote>
<h3>æ•°æ®è¾“å <a href="#" name="" class="hashlink">&para;</a></h3><p>¥ä¸æœ‰æ•ˆæ€§éªŒè¯</p>
<p>ç”±äºARç»§æ‰¿è‡ª<a href="./yii-base-model.html">yii\base\Model</a>ï¼Œæ‰€ä»¥å®ƒåŒæ ·ä¹Ÿæ”¯æŒ<a href="guide-model.html">Model</a>çš„æ•°æ®è¾“å
¥ã€éªŒè¯ç­‰ç‰¹æ€§ã€‚ä¾‹å¦‚ï¼Œä½ å¯ä»¥å£°æ˜ä¸€ä¸ªrulesæ–¹æ³•ç”¨æ¥è¦†ç›–æ‰<a href="./yii-base-model.html#rules()-detail">rules()</a>é‡Œçš„ï¼›ä½ ä¹Ÿå¯ä»¥ç»™ARå®ä¾‹æ‰¹é‡èµ‹å€¼ï¼›ä½ ä¹Ÿå¯ä»¥é€šè¿‡è°ƒç”¨<a href="./yii-base-model.html#validate()-detail">validate()</a>æ‰§è¡Œæ•°æ®éªŒè¯ã€‚</p>
<p>å½“ä½ è°ƒç”¨ <code>save()</code>ã€<code>insert()</code>ã€<code>update()</code> è¿™ä¸‰ä¸ªæ–¹æ³•æ—¶ï¼Œä¼šè‡ªåŠ¨è°ƒç”¨<a href="./yii-base-model.html#validate()-detail">validate()</a>æ–¹æ³•ã€‚å¦‚æœéªŒè¯å¤±è´¥ï¼Œæ•°æ®å°†ä¸ä¼šä¿å­˜è¿›æ•°æ®åº“ã€‚</p>
<p>ä¸‹é¢çš„ä¾‹å­æ¼”ç¤ºäº†å¦‚ä½•ä½¿ç”¨AR è·å–/éªŒè¯ç”¨æˆ·è¾“å
¥çš„æ•°æ®å¹¶å°†ä»–ä»¬ä¿å­˜è¿›æ•°æ®åº“ï¼š</p>
<pre><code class="language-php"><span style="color: #0000BB"></span><span style="color: #FF8000">//&nbsp;æ–°å»ºä¸€æ¡è®°å½•<br /></span><span style="color: #0000BB">$model&nbsp;</span><span style="color: #007700">=&nbsp;new&nbsp;</span><span style="color: #0000BB">Customer</span><span style="color: #007700">;<br />if&nbsp;(</span><span style="color: #0000BB">$model</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">load</span><span style="color: #007700">(</span><span style="color: #0000BB">Yii</span><span style="color: #007700">::</span><span style="color: #0000BB">$app</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">request</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">post</span><span style="color: #007700">())&nbsp;&amp;&amp;&nbsp;</span><span style="color: #0000BB">$model</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">save</span><span style="color: #007700">())&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">//&nbsp;è·å–ç”¨æˆ·è¾“å<br /></span><span style="color: #0000BB">¥çš„æ•°æ®ï¼ŒéªŒè¯å¹¶ä¿å­˜<br /></span><span style="color: #007700">}<br /><br /></span><span style="color: #FF8000">//&nbsp;æ›´æ–°ä¸»é”®ä¸º$idçš„AR<br /></span><span style="color: #0000BB">$model&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">Customer</span><span style="color: #007700">::</span><span style="color: #0000BB">findOne</span><span style="color: #007700">(</span><span style="color: #0000BB">$id</span><span style="color: #007700">);<br />if&nbsp;(</span><span style="color: #0000BB">$model&nbsp;</span><span style="color: #007700">===&nbsp;</span><span style="color: #0000BB">null</span><span style="color: #007700">)&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;throw&nbsp;new&nbsp;</span><span style="color: #0000BB">NotFoundHttpException</span><span style="color: #007700">;<br />}<br />if&nbsp;(</span><span style="color: #0000BB">$model</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">load</span><span style="color: #007700">(</span><span style="color: #0000BB">Yii</span><span style="color: #007700">::</span><span style="color: #0000BB">$app</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">request</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">post</span><span style="color: #007700">())&nbsp;&amp;&amp;&nbsp;</span><span style="color: #0000BB">$model</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">save</span><span style="color: #007700">())&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">//&nbsp;è·å–ç”¨æˆ·è¾“å<br /></span><span style="color: #0000BB">¥çš„æ•°æ®ï¼ŒéªŒè¯å¹¶ä¿å­˜<br /></span><span style="color: #007700">}</span></code></pre>
<h3>è¯»å–é»˜è®¤å€¼ <a href="#" name="" class="hashlink">&para;</a></h3><p>ä½ çš„è¡¨åˆ—ä¹Ÿè®¸å®šä¹‰äº†é»˜è®¤å€¼ã€‚æœ‰æ—¶å€™ï¼Œä½ å¯èƒ½éœ€è¦åœ¨ä½¿ç”¨webè¡¨å•çš„æ—¶å€™ç»™ARé¢„è®¾ä¸€äº›å€¼ã€‚å¦‚æœä½ éœ€è¦è¿™æ ·åšï¼Œå¯ä»¥åœ¨æ˜¾ç¤ºè¡¨å•å†
å®¹å‰é€šè¿‡è°ƒç”¨<code>loadDefaultValues()</code>æ–¹æ³•æ¥å®ç°ï¼š
<code>`</code>php
$customer = new Customer();
$customer-&gt;loadDefaultValues();
// ... æ¸²æŸ“ $customer çš„ HTML è¡¨å• ...
<code>`</code></p>
<h2>ARçš„ç”Ÿå‘½å‘¨æœŸ <a href="#ar" name="ar" class="hashlink">&para;</a></h2><p>ç†è§£ARçš„ç”Ÿå‘½å‘¨æœŸå¯¹äºä½ æ“ä½œæ•°æ®åº“éå¸¸é‡è¦ã€‚ç”Ÿå‘½å‘¨æœŸé€šå¸¸éƒ½ä¼šæœ‰äº›å
¸å‹çš„äº‹ä»¶å­˜åœ¨ã€‚å¯¹äºå¼€å‘ARçš„behaviorsæ¥è¯´éå¸¸æœ‰ç”¨ã€‚</p>
<p>å½“ä½ å®ä¾‹åŒ–ä¸€ä¸ªæ–°çš„ARå¯¹è±¡æ—¶ï¼Œæˆ‘ä»¬å°†è·å¾—å¦‚ä¸‹çš„ç”Ÿå‘½å‘¨æœŸï¼š</p>
<ol>
<li>constructor</li>
<li><a href="./yii-db-baseactiverecord.html#init()-detail">init()</a>: ä¼šè§¦å‘ä¸€ä¸ª <a href="./yii-db-baseactiverecord.html#EVENT_INIT-detail">EVENT_INIT</a> äº‹ä»¶</li>
</ol>
<p>å½“ä½ é€šè¿‡ <a href="./yii-db-activerecord.html#find()-detail">find()</a> æ–¹æ³•æŸ¥è¯¢æ•°æ®æ—¶ï¼Œæ¯ä¸ªARå®ä¾‹éƒ½å°†æœ‰ä»¥ä¸‹ç”Ÿå‘½å‘¨æœŸï¼š</p>
<ol>
<li>constructor</li>
<li><a href="./yii-db-baseactiverecord.html#init()-detail">init()</a>: ä¼šè§¦å‘ä¸€ä¸ª <a href="./yii-db-baseactiverecord.html#EVENT_INIT-detail">EVENT_INIT</a> äº‹ä»¶</li>
<li><a href="./yii-db-baseactiverecord.html#afterFind()-detail">afterFind()</a>: ä¼šè§¦å‘ä¸€ä¸ª <a href="./yii-db-baseactiverecord.html#EVENT_AFTER_FIND-detail">EVENT_AFTER_FIND</a> äº‹ä»¶</li>
</ol>
<p>å½“é€šè¿‡ <a href="./yii-db-baseactiverecord.html#save()-detail">save()</a> æ–¹æ³•å†™å
¥æˆ–è€
æ›´æ–°æ•°æ®æ—¶, æˆ‘ä»¬å°†è·å¾—å¦‚ä¸‹ç”Ÿå‘½å‘¨æœŸï¼š</p>
<ol>
<li><a href="./yii-base-model.html#beforeValidate()-detail">beforeValidate()</a>: ä¼šè§¦å‘ä¸€ä¸ª <a href="./yii-base-model.html#EVENT_BEFORE_VALIDATE-detail">EVENT_BEFORE_VALIDATE</a> äº‹ä»¶</li>
<li><a href="./yii-base-model.html#afterValidate()-detail">afterValidate()</a>: ä¼šè§¦å‘ä¸€ä¸ª <a href="./yii-base-model.html#EVENT_AFTER_VALIDATE-detail">EVENT_AFTER_VALIDATE</a> äº‹ä»¶</li>
<li><a href="./yii-db-baseactiverecord.html#beforeSave()-detail">beforeSave()</a>: ä¼šè§¦å‘ä¸€ä¸ª <a href="./yii-db-baseactiverecord.html#EVENT_BEFORE_INSERT-detail">EVENT_BEFORE_INSERT</a> æˆ– <a href="./yii-db-baseactiverecord.html#EVENT_BEFORE_UPDATE-detail">EVENT_BEFORE_UPDATE</a> äº‹ä»¶</li>
<li>æ‰§è¡Œå®é™
çš„æ•°æ®å†™å
¥æˆ–æ›´æ–°</li>
<li><a href="./yii-db-baseactiverecord.html#afterSave()-detail">afterSave()</a>: ä¼šè§¦å‘ä¸€ä¸ª <a href="./yii-db-baseactiverecord.html#EVENT_AFTER_INSERT-detail">EVENT_AFTER_INSERT</a> æˆ– <a href="./yii-db-baseactiverecord.html#EVENT_AFTER_UPDATE-detail">EVENT_AFTER_UPDATE</a> äº‹ä»¶</li>
</ol>
<p>æœ€åï¼Œå½“è°ƒç”¨ <a href="./yii-db-activerecord.html#delete()-detail">delete()</a> åˆ é™¤æ•°æ®æ—¶, æˆ‘ä»¬å°†è·å¾—å¦‚ä¸‹ç”Ÿå‘½å‘¨æœŸï¼š</p>
<ol>
<li><a href="./yii-db-baseactiverecord.html#beforeDelete()-detail">beforeDelete()</a>: ä¼šè§¦å‘ä¸€ä¸ª <a href="./yii-db-baseactiverecord.html#EVENT_BEFORE_DELETE-detail">EVENT_BEFORE_DELETE</a> äº‹ä»¶</li>
<li>æ‰§è¡Œå®é™
çš„æ•°æ®åˆ é™¤</li>
<li><a href="./yii-db-baseactiverecord.html#afterDelete()-detail">afterDelete()</a>: ä¼šè§¦å‘ä¸€ä¸ª <a href="./yii-db-baseactiverecord.html#EVENT_AFTER_DELETE-detail">EVENT_AFTER_DELETE</a> äº‹ä»¶</li>
</ol>
<p>æŸ¥è¯¢å</p>
<h2>³è”çš„æ•°æ® <a href="#" name="" class="hashlink">&para;</a></h2><p>ä½¿ç”¨ AR æ–¹æ³•ä¹Ÿå¯ä»¥æŸ¥è¯¢æ•°æ®è¡¨çš„å
³è”æ•°æ®ï¼ˆå¦‚ï¼Œé€‰å‡ºè¡¨Açš„æ•°æ®å¯ä»¥æ‹‰å‡ºè¡¨Bçš„å
³è”æ•°æ®ï¼‰ã€‚
æœ‰äº† ARï¼Œ
è¿”å›çš„å
³è”æ•°æ®è¿æ¥å°±åƒè¿æ¥å
³è”ä¸»è¡¨çš„ AR å¯¹è±¡çš„å±æ€§ä¸€æ ·ã€‚</p>
<p>å»ºç«‹å
³è”å
³ç³»åï¼Œé€šè¿‡ <code>$customer-&gt;orders</code> å¯ä»¥è·å–
ä¸€ä¸ª <code>Order</code> å¯¹è±¡çš„æ•°ç»„ï¼Œè¯¥æ•°ç»„ä»£è¡¨å½“å‰å®¢æˆ·å¯¹è±¡çš„è®¢å•é›†ã€‚</p>
<p>å®šä¹‰å
³è”å
³ç³»ä½¿ç”¨ä¸€ä¸ªå¯ä»¥è¿”å› <a href="./yii-db-activequery.html">yii\db\ActiveQuery</a> å¯¹è±¡çš„ getter æ–¹æ³•ï¼Œ
<a href="./yii-db-activequery.html">yii\db\ActiveQuery</a>å¯¹è±¡æœ‰å
³è”ä¸Šä¸‹æ–‡çš„ç›¸å
³ä¿¡æ¯ï¼Œå› æ­¤å¯ä»¥åªæŸ¥è¯¢å
³è”æ•°æ®ã€‚</p>
<p>ä¾‹å¦‚ï¼š</p>
<pre><code class="language-php"><span style="color: #0000BB"></span><span style="color: #007700">class&nbsp;</span><span style="color: #0000BB">Customer&nbsp;</span><span style="color: #007700">extends&nbsp;\</span><span style="color: #0000BB">yii</span><span style="color: #007700">\</span><span style="color: #0000BB">db</span><span style="color: #007700">\</span><span style="color: #0000BB">ActiveRecord<br /></span><span style="color: #007700">{<br />&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;function&nbsp;</span><span style="color: #0000BB">getOrders</span><span style="color: #007700">()<br />&nbsp;&nbsp;&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">//&nbsp;å®¢æˆ·å’Œè®¢å•é€šè¿‡&nbsp;Order.customer_id&nbsp;-&gt;&nbsp;id&nbsp;å<br /></span><span style="color: #0000BB">³è”å»ºç«‹ä¸€å¯¹å¤šå<br />³ç³»<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">return&nbsp;</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">hasMany</span><span style="color: #007700">(</span><span style="color: #0000BB">Order</span><span style="color: #007700">::</span><span style="color: #0000BB">className</span><span style="color: #007700">(),&nbsp;[</span><span style="color: #DD0000">'customer_id'&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #DD0000">'id'</span><span style="color: #007700">]);<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br />}<br /><br />class&nbsp;</span><span style="color: #0000BB">Order&nbsp;</span><span style="color: #007700">extends&nbsp;\</span><span style="color: #0000BB">yii</span><span style="color: #007700">\</span><span style="color: #0000BB">db</span><span style="color: #007700">\</span><span style="color: #0000BB">ActiveRecord<br /></span><span style="color: #007700">{<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">//&nbsp;è®¢å•å’Œå®¢æˆ·é€šè¿‡&nbsp;Customer.id&nbsp;-&gt;&nbsp;customer_id&nbsp;å<br /></span><span style="color: #0000BB">³è”å»ºç«‹ä¸€å¯¹ä¸€å<br />³ç³»<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">public&nbsp;function&nbsp;</span><span style="color: #0000BB">getCustomer</span><span style="color: #007700">()<br />&nbsp;&nbsp;&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">hasOne</span><span style="color: #007700">(</span><span style="color: #0000BB">Customer</span><span style="color: #007700">::</span><span style="color: #0000BB">className</span><span style="color: #007700">(),&nbsp;[</span><span style="color: #DD0000">'id'&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #DD0000">'customer_id'</span><span style="color: #007700">]);<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br />}</span></code></pre>
<p>ä»¥ä¸Šä½¿ç”¨äº† <a href="./yii-db-baseactiverecord.html#hasMany()-detail">yii\db\ActiveRecord::hasMany()</a> å’Œ <a href="./yii-db-baseactiverecord.html#hasOne()-detail">yii\db\ActiveRecord::hasOne()</a> æ–¹æ³•ã€‚
ä»¥ä¸Šä¸¤ä¾‹åˆ†åˆ«æ˜¯å
³è”æ•°æ®å¤šå¯¹ä¸€å
³ç³»å’Œä¸€å¯¹ä¸€å
³ç³»çš„å»ºæ¨¡èŒƒä¾‹ã€‚
å¦‚ï¼Œä¸€ä¸ªå®¢æˆ·æœ‰å¾ˆå¤šè®¢å•ï¼Œä¸€ä¸ªè®¢å•åªå½’å±ä¸€ä¸ªå®¢æˆ·ã€‚
ä¸¤ä¸ªæ–¹æ³•éƒ½æœ‰ä¸¤ä¸ªå‚æ•°å¹¶è¿”å› <a href="./yii-db-activequery.html">yii\db\ActiveQuery</a> å¯¹è±¡ã€‚</p>
<ul>
<li><code>$class</code>ï¼šå
³è”æ¨¡å‹ç±»åï¼Œå®ƒå¿
é¡»æ˜¯ä¸€ä¸ªå®Œå
¨åˆæ ¼çš„ç±»åã€‚</li>
<li><code>$link</code>: ä¸¤ä¸ªè¡¨çš„å
³è”åˆ—ï¼Œåº”ä¸ºé”®å€¼å¯¹æ•°ç»„çš„å½¢å¼ã€‚
æ•°ç»„çš„é”®æ˜¯ <code>$class</code> å
³è”è¡¨çš„åˆ—åï¼Œ
è€Œæ•°ç»„å€¼æ˜¯å
³è”ç±» $class çš„åˆ—åã€‚
åŸºäºè¡¨å¤–é”®å®šä¹‰å
³è”å
³ç³»æ˜¯æœ€ä½³æ–¹æ³•ã€‚</li>
</ul>
<p>å»ºç«‹å
³è”å
³ç³»åï¼Œè·å–å
³è”æ•°æ®å’Œè·å–ç»„ä»¶å±æ€§ä¸€æ ·ç®€å•ï¼Œ
æ‰§è¡Œä»¥ä¸‹ç›¸åº”getteræ–¹æ³•å³å¯ï¼š</p>
<pre><code class="language-php"><span style="color: #0000BB"></span><span style="color: #FF8000">//&nbsp;å–å¾—å®¢æˆ·çš„è®¢å•<br /></span><span style="color: #0000BB">$customer&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">Customer</span><span style="color: #007700">::</span><span style="color: #0000BB">findOne</span><span style="color: #007700">(</span><span style="color: #0000BB">1</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">$orders&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$customer</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">orders</span><span style="color: #007700">;&nbsp;</span><span style="color: #FF8000">//&nbsp;$orders&nbsp;æ˜¯&nbsp;Order&nbsp;å¯¹è±¡æ•°ç»„</span></code></pre>
<p>ä»¥ä¸Šä»£ç å®é™
æ‰§è¡Œäº†ä»¥ä¸‹ä¸¤æ¡ SQL è¯­å¥ï¼š</p>
<pre><code class="language-sql">SELECT * FROM customer WHERE id=1;
SELECT * FROM order WHERE customer_id=1;
</code></pre>
<blockquote><p>æç¤º:å†æ¬¡ç”¨è¡¨è¾¾å¼ <code>$customer-&gt;orders</code>å°†ä¸ä¼šæ‰§è¡Œç¬¬äºŒæ¬¡ SQL æŸ¥è¯¢ï¼Œ
SQL æŸ¥è¯¢åªåœ¨è¯¥è¡¨è¾¾å¼ç¬¬ä¸€æ¬¡ä½¿ç”¨æ—¶æ‰§è¡Œã€‚
æ•°æ®åº“è®¿é—®åªè¿”å›ç¼“å­˜åœ¨å†
éƒ¨å‰ä¸€æ¬¡å–å›çš„ç»“æœé›†ï¼Œå¦‚æœä½ æƒ³æŸ¥è¯¢æ–°çš„
å
³è”æ•°æ®ï¼Œå
ˆè¦æ³¨é”€ç°æœ‰ç»“æœé›†ï¼š<code>unset($customer-&gt;orders);</code>ã€‚</p>
</blockquote>
<p>æœ‰æ—¶å€™éœ€è¦åœ¨å
³è”æŸ¥è¯¢ä¸­ä¼ é€’å‚æ•°ï¼Œå¦‚ä¸éœ€è¦è¿”å›å®¢æˆ·å
¨éƒ¨è®¢å•ï¼Œ
åªéœ€è¦è¿”å›è´­ä¹°é‡‘é¢è¶
è¿‡è®¾å®šå€¼çš„å¤§è®¢å•ï¼Œ
é€šè¿‡ä»¥ä¸‹getteræ–¹æ³•å£°æ˜ä¸€ä¸ªå
³è”æ•°æ® <code>bigOrders</code> ï¼š</p>
<pre><code class="language-php"><span style="color: #0000BB"></span><span style="color: #007700">class&nbsp;</span><span style="color: #0000BB">Customer&nbsp;</span><span style="color: #007700">extends&nbsp;\</span><span style="color: #0000BB">yii</span><span style="color: #007700">\</span><span style="color: #0000BB">db</span><span style="color: #007700">\</span><span style="color: #0000BB">ActiveRecord<br /></span><span style="color: #007700">{<br />&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;function&nbsp;</span><span style="color: #0000BB">getBigOrders</span><span style="color: #007700">(</span><span style="color: #0000BB">$threshold&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">100</span><span style="color: #007700">)<br />&nbsp;&nbsp;&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">hasMany</span><span style="color: #007700">(</span><span style="color: #0000BB">Order</span><span style="color: #007700">::</span><span style="color: #0000BB">className</span><span style="color: #007700">(),&nbsp;[</span><span style="color: #DD0000">'customer_id'&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #DD0000">'id'</span><span style="color: #007700">])<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&gt;</span><span style="color: #0000BB">where</span><span style="color: #007700">(</span><span style="color: #DD0000">'subtotal&nbsp;&gt;&nbsp;:threshold'</span><span style="color: #007700">,&nbsp;[</span><span style="color: #DD0000">':threshold'&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #0000BB">$threshold</span><span style="color: #007700">])<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&gt;</span><span style="color: #0000BB">orderBy</span><span style="color: #007700">(</span><span style="color: #DD0000">'id'</span><span style="color: #007700">);<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br />}</span></code></pre>
<p><code>hasMany()</code> è¿”å› <a href="./yii-db-activequery.html">yii\db\ActiveQuery</a> å¯¹è±¡ï¼Œè¯¥å¯¹è±¡å
è®¸ä½ é€šè¿‡
<a href="./yii-db-activequery.html">yii\db\ActiveQuery</a> æ–¹æ³•å®šåˆ¶æŸ¥è¯¢ã€‚</p>
<p>å¦‚ä¸Šå£°æ˜åï¼Œæ‰§è¡Œ<code>$customer-&gt;bigOrders</code> å°±è¿”å›
æ€»é¢å¤§äº100çš„è®¢å•ã€‚ä½¿ç”¨ä»¥ä¸‹ä»£ç æ›´æ”¹è®¾å®šå€¼ï¼š</p>
<pre><code class="language-php"><span style="color: #0000BB">$orders&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$customer</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">getBigOrders</span><span style="color: #007700">(</span><span style="color: #0000BB">200</span><span style="color: #007700">)-&gt;</span><span style="color: #0000BB">all</span><span style="color: #007700">();</span></code></pre>
<p>&gt;æ³¨æ„ï¼šå
³è”æŸ¥è¯¢è¿”å›çš„æ˜¯ <a href="./yii-db-activequery.html">yii\db\ActiveQuery</a> çš„å®ä¾‹ï¼Œå¦‚æœåƒç‰¹æ€§ï¼ˆå¦‚ç±»å±æ€§ï¼‰é‚£æ ·è¿æ¥å
³è”æ•°æ®ï¼Œ
è¿”å›çš„ç»“æœæ˜¯å
³è”æŸ¥è¯¢çš„ç»“æœï¼Œå³ <a href="./yii-db-activerecord.html">yii\db\ActiveRecord</a> çš„å®ä¾‹ï¼Œ
æˆ–è€
æ˜¯æ•°ç»„ï¼Œæˆ–è€
æ˜¯ null ï¼Œå–å†³äºå
³è”å
³ç³»çš„å¤šæ ·æ€§ã€‚å¦‚ï¼Œ<code>$customer-&gt;getOrders()</code> è¿”å›
<code>ActiveQuery</code> å®ä¾‹ï¼Œè€Œ <code>$customer-&gt;orders</code> è¿”å›<code>Order</code> å¯¹è±¡æ•°ç»„
ï¼ˆå¦‚æœæŸ¥è¯¢ç»“æœä¸ºç©ºåˆ™è¿”å›ç©ºæ•°ç»„ï¼‰ã€‚</p>
<p>ä¸­é—´å</p>
<h2>³è”è¡¨ <a href="#" name="" class="hashlink">&para;</a></h2><p>æœ‰æ—¶ï¼Œä¸¤ä¸ªè¡¨é€šè¿‡ä¸­é—´è¡¨å
³è”ï¼Œå®šä¹‰è¿™æ ·çš„å
³è”å
³ç³»ï¼Œ å¯ä»¥é€šè¿‡è°ƒç”¨ <a href="./yii-db-activerelationtrait.html#via()-detail">via()</a> æ–¹æ³•æˆ– <a href="./yii-db-activequery.html#viaTable()-detail">viaTable()</a> æ–¹æ³•æ¥å®šåˆ¶ <a href="./yii-db-activequery.html">yii\db\ActiveQuery</a> å¯¹è±¡ ã€‚</p>
<p>ä¸¾ä¾‹è€Œè¨€ï¼Œå¦‚æœ <code>order</code> è¡¨å’Œ <code>item</code> è¡¨é€šè¿‡ä¸­é—´è¡¨ <code>order_item</code> å
³è”èµ·æ¥ï¼Œ å¯ä»¥åœ¨ <code>Order</code> ç±»å£°æ˜ <code>items</code> å
³è”å
³ç³»å–ä»£ä¸­é—´è¡¨ï¼š</p>
<pre><code class="language-php"><span style="color: #0000BB"></span><span style="color: #007700">class&nbsp;</span><span style="color: #0000BB">Order&nbsp;</span><span style="color: #007700">extends&nbsp;\</span><span style="color: #0000BB">yii</span><span style="color: #007700">\</span><span style="color: #0000BB">db</span><span style="color: #007700">\</span><span style="color: #0000BB">ActiveRecord<br /></span><span style="color: #007700">{<br />&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;function&nbsp;</span><span style="color: #0000BB">getItems</span><span style="color: #007700">()<br />&nbsp;&nbsp;&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">hasMany</span><span style="color: #007700">(</span><span style="color: #0000BB">Item</span><span style="color: #007700">::</span><span style="color: #0000BB">className</span><span style="color: #007700">(),&nbsp;[</span><span style="color: #DD0000">'id'&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #DD0000">'item_id'</span><span style="color: #007700">])<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&gt;</span><span style="color: #0000BB">viaTable</span><span style="color: #007700">(</span><span style="color: #DD0000">'order_item'</span><span style="color: #007700">,&nbsp;[</span><span style="color: #DD0000">'order_id'&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #DD0000">'id'</span><span style="color: #007700">]);<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br />}</span></code></pre>
<p>ä¸¤ä¸ªæ–¹æ³•æ˜¯ç›¸ä¼¼çš„ï¼Œé™¤äº† <a href="./yii-db-activerelationtrait.html#via()-detail">via()</a> æ–¹æ³•çš„ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯ä½¿ç”¨ AR ç±»ä¸­å®šä¹‰çš„å
³è”åã€‚ ä»¥ä¸Šæ–¹æ³•å–ä»£äº†ä¸­é—´è¡¨ï¼Œç­‰ä»·äºï¼š</p>
<pre><code class="language-php"><span style="color: #0000BB"></span><span style="color: #007700">class&nbsp;</span><span style="color: #0000BB">Order&nbsp;</span><span style="color: #007700">extends&nbsp;\</span><span style="color: #0000BB">yii</span><span style="color: #007700">\</span><span style="color: #0000BB">db</span><span style="color: #007700">\</span><span style="color: #0000BB">ActiveRecord<br /></span><span style="color: #007700">{<br />&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;function&nbsp;</span><span style="color: #0000BB">getOrderItems</span><span style="color: #007700">()<br />&nbsp;&nbsp;&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">hasMany</span><span style="color: #007700">(</span><span style="color: #0000BB">OrderItem</span><span style="color: #007700">::</span><span style="color: #0000BB">className</span><span style="color: #007700">(),&nbsp;[</span><span style="color: #DD0000">'order_id'&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #DD0000">'id'</span><span style="color: #007700">]);<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;function&nbsp;</span><span style="color: #0000BB">getItems</span><span style="color: #007700">()<br />&nbsp;&nbsp;&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">hasMany</span><span style="color: #007700">(</span><span style="color: #0000BB">Item</span><span style="color: #007700">::</span><span style="color: #0000BB">className</span><span style="color: #007700">(),&nbsp;[</span><span style="color: #DD0000">'id'&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #DD0000">'item_id'</span><span style="color: #007700">])<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&gt;</span><span style="color: #0000BB">via</span><span style="color: #007700">(</span><span style="color: #DD0000">'orderItems'</span><span style="color: #007700">);<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br />}</span></code></pre>
<h2>å»¶è¿ŸåŠ è½½å’Œå³æ—¶åŠ è½½ï¼ˆåˆç§°æƒ°æ€§åŠ è½½ä¸è´ªå©ªåŠ è½½ï¼‰ <a href="#" name="" class="hashlink">&para;</a></h2><p>å¦‚å‰æ‰€è¿°ï¼Œå½“ä½ ç¬¬ä¸€æ¬¡è¿æ¥å
³è”å¯¹è±¡æ—¶ï¼Œ AR å°†æ‰§è¡Œä¸€ä¸ªæ•°æ®åº“æŸ¥è¯¢ æ¥æ£€ç´¢è¯·æ±‚æ•°æ®å¹¶å¡«å</p>
<p>åˆ°å
³è”å¯¹è±¡çš„ç›¸åº”å±æ€§ã€‚ å¦‚æœå†æ¬¡è¿æ¥ç›¸åŒçš„å
³è”å¯¹è±¡ï¼Œä¸å†æ‰§è¡Œä»»ä½•æŸ¥è¯¢è¯­å¥ï¼Œè¿™ç§æ•°æ®åº“æŸ¥è¯¢çš„æ‰§è¡Œæ–¹æ³•ç§°ä¸ºâ€œå»¶è¿ŸåŠ è½½â€ã€‚å¦‚ï¼š</p>
<pre><code class="language-php"><span style="color: #0000BB"></span><span style="color: #FF8000">//&nbsp;SQL&nbsp;executed:&nbsp;SELECT&nbsp;*&nbsp;FROM&nbsp;customer&nbsp;WHERE&nbsp;id=1<br /></span><span style="color: #0000BB">$customer&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">Customer</span><span style="color: #007700">::</span><span style="color: #0000BB">findOne</span><span style="color: #007700">(</span><span style="color: #0000BB">1</span><span style="color: #007700">);<br /></span><span style="color: #FF8000">//&nbsp;SQL&nbsp;executed:&nbsp;SELECT&nbsp;*&nbsp;FROM&nbsp;order&nbsp;WHERE&nbsp;customer_id=1<br /></span><span style="color: #0000BB">$orders&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$customer</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">orders</span><span style="color: #007700">;<br /></span><span style="color: #FF8000">//&nbsp;æ²¡æœ‰&nbsp;SQL&nbsp;è¯­å¥è¢«æ‰§è¡Œ<br /></span><span style="color: #0000BB">$orders2&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$customer</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">orders</span><span style="color: #007700">;&nbsp;</span><span style="color: #FF8000">//å–å›ä¸Šæ¬¡æŸ¥è¯¢çš„ç¼“å­˜æ•°æ®</span></code></pre>
<p>å»¶è¿ŸåŠ è½½éå¸¸å®ç”¨ï¼Œä½†æ˜¯ï¼Œåœ¨ä»¥ä¸‹åœºæ™¯ä¸­ä½¿ç”¨å»¶è¿ŸåŠ è½½ä¼šé­é‡æ€§èƒ½é—®é¢˜ï¼š</p>
<pre><code class="language-php"><span style="color: #0000BB"></span><span style="color: #FF8000">//&nbsp;SQL&nbsp;executed:&nbsp;SELECT&nbsp;*&nbsp;FROM&nbsp;customer&nbsp;LIMIT&nbsp;100<br /></span><span style="color: #0000BB">$customers&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">Customer</span><span style="color: #007700">::</span><span style="color: #0000BB">find</span><span style="color: #007700">()-&gt;</span><span style="color: #0000BB">limit</span><span style="color: #007700">(</span><span style="color: #0000BB">100</span><span style="color: #007700">)-&gt;</span><span style="color: #0000BB">all</span><span style="color: #007700">();<br /><br />foreach&nbsp;(</span><span style="color: #0000BB">$customers&nbsp;</span><span style="color: #007700">as&nbsp;</span><span style="color: #0000BB">$customer</span><span style="color: #007700">)&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">//&nbsp;SQL&nbsp;executed:&nbsp;SELECT&nbsp;*&nbsp;FROM&nbsp;order&nbsp;WHERE&nbsp;customer_id=...<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$orders&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$customer</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">orders</span><span style="color: #007700">;<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">//&nbsp;...å¤„ç†&nbsp;$orders...<br /></span><span style="color: #007700">}</span></code></pre>
<p>å‡è®¾æ•°æ®åº“æŸ¥å‡ºçš„å®¢æˆ·è¶
è¿‡100ä¸ªï¼Œä»¥ä¸Šä»£ç å°†æ‰§è¡Œå¤šå°‘æ¡ SQL è¯­å¥ï¼Ÿ 101 æ¡ï¼ç¬¬ä¸€æ¡ SQL æŸ¥è¯¢è¯­å¥å–å›100ä¸ªå®¢æˆ·ï¼Œç„¶åï¼Œ æ¯ä¸ªå®¢æˆ·è¦æ‰§è¡Œä¸€æ¡ SQL æŸ¥è¯¢è¯­å¥ä»¥å–å›è¯¥å®¢æˆ·çš„æ‰€æœ‰è®¢å•ã€‚</p>
<p>ä¸ºè§£å†³ä»¥ä¸Šæ€§èƒ½é—®é¢˜ï¼Œå¯ä»¥é€šè¿‡è°ƒç”¨ <a href="./yii-db-activequerytrait.html#with()-detail">yii\db\ActiveQuery::with()</a> æ–¹æ³•ä½¿ç”¨å³æ—¶åŠ è½½è§£å†³ã€‚</p>
<pre><code class="language-php"><span style="color: #0000BB"></span><span style="color: #FF8000">//&nbsp;SQL&nbsp;executed:&nbsp;SELECT&nbsp;*&nbsp;FROM&nbsp;customer&nbsp;LIMIT&nbsp;100;<br />//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SELECT&nbsp;*&nbsp;FROM&nbsp;orders&nbsp;WHERE&nbsp;customer_id&nbsp;IN&nbsp;(1,2,...)<br /></span><span style="color: #0000BB">$customers&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">Customer</span><span style="color: #007700">::</span><span style="color: #0000BB">find</span><span style="color: #007700">()-&gt;</span><span style="color: #0000BB">limit</span><span style="color: #007700">(</span><span style="color: #0000BB">100</span><span style="color: #007700">)<br />&nbsp;&nbsp;&nbsp;&nbsp;-&gt;</span><span style="color: #0000BB">with</span><span style="color: #007700">(</span><span style="color: #DD0000">'orders'</span><span style="color: #007700">)-&gt;</span><span style="color: #0000BB">all</span><span style="color: #007700">();<br /><br />foreach&nbsp;(</span><span style="color: #0000BB">$customers&nbsp;</span><span style="color: #007700">as&nbsp;</span><span style="color: #0000BB">$customer</span><span style="color: #007700">)&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">//&nbsp;æ²¡æœ‰&nbsp;SQL&nbsp;è¯­å¥è¢«æ‰§è¡Œ<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$orders&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$customer</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">orders</span><span style="color: #007700">;<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">//&nbsp;...å¤„ç†&nbsp;$orders...<br /></span><span style="color: #007700">}</span></code></pre>
<p>å¦‚ä½ æ‰€è§ï¼ŒåŒæ ·çš„ä»»åŠ¡åªéœ€è¦ä¸¤ä¸ª SQL è¯­å¥ã€‚
&gt;é¡»çŸ¥ï¼šé€šå¸¸ï¼Œå³æ—¶åŠ è½½ N ä¸ªå
³è”å
³ç³»è€Œé€šè¿‡ via() æˆ–è€
 viaTable() å®šä¹‰äº† M ä¸ªå
³è”å
³ç³»ï¼Œ å°†æœ‰ 1+M+N æ¡ SQL æŸ¥è¯¢è¯­å¥è¢«æ‰§è¡Œï¼šä¸€ä¸ªæŸ¥è¯¢å–å›ä¸»è¡¨è¡Œæ•°ï¼Œ ä¸€ä¸ªæŸ¥è¯¢ç»™æ¯ä¸€ä¸ª (M) ä¸­é—´è¡¨ï¼Œä¸€ä¸ªæŸ¥è¯¢ç»™æ¯ä¸ª (N) å
³è”è¡¨ã€‚
æ³¨æ„:å½“ç”¨å³æ—¶åŠ è½½å®šåˆ¶ select() æ—¶ï¼Œç¡®ä¿è¿æ¥ åˆ°å
³è”æ¨¡å‹çš„åˆ—éƒ½è¢«åŒ
æ‹¬äº†ï¼Œå¦åˆ™ï¼Œå
³è”æ¨¡å‹ä¸ä¼šè½½å
¥ã€‚å¦‚ï¼š</p>
<pre><code class="language-php"><span style="color: #0000BB">$orders&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">Order</span><span style="color: #007700">::</span><span style="color: #0000BB">find</span><span style="color: #007700">()-&gt;</span><span style="color: #0000BB">select</span><span style="color: #007700">([</span><span style="color: #DD0000">'id'</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">'amount'</span><span style="color: #007700">])-&gt;</span><span style="color: #0000BB">with</span><span style="color: #007700">(</span><span style="color: #DD0000">'customer'</span><span style="color: #007700">)-&gt;</span><span style="color: #0000BB">all</span><span style="color: #007700">();<br /></span><span style="color: #FF8000">//&nbsp;$orders[0]-&gt;customer&nbsp;æ€»æ˜¯ç©ºçš„ï¼Œä½¿ç”¨ä»¥ä¸‹ä»£ç è§£å†³è¿™ä¸ªé—®é¢˜ï¼š<br /></span><span style="color: #0000BB">$orders&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">Order</span><span style="color: #007700">::</span><span style="color: #0000BB">find</span><span style="color: #007700">()-&gt;</span><span style="color: #0000BB">select</span><span style="color: #007700">([</span><span style="color: #DD0000">'id'</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">'amount'</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">'customer_id'</span><span style="color: #007700">])-&gt;</span><span style="color: #0000BB">with</span><span style="color: #007700">(</span><span style="color: #DD0000">'customer'</span><span style="color: #007700">)-&gt;</span><span style="color: #0000BB">all</span><span style="color: #007700">();</span></code></pre>
<p>æœ‰æ—¶å€™ï¼Œä½ æƒ³è‡ªç”±çš„è‡ªå®šä¹‰å
³è”æŸ¥è¯¢ï¼Œå»¶è¿ŸåŠ è½½å’Œå³æ—¶åŠ è½½éƒ½å¯ä»¥å®ç°ï¼Œå¦‚ï¼š</p>
<pre><code class="language-php"><span style="color: #0000BB">$customer&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">Customer</span><span style="color: #007700">::</span><span style="color: #0000BB">findOne</span><span style="color: #007700">(</span><span style="color: #0000BB">1</span><span style="color: #007700">);<br /></span><span style="color: #FF8000">//&nbsp;å»¶è¿ŸåŠ è½½:&nbsp;SELECT&nbsp;*&nbsp;FROM&nbsp;order&nbsp;WHERE&nbsp;customer_id=1&nbsp;AND&nbsp;subtotal&gt;100<br /></span><span style="color: #0000BB">$orders&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$customer</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">getOrders</span><span style="color: #007700">()-&gt;</span><span style="color: #0000BB">where</span><span style="color: #007700">(</span><span style="color: #DD0000">'subtotal&gt;100'</span><span style="color: #007700">)-&gt;</span><span style="color: #0000BB">all</span><span style="color: #007700">();<br /><br /></span><span style="color: #FF8000">//&nbsp;å³æ—¶åŠ è½½:&nbsp;SELECT&nbsp;*&nbsp;FROM&nbsp;customer&nbsp;LIMIT&nbsp;100<br />//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SELECT&nbsp;*&nbsp;FROM&nbsp;order&nbsp;WHERE&nbsp;customer_id&nbsp;IN&nbsp;(1,2,...)&nbsp;AND&nbsp;subtotal&gt;100<br /></span><span style="color: #0000BB">$customers&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">Customer</span><span style="color: #007700">::</span><span style="color: #0000BB">find</span><span style="color: #007700">()-&gt;</span><span style="color: #0000BB">limit</span><span style="color: #007700">(</span><span style="color: #0000BB">100</span><span style="color: #007700">)-&gt;</span><span style="color: #0000BB">with</span><span style="color: #007700">([<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #DD0000">'orders'&nbsp;</span><span style="color: #007700">=&gt;&nbsp;function(</span><span style="color: #0000BB">$query</span><span style="color: #007700">)&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$query</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">andWhere</span><span style="color: #007700">(</span><span style="color: #DD0000">'subtotal&gt;100'</span><span style="color: #007700">);<br />&nbsp;&nbsp;&nbsp;&nbsp;},<br />])-&gt;</span><span style="color: #0000BB">all</span><span style="color: #007700">();</span></code></pre>
<p>é€†å</p>
<h2>³ç³» <a href="#" name="" class="hashlink">&para;</a></h2><p>å
³è”å
³ç³»é€šå¸¸æˆå¯¹å®šä¹‰ï¼Œå¦‚ï¼šCustomer å¯ä»¥æœ‰ä¸ªåä¸º orders å
³è”é¡¹ï¼Œ è€Œ Order ä¹Ÿæœ‰ä¸ªåä¸ºcustomer çš„å
³è”é¡¹ï¼š</p>
<pre><code class="language-php"><span style="color: #0000BB"></span><span style="color: #007700">class&nbsp;</span><span style="color: #0000BB">Customer&nbsp;</span><span style="color: #007700">extends&nbsp;</span><span style="color: #0000BB">ActiveRecord<br /></span><span style="color: #007700">{<br />&nbsp;&nbsp;&nbsp;&nbsp;....<br />&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;function&nbsp;</span><span style="color: #0000BB">getOrders</span><span style="color: #007700">()<br />&nbsp;&nbsp;&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">hasMany</span><span style="color: #007700">(</span><span style="color: #0000BB">Order</span><span style="color: #007700">::</span><span style="color: #0000BB">className</span><span style="color: #007700">(),&nbsp;[</span><span style="color: #DD0000">'customer_id'&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #DD0000">'id'</span><span style="color: #007700">]);<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br />}<br /><br />class&nbsp;</span><span style="color: #0000BB">Order&nbsp;</span><span style="color: #007700">extends&nbsp;</span><span style="color: #0000BB">ActiveRecord<br /></span><span style="color: #007700">{<br />&nbsp;&nbsp;&nbsp;&nbsp;....<br />&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;function&nbsp;</span><span style="color: #0000BB">getCustomer</span><span style="color: #007700">()<br />&nbsp;&nbsp;&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">hasOne</span><span style="color: #007700">(</span><span style="color: #0000BB">Customer</span><span style="color: #007700">::</span><span style="color: #0000BB">className</span><span style="color: #007700">(),&nbsp;[</span><span style="color: #DD0000">'id'&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #DD0000">'customer_id'</span><span style="color: #007700">]);<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br />}</span></code></pre>
<p>å¦‚æœæˆ‘ä»¬æ‰§è¡Œä»¥ä¸‹æŸ¥è¯¢ï¼Œå¯ä»¥å‘ç°è®¢å•çš„ customer å’Œ æ‰¾åˆ°è¿™äº›è®¢å•çš„å®¢æˆ·å¯¹è±¡å¹¶ä¸æ˜¯åŒä¸€ä¸ªã€‚è¿æ¥ customer-&gt;orders å°†è§¦å‘ä¸€æ¡ SQL è¯­å¥ è€Œè¿æ¥ä¸€ä¸ªè®¢å•çš„ customer å°†è§¦å‘å¦ä¸€æ¡ SQL è¯­å¥ã€‚</p>
<pre><code class="language-php"><span style="color: #0000BB"></span><span style="color: #FF8000">//&nbsp;SELECT&nbsp;*&nbsp;FROM&nbsp;customer&nbsp;WHERE&nbsp;id=1<br /></span><span style="color: #0000BB">$customer&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">Customer</span><span style="color: #007700">::</span><span style="color: #0000BB">findOne</span><span style="color: #007700">(</span><span style="color: #0000BB">1</span><span style="color: #007700">);<br /></span><span style="color: #FF8000">//&nbsp;è¾“å‡º&nbsp;"ä¸ç›¸åŒ"<br />//&nbsp;SELECT&nbsp;*&nbsp;FROM&nbsp;order&nbsp;WHERE&nbsp;customer_id=1<br />//&nbsp;SELECT&nbsp;*&nbsp;FROM&nbsp;customer&nbsp;WHERE&nbsp;id=1<br /></span><span style="color: #007700">if&nbsp;(</span><span style="color: #0000BB">$customer</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">orders</span><span style="color: #007700">[</span><span style="color: #0000BB">0</span><span style="color: #007700">]-&gt;</span><span style="color: #0000BB">customer&nbsp;</span><span style="color: #007700">===&nbsp;</span><span style="color: #0000BB">$customer</span><span style="color: #007700">)&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;echo&nbsp;</span><span style="color: #DD0000">'ç›¸åŒ'</span><span style="color: #007700">;<br />}&nbsp;else&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;echo&nbsp;</span><span style="color: #DD0000">'ä¸ç›¸åŒ'</span><span style="color: #007700">;<br />}</span></code></pre>
<p>ä¸ºé¿å
å¤šä½™æ‰§è¡Œçš„åä¸€æ¡è¯­å¥ï¼Œæˆ‘ä»¬å¯ä»¥ä¸º customeræˆ– orders å
³è”å
³ç³»å®šä¹‰ç›¸åçš„å
³è”å
³ç³»ï¼Œé€šè¿‡è°ƒç”¨ <a href="./yii-db-activerelationtrait.html#inverseOf()-detail">inverseOf()</a> æ–¹æ³•å¯ä»¥å®ç°ã€‚</p>
<pre><code class="language-php"><span style="color: #0000BB"></span><span style="color: #007700">class&nbsp;</span><span style="color: #0000BB">Customer&nbsp;</span><span style="color: #007700">extends&nbsp;</span><span style="color: #0000BB">ActiveRecord<br /></span><span style="color: #007700">{<br />&nbsp;&nbsp;&nbsp;&nbsp;....<br />&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;function&nbsp;</span><span style="color: #0000BB">getOrders</span><span style="color: #007700">()<br />&nbsp;&nbsp;&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">hasMany</span><span style="color: #007700">(</span><span style="color: #0000BB">Order</span><span style="color: #007700">::</span><span style="color: #0000BB">className</span><span style="color: #007700">(),&nbsp;[</span><span style="color: #DD0000">'customer_id'&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #DD0000">'id'</span><span style="color: #007700">])-&gt;</span><span style="color: #0000BB">inverseOf</span><span style="color: #007700">(</span><span style="color: #DD0000">'customer'</span><span style="color: #007700">);<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br />}</span></code></pre>
<p>ç°åœ¨æˆ‘ä»¬åŒæ ·æ‰§è¡Œä¸Šé¢çš„æŸ¥è¯¢ï¼Œæˆ‘ä»¬å°†å¾—åˆ°ï¼š</p>
<pre><code class="language-php"><span style="color: #0000BB"></span><span style="color: #FF8000">//&nbsp;SELECT&nbsp;*&nbsp;FROM&nbsp;customer&nbsp;WHERE&nbsp;id=1<br /></span><span style="color: #0000BB">$customer&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">Customer</span><span style="color: #007700">::</span><span style="color: #0000BB">findOne</span><span style="color: #007700">(</span><span style="color: #0000BB">1</span><span style="color: #007700">);<br /></span><span style="color: #FF8000">//&nbsp;è¾“å‡ºç›¸åŒ<br />//&nbsp;SELECT&nbsp;*&nbsp;FROM&nbsp;order&nbsp;WHERE&nbsp;customer_id=1<br /></span><span style="color: #007700">if&nbsp;(</span><span style="color: #0000BB">$customer</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">orders</span><span style="color: #007700">[</span><span style="color: #0000BB">0</span><span style="color: #007700">]-&gt;</span><span style="color: #0000BB">customer&nbsp;</span><span style="color: #007700">===&nbsp;</span><span style="color: #0000BB">$customer</span><span style="color: #007700">)&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;echo&nbsp;</span><span style="color: #DD0000">'ç›¸åŒ'</span><span style="color: #007700">;<br />}&nbsp;else&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;echo&nbsp;</span><span style="color: #DD0000">'ä¸ç›¸åŒ'</span><span style="color: #007700">;<br />}</span></code></pre>
<p>ä»¥ä¸Šæˆ‘ä»¬å±•ç¤ºäº†å¦‚ä½•åœ¨å»¶è¿ŸåŠ è½½ä¸­ä½¿ç”¨ç›¸å¯¹å
³è”å
³ç³»ï¼Œ ç›¸å¯¹å
³ç³»ä¹Ÿå¯ä»¥ç”¨åœ¨å³æ—¶åŠ è½½ä¸­ï¼š</p>
<pre><code class="language-php"><span style="color: #0000BB"></span><span style="color: #FF8000">//&nbsp;SELECT&nbsp;*&nbsp;FROM&nbsp;customer<br />//&nbsp;SELECT&nbsp;*&nbsp;FROM&nbsp;order&nbsp;WHERE&nbsp;customer_id&nbsp;IN&nbsp;(1,&nbsp;2,&nbsp;...)<br /></span><span style="color: #0000BB">$customers&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">Customer</span><span style="color: #007700">::</span><span style="color: #0000BB">find</span><span style="color: #007700">()-&gt;</span><span style="color: #0000BB">with</span><span style="color: #007700">(</span><span style="color: #DD0000">'orders'</span><span style="color: #007700">)-&gt;</span><span style="color: #0000BB">all</span><span style="color: #007700">();<br /></span><span style="color: #FF8000">//&nbsp;è¾“å‡ºç›¸åŒ<br /></span><span style="color: #007700">if&nbsp;(</span><span style="color: #0000BB">$customers</span><span style="color: #007700">[</span><span style="color: #0000BB">0</span><span style="color: #007700">]-&gt;</span><span style="color: #0000BB">orders</span><span style="color: #007700">[</span><span style="color: #0000BB">0</span><span style="color: #007700">]-&gt;</span><span style="color: #0000BB">customer&nbsp;</span><span style="color: #007700">===&nbsp;</span><span style="color: #0000BB">$customers</span><span style="color: #007700">[</span><span style="color: #0000BB">0</span><span style="color: #007700">])&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;echo&nbsp;</span><span style="color: #DD0000">'ç›¸åŒ'</span><span style="color: #007700">;<br />}&nbsp;else&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;echo&nbsp;</span><span style="color: #DD0000">'ä¸ç›¸åŒ'</span><span style="color: #007700">;<br />}</span></code></pre>
<p>&gt;æ³¨æ„:ç›¸å¯¹å
³ç³»ä¸èƒ½åœ¨åŒ
å«ä¸­é—´è¡¨çš„å
³è”å
³ç³»ä¸­å®šä¹‰ã€‚ å³æ˜¯ï¼Œå¦‚æœä½ çš„å
³ç³»æ˜¯é€šè¿‡<a href="./yii-db-activerelationtrait.html#via()-detail">via()</a> æˆ– <a href="./yii-db-activequery.html#viaTable()-detail">viaTable()</a>æ–¹æ³•å®šä¹‰çš„ï¼Œ å°±ä¸èƒ½è°ƒç”¨<a href="./yii-db-activerelationtrait.html#inverseOf()-detail">yii\db\ActiveQuery::inverseOf()</a>æ–¹æ³•äº†ã€‚</p>
<p> JOIN ç±»å‹å</p>
<h2>³è”æŸ¥è¯¢ <a href="#" name="" class="hashlink">&para;</a></h2><p>ä½¿ç”¨å
³ç³»æ•°æ®åº“æ—¶ï¼Œæ™®éè¦åšçš„æ˜¯è¿æ¥å¤šä¸ªè¡¨å¹¶æ˜ç¡®åœ°è¿ç”¨å„ç§ JOIN æŸ¥è¯¢ã€‚
JOIN SQLè¯­å¥çš„æŸ¥è¯¢æ¡ä»¶å’Œå‚æ•°ï¼Œä½¿ç”¨ <a href="./yii-db-activequery.html#joinWith()-detail">yii\db\ActiveQuery::joinWith()</a>
å¯ä»¥é‡ç”¨å·²å®šä¹‰å
³ç³»å¹¶è°ƒç”¨
è€Œä¸æ˜¯ä½¿ç”¨ <a href="./yii-db-query.html#join()-detail">yii\db\ActiveQuery::join()</a> æ¥å®ç°ç›®æ ‡ã€‚</p>
<pre><code class="language-php"><span style="color: #0000BB"></span><span style="color: #FF8000">//&nbsp;æŸ¥æ‰¾æ‰€æœ‰è®¢å•å¹¶ä»¥å®¢æˆ·&nbsp;ID&nbsp;å’Œè®¢å•&nbsp;ID&nbsp;æ’åºï¼Œå¹¶è´ªå©ªåŠ è½½&nbsp;"customer"&nbsp;è¡¨<br /></span><span style="color: #0000BB">$orders&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">Order</span><span style="color: #007700">::</span><span style="color: #0000BB">find</span><span style="color: #007700">()-&gt;</span><span style="color: #0000BB">joinWith</span><span style="color: #007700">(</span><span style="color: #DD0000">'customer'</span><span style="color: #007700">)-&gt;</span><span style="color: #0000BB">orderBy</span><span style="color: #007700">(</span><span style="color: #DD0000">'customer.id,&nbsp;order.id'</span><span style="color: #007700">)-&gt;</span><span style="color: #0000BB">all</span><span style="color: #007700">();<br /></span><span style="color: #FF8000">//&nbsp;æŸ¥æ‰¾åŒ<br /></span><span style="color: #0000BB">æ‹¬ä¹¦ç±çš„æ‰€æœ‰è®¢å•ï¼Œå¹¶ä»¥&nbsp;</span><span style="color: #007700">`</span><span style="color: #DD0000">INNER&nbsp;JOIN</span><span style="color: #007700">`&nbsp;</span><span style="color: #0000BB">çš„è¿æ¥æ–¹å¼å³æ—¶åŠ è½½&nbsp;</span><span style="color: #DD0000">"books"&nbsp;</span><span style="color: #0000BB">è¡¨<br />$orders&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">Order</span><span style="color: #007700">::</span><span style="color: #0000BB">find</span><span style="color: #007700">()-&gt;</span><span style="color: #0000BB">innerJoinWith</span><span style="color: #007700">(</span><span style="color: #DD0000">'books'</span><span style="color: #007700">)-&gt;</span><span style="color: #0000BB">all</span><span style="color: #007700">();</span></code></pre>
<p>ä»¥ä¸Šï¼Œæ–¹æ³• <a href="./yii-db-activequery.html#innerJoinWith()-detail">innerJoinWith()</a> æ˜¯è®¿é—® <code>INNER JOIN</code> ç±»å‹çš„  <a href="./yii-db-activequery.html#joinWith()-detail">joinWith()</a> çš„å¿«æ·æ–¹å¼ã€‚</p>
<p>å¯ä»¥è¿æ¥ä¸€ä¸ªæˆ–å¤šä¸ªå
³è”å
³ç³»ï¼Œå¯ä»¥è‡ªç”±ä½¿ç”¨æŸ¥è¯¢æ¡ä»¶åˆ°å
³è”æŸ¥è¯¢ï¼Œ
ä¹Ÿå¯ä»¥åµŒå¥—è¿æ¥å
³è”æŸ¥è¯¢ã€‚å¦‚ï¼š</p>
<pre><code class="language-php"><span style="color: #0000BB"></span><span style="color: #FF8000">//&nbsp;è¿æ¥å¤šé‡å<br /></span><span style="color: #0000BB">³ç³»<br /></span><span style="color: #FF8000">//&nbsp;æ‰¾å‡º24å°æ—¶å†<br /></span><span style="color: #0000BB">æ³¨å†Œå®¢æˆ·åŒ<br />å«ä¹¦ç±çš„è®¢å•<br />$orders&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">Order</span><span style="color: #007700">::</span><span style="color: #0000BB">find</span><span style="color: #007700">()-&gt;</span><span style="color: #0000BB">innerJoinWith</span><span style="color: #007700">([<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #DD0000">'books'</span><span style="color: #007700">,<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #DD0000">'customer'&nbsp;</span><span style="color: #007700">=&gt;&nbsp;function&nbsp;(</span><span style="color: #0000BB">$query</span><span style="color: #007700">)&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$query</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">where</span><span style="color: #007700">(</span><span style="color: #DD0000">'customer.created_at&nbsp;&gt;&nbsp;'&nbsp;</span><span style="color: #007700">.&nbsp;(</span><span style="color: #0000BB">time</span><span style="color: #007700">()&nbsp;-&nbsp;</span><span style="color: #0000BB">24&nbsp;</span><span style="color: #007700">*&nbsp;</span><span style="color: #0000BB">3600</span><span style="color: #007700">));<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br />])-&gt;</span><span style="color: #0000BB">all</span><span style="color: #007700">();<br /></span><span style="color: #FF8000">//&nbsp;è¿æ¥åµŒå¥—å<br /></span><span style="color: #0000BB">³ç³»ï¼šè¿æ¥&nbsp;books&nbsp;è¡¨åŠå<br />¶&nbsp;author&nbsp;åˆ—<br />$orders&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">Order</span><span style="color: #007700">::</span><span style="color: #0000BB">find</span><span style="color: #007700">()-&gt;</span><span style="color: #0000BB">joinWith</span><span style="color: #007700">(</span><span style="color: #DD0000">'books.author'</span><span style="color: #007700">)-&gt;</span><span style="color: #0000BB">all</span><span style="color: #007700">();</span></code></pre>
<p>ä»£ç èƒŒåï¼Œ Yii å
ˆæ‰§è¡Œä¸€æ¡ JOIN SQL è¯­å¥æŠŠæ»¡è¶³ JOIN SQL è¯­å¥æŸ¥è¯¢æ¡ä»¶çš„ä¸»è¦æ¨¡å‹æŸ¥å‡ºï¼Œ
ç„¶åä¸ºæ¯ä¸ªå
³ç³»æ‰§è¡Œä¸€æ¡æŸ¥è¯¢è¯­å¥ï¼Œ
bingå¡«å</p>
<p>ç›¸åº”çš„å
³è”è®°å½•ã€‚</p>
<p><a href="./yii-db-activequery.html#joinWith()-detail">joinWith()</a> å’Œ  <a href="./yii-db-activequerytrait.html#with()-detail">with()</a> çš„åŒºåˆ«æ˜¯
å‰è€
è¿æ¥ä¸»æ¨¡å‹ç±»å’Œå
³è”æ¨¡å‹ç±»çš„æ•°æ®è¡¨æ¥æ£€ç´¢ä¸»æ¨¡å‹ï¼Œ
è€Œåè€
åªæŸ¥è¯¢å’Œæ£€ç´¢ä¸»æ¨¡å‹ç±»ã€‚
æ£€ç´¢ä¸»æ¨¡å‹</p>
<p>ç”±äºè¿™ä¸ªåŒºåˆ«ï¼Œä½ å¯ä»¥åº”ç”¨åªé’ˆå¯¹ä¸€æ¡ JOIN SQL è¯­å¥èµ·æ•ˆçš„æŸ¥è¯¢æ¡ä»¶ã€‚
å¦‚ï¼Œé€šè¿‡å
³è”æ¨¡å‹çš„æŸ¥è¯¢æ¡ä»¶è¿‡æ»¤ä¸»æ¨¡å‹ï¼Œå¦‚å‰ä¾‹ï¼Œ
å¯ä»¥ä½¿ç”¨å
³è”è¡¨çš„åˆ—æ¥æŒ‘é€‰ä¸»æ¨¡å‹æ•°æ®ï¼Œ</p>
<p>å½“ä½¿ç”¨ <a href="./yii-db-activequery.html#joinWith()-detail">joinWith()</a> æ–¹æ³•æ—¶å¯ä»¥å“åº”æ²¡æœ‰æ­§ä¹‰çš„åˆ—åã€‚
In the above examples, we use <code>item.id</code> and <code>order.id</code> to disambiguate the <code>id</code> column references
å› ä¸ºè®¢å•è¡¨å’Œé¡¹ç›®è¡¨éƒ½åŒ
æ‹¬ <code>id</code> åˆ—ã€‚</p>
<p>å½“è¿æ¥å
³è”å
³ç³»æ—¶ï¼Œå
³è”å
³ç³»é»˜è®¤ä½¿ç”¨å³æ—¶åŠ è½½ã€‚ä½ å¯ä»¥
é€šè¿‡ä¼ å‚æ•° <code>$eagerLoading</code> æ¥å†³å®šåœ¨æŒ‡å®šå
³è”æŸ¥è¯¢ä¸­æ˜¯å¦ä½¿ç”¨å³æ—¶åŠ è½½ã€‚</p>
<p>é»˜è®¤ <a href="./yii-db-activequery.html#joinWith()-detail">joinWith()</a> ä½¿ç”¨å·¦è¿æ¥æ¥è¿æ¥å
³è”è¡¨ã€‚
ä½ ä¹Ÿå¯ä»¥ä¼  <code>$joinType</code> å‚æ•°æ¥å®šåˆ¶è¿æ¥ç±»å‹ã€‚
ä½ ä¹Ÿå¯ä»¥ä½¿ç”¨ <a href="./yii-db-activequery.html#innerJoinWith()-detail">innerJoinWith()</a>ã€‚</p>
<p>ä»¥ä¸‹æ˜¯ <code>INNER JOIN</code> çš„ç®€çŸ­ä¾‹å­ï¼š</p>
<pre><code class="language-php"><span style="color: #0000BB"></span><span style="color: #FF8000">//&nbsp;æŸ¥æ‰¾åŒ<br /></span><span style="color: #0000BB">æ‹¬ä¹¦ç±çš„æ‰€æœ‰è®¢å•ï¼Œä½†&nbsp;</span><span style="color: #DD0000">"books"&nbsp;</span><span style="color: #0000BB">è¡¨ä¸ä½¿ç”¨å³æ—¶åŠ è½½<br />$orders&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">Order</span><span style="color: #007700">::</span><span style="color: #0000BB">find</span><span style="color: #007700">()-&gt;</span><span style="color: #0000BB">innerJoinWith</span><span style="color: #007700">(</span><span style="color: #DD0000">'books'</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">false</span><span style="color: #007700">)-&gt;</span><span style="color: #0000BB">all</span><span style="color: #007700">();<br /></span><span style="color: #FF8000">//&nbsp;ç­‰ä»·äºï¼š<br /></span><span style="color: #0000BB">$orders&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">Order</span><span style="color: #007700">::</span><span style="color: #0000BB">find</span><span style="color: #007700">()-&gt;</span><span style="color: #0000BB">joinWith</span><span style="color: #007700">(</span><span style="color: #DD0000">'books'</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">false</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">'INNER&nbsp;JOIN'</span><span style="color: #007700">)-&gt;</span><span style="color: #0000BB">all</span><span style="color: #007700">();</span></code></pre>
<p>æœ‰æ—¶è¿æ¥ä¸¤ä¸ªè¡¨æ—¶ï¼Œéœ€è¦åœ¨å
³è”æŸ¥è¯¢çš„ ON éƒ¨åˆ†æŒ‡å®šé¢å¤–æ¡ä»¶ã€‚
è¿™å¯ä»¥é€šè¿‡è°ƒç”¨ <a href="./yii-db-activequery.html#onCondition()-detail">yii\db\ActiveQuery::onCondition()</a> æ–¹æ³•å®ç°ï¼š</p>
<pre><code class="language-php"><span style="color: #0000BB"></span><span style="color: #007700">class&nbsp;</span><span style="color: #0000BB">User&nbsp;</span><span style="color: #007700">extends&nbsp;</span><span style="color: #0000BB">ActiveRecord<br /></span><span style="color: #007700">{<br />&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;function&nbsp;</span><span style="color: #0000BB">getBooks</span><span style="color: #007700">()<br />&nbsp;&nbsp;&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">hasMany</span><span style="color: #007700">(</span><span style="color: #0000BB">Item</span><span style="color: #007700">::</span><span style="color: #0000BB">className</span><span style="color: #007700">(),&nbsp;[</span><span style="color: #DD0000">'owner_id'&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #DD0000">'id'</span><span style="color: #007700">])-&gt;</span><span style="color: #0000BB">onCondition</span><span style="color: #007700">([</span><span style="color: #DD0000">'category_id'&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #0000BB">1</span><span style="color: #007700">]);<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br />}</span></code></pre>
<p>åœ¨ä¸Šé¢ï¼Œ <a href="./yii-db-baseactiverecord.html#hasMany()-detail">hasMany()</a> æ–¹æ³•å›ä¼ äº†ä¸€ä¸ª <a href="./yii-db-activequery.html">yii\db\ActiveQuery</a> å¯¹è±¡ï¼Œ
å½“ä½ ç”¨ <a href="./yii-db-activequery.html#joinWith()-detail">joinWith()</a> æ‰§è¡Œä¸€æ¡æŸ¥è¯¢æ—¶ï¼Œå–å†³äºæ­£è¢«è°ƒç”¨çš„æ˜¯å“ªä¸ª <a href="./yii-db-activequery.html#onCondition()-detail">onCondition()</a>ï¼Œ
è¿”å› <code>category_id</code> ä¸º 1 çš„ items </p>
<p>å½“ä½ ç”¨ <a href="./yii-db-activequery.html#joinWith()-detail">joinWith()</a> è¿›è¡Œä¸€æ¬¡æŸ¥è¯¢æ—¶ï¼Œâ€œon-conditionâ€æ¡ä»¶ä¼šè¢«æ”¾ç½®åœ¨ç›¸åº”æŸ¥è¯¢è¯­å¥çš„ ON éƒ¨åˆ†ï¼Œ
å¦‚ï¼š</p>
<pre><code class="language-php"><span style="color: #0000BB"></span><span style="color: #FF8000">//&nbsp;SELECT&nbsp;user.*&nbsp;FROM&nbsp;user&nbsp;LEFT&nbsp;JOIN&nbsp;item&nbsp;ON&nbsp;item.owner_id=user.id&nbsp;AND&nbsp;category_id=1<br />//&nbsp;SELECT&nbsp;*&nbsp;FROM&nbsp;item&nbsp;WHERE&nbsp;owner_id&nbsp;IN&nbsp;(...)&nbsp;AND&nbsp;category_id=1<br /></span><span style="color: #0000BB">$users&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">User</span><span style="color: #007700">::</span><span style="color: #0000BB">find</span><span style="color: #007700">()-&gt;</span><span style="color: #0000BB">joinWith</span><span style="color: #007700">(</span><span style="color: #DD0000">'books'</span><span style="color: #007700">)-&gt;</span><span style="color: #0000BB">all</span><span style="color: #007700">();</span></code></pre>
<p>æ³¨æ„ï¼šå¦‚æœé€šè¿‡ <a href="./yii-db-activequerytrait.html#with()-detail">yii\db\ActiveQuery::with()</a> è¿›è¡Œè´ªå©ªåŠ è½½æˆ–ä½¿ç”¨æƒ°æ€§åŠ è½½çš„è¯ï¼Œåˆ™ on æ¡ä»¶ä¼šè¢«æ”¾ç½®åœ¨å¯¹åº” SQLè¯­å¥çš„ <code>WHERE</code> éƒ¨åˆ†ã€‚
å› ä¸ºï¼Œæ­¤æ—¶æ­¤å¤„å¹¶æ²¡æœ‰å‘ç”Ÿ JOIN æŸ¥è¯¢ã€‚æ¯”å¦‚ï¼š</p>
<pre><code class="language-php"><span style="color: #0000BB"></span><span style="color: #FF8000">//&nbsp;SELECT&nbsp;*&nbsp;FROM&nbsp;user&nbsp;WHERE&nbsp;id=10<br /></span><span style="color: #0000BB">$user&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">User</span><span style="color: #007700">::</span><span style="color: #0000BB">findOne</span><span style="color: #007700">(</span><span style="color: #0000BB">10</span><span style="color: #007700">);<br /></span><span style="color: #FF8000">//&nbsp;SELECT&nbsp;*&nbsp;FROM&nbsp;item&nbsp;WHERE&nbsp;owner_id=10&nbsp;AND&nbsp;category_id=1<br /></span><span style="color: #0000BB">$books&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$user</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">books</span><span style="color: #007700">;</span></code></pre>
<p>å</p>
<h2>³è”è¡¨æ“ä½œ <a href="#" name="" class="hashlink">&para;</a></h2><p>AR æä¾›äº†ä¸‹é¢ä¸¤ä¸ªæ–¹æ³•ç”¨æ¥å»ºç«‹å’Œè§£é™¤ä¸¤ä¸ªå
³è”å¯¹è±¡ä¹‹é—´çš„å
³ç³»ï¼š</p>
<ul>
<li><a href="./yii-db-baseactiverecord.html#link()-detail">link()</a></li>
<li><a href="./yii-db-baseactiverecord.html#unlink()-detail">unlink()</a></li>
</ul>
<p>ä¾‹å¦‚ï¼Œç»™å®šä¸€ä¸ªcustomerå’Œorderå¯¹è±¡ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ä¸‹é¢çš„ä»£ç ä½¿å¾—customerå¯¹è±¡æ‹¥æœ‰orderå¯¹è±¡ï¼š</p>
<pre><code class="language-php"><span style="color: #0000BB">$customer&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">Customer</span><span style="color: #007700">::</span><span style="color: #0000BB">findOne</span><span style="color: #007700">(</span><span style="color: #0000BB">1</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">$order&nbsp;</span><span style="color: #007700">=&nbsp;new&nbsp;</span><span style="color: #0000BB">Order</span><span style="color: #007700">();<br /></span><span style="color: #0000BB">$order</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">subtotal&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">100</span><span style="color: #007700">;<br /></span><span style="color: #0000BB">$customer</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">link</span><span style="color: #007700">(</span><span style="color: #DD0000">'orders'</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$order</span><span style="color: #007700">);</span></code></pre>
<p><a href="./yii-db-baseactiverecord.html#link()-detail">link()</a> è°ƒç”¨ä¸Šè¿°å°†è®¾ç½® customer_id çš„é¡ºåºæ˜¯ $customer çš„ä¸»é”®å€¼ï¼Œç„¶åè°ƒç”¨ <a href="./yii-db-baseactiverecord.html#save()-detail">save()</a> è¦å°†é¡ºåºä¿å­˜åˆ°æ•°æ®åº“ä¸­ã€‚</p>
<h2>ä½œç”¨åŸŸ <a href="#" name="" class="hashlink">&para;</a></h2><p>å½“ä½ è°ƒç”¨<a href="./yii-db-activerecord.html#find()-detail">find()</a> æˆ– <a href="./yii-db-activerecord.html#findBySql()-detail">findBySql()</a>æ–¹æ³•æ—¶ï¼Œå°†ä¼šè¿”å›ä¸€ä¸ª<a href="./yii-db-activequery.html">ActiveQuery</a>å®ä¾‹ã€‚ä¹‹åï¼Œä½ å¯ä»¥è°ƒç”¨å
¶ä»–æŸ¥è¯¢æ–¹æ³•ï¼Œå¦‚ <a href="./yii-db-querytrait.html#where()-detail">where()</a>ï¼Œ<a href="./yii-db-querytrait.html#orderBy()-detail">orderBy()</a>, è¿›ä¸€æ­¥çš„æŒ‡å®šæŸ¥è¯¢æ¡ä»¶ã€‚</p>
<p>æœ‰æ—¶å€™ä½ å¯èƒ½éœ€è¦åœ¨ä¸åŒçš„åœ°æ–¹ä½¿ç”¨ç›¸åŒçš„æŸ¥è¯¢æ–¹æ³•ã€‚å¦‚æœå‡ºç°è¿™ç§æƒ
å†µï¼Œä½ åº”è¯¥è€ƒè™‘å®šä¹‰æ‰€è°“çš„ä½œç”¨åŸŸã€‚ä½œç”¨åŸŸæ˜¯æœ¬è´¨ä¸Šè¦æ±‚ä¸€ç»„çš„æŸ¥è¯¢æ–¹æ³•æ¥ä¿®æ”¹æŸ¥è¯¢å¯¹è±¡çš„è‡ªå®šä¹‰æŸ¥è¯¢ç±»ä¸­å®šä¹‰çš„æ–¹æ³•ã€‚ ä¹‹åä½ å°±å¯ä»¥åƒä½¿ç”¨æ™®é€šæ–¹æ³•ä¸€æ ·ä½¿ç”¨ä½œç”¨åŸŸã€‚</p>
<p>åªéœ€ä¸¤æ­¥å³å¯å®šä¹‰ä¸€ä¸ªä½œç”¨åŸŸã€‚é¦–å
ˆç»™ä½ çš„modelåˆ›å»ºä¸€ä¸ªè‡ªå®šä¹‰çš„æŸ¥è¯¢ç±»ï¼Œåœ¨æ­¤ç±»ä¸­å®šä¹‰çš„æ‰€éœ€çš„èŒƒå›´æ–¹æ³•ã€‚ä¾‹å¦‚ï¼Œç»™Commentæ¨¡å‹åˆ›å»ºä¸€ä¸ª CommentQueryç±»ï¼Œç„¶ååœ¨CommentQueryç±»ä¸­å®šä¹‰ä¸€ä¸ªactive()çš„æ–¹æ³•ä¸ºä½œç”¨åŸŸï¼Œåƒä¸‹é¢çš„ä»£ç ï¼š</p>
<pre><code class="language-php"><span style="color: #0000BB"></span><span style="color: #007700">namespace&nbsp;</span><span style="color: #0000BB">app</span><span style="color: #007700">\</span><span style="color: #0000BB">models</span><span style="color: #007700">;<br /><br />use&nbsp;</span><span style="color: #0000BB">yii</span><span style="color: #007700">\</span><span style="color: #0000BB">db</span><span style="color: #007700">\</span><span style="color: #0000BB">ActiveQuery</span><span style="color: #007700">;<br /><br />class&nbsp;</span><span style="color: #0000BB">CommentQuery&nbsp;</span><span style="color: #007700">extends&nbsp;</span><span style="color: #0000BB">ActiveQuery<br /></span><span style="color: #007700">{<br />&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;function&nbsp;</span><span style="color: #0000BB">active</span><span style="color: #007700">(</span><span style="color: #0000BB">$state&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">true</span><span style="color: #007700">)<br />&nbsp;&nbsp;&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">andWhere</span><span style="color: #007700">([</span><span style="color: #DD0000">'active'&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #0000BB">$state</span><span style="color: #007700">]);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;</span><span style="color: #0000BB">$this</span><span style="color: #007700">;<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br />}</span></code></pre>
<p>é‡ç‚¹:</p>
<ol>
<li>ç±»å¿
é¡»ç»§æ‰¿ yii\db\ActiveQuery (æˆ–è€
æ˜¯å
¶ä»–çš„ ActiveQuery ï¼Œæ¯”å¦‚ yii\mongodb\ActiveQuery)ã€‚</li>
<li>å¿
é¡»æ˜¯ä¸€ä¸ªpublicç±»å‹çš„æ–¹æ³•ä¸”å¿
é¡»è¿”å› $this å®ç°é“¾å¼æ“ä½œã€‚å¯ä»¥ä¼ å
¥å‚æ•°ã€‚</li>
<li>æ£€æŸ¥ <a href="./yii-db-activequery.html">yii\db\ActiveQuery</a> å¯¹äºä¿®æ”¹æŸ¥è¯¢æ¡ä»¶æ˜¯éå¸¸æœ‰ç”¨çš„æ–¹æ³•ã€‚</li>
</ol>
<p>å
¶æ¬¡ï¼Œè¦†ç›–<a href="./yii-db-activerecord.html#find()-detail">yii\db\ActiveRecord::find()</a> æ–¹æ³•ä½¿å
¶è¿”å›è‡ªå®šä¹‰çš„æŸ¥è¯¢å¯¹è±¡è€Œä¸æ˜¯å¸¸è§„çš„<a href="./yii-db-activequery.html">ActiveQuery</a>ã€‚å¯¹äºä¸Šè¿°ä¾‹å­ï¼Œä½ éœ€è¦ç¼–å†™å¦‚ä¸‹ä»£ç ï¼š</p>
<pre><code class="language-php"><span style="color: #0000BB"></span><span style="color: #007700">namespace&nbsp;</span><span style="color: #0000BB">app</span><span style="color: #007700">\</span><span style="color: #0000BB">models</span><span style="color: #007700">;<br /><br />use&nbsp;</span><span style="color: #0000BB">yii</span><span style="color: #007700">\</span><span style="color: #0000BB">db</span><span style="color: #007700">\</span><span style="color: #0000BB">ActiveRecord</span><span style="color: #007700">;<br /><br />class&nbsp;</span><span style="color: #0000BB">Comment&nbsp;</span><span style="color: #007700">extends&nbsp;</span><span style="color: #0000BB">ActiveRecord<br /></span><span style="color: #007700">{<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">/**<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@inheritdoc<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@return&nbsp;CommentQuery<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">public&nbsp;static&nbsp;function&nbsp;</span><span style="color: #0000BB">find</span><span style="color: #007700">()<br />&nbsp;&nbsp;&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;new&nbsp;</span><span style="color: #0000BB">CommentQuery</span><span style="color: #007700">(</span><span style="color: #0000BB">get_called_class</span><span style="color: #007700">());<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br />}</span></code></pre>
<p>å°±è¿™æ ·ï¼Œç°åœ¨ä½ å¯ä»¥ä½¿ç”¨è‡ªå®šä¹‰çš„ä½œç”¨åŸŸæ–¹æ³•äº†ï¼š</p>
<pre><code class="language-php"><span style="color: #0000BB">$comments&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">Comment</span><span style="color: #007700">::</span><span style="color: #0000BB">find</span><span style="color: #007700">()-&gt;</span><span style="color: #0000BB">active</span><span style="color: #007700">()-&gt;</span><span style="color: #0000BB">all</span><span style="color: #007700">();<br /></span><span style="color: #0000BB">$inactiveComments&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">Comment</span><span style="color: #007700">::</span><span style="color: #0000BB">find</span><span style="color: #007700">()-&gt;</span><span style="color: #0000BB">active</span><span style="color: #007700">(</span><span style="color: #0000BB">false</span><span style="color: #007700">)-&gt;</span><span style="color: #0000BB">all</span><span style="color: #007700">();</span></code></pre>
<p>ä½ ä¹Ÿèƒ½åœ¨å®šä¹‰çš„å
³è”é‡Œä½¿ç”¨ä½œç”¨åŸŸæ–¹æ³•ï¼Œæ¯”å¦‚ï¼š</p>
<pre><code class="language-php"><span style="color: #0000BB"></span><span style="color: #007700">class&nbsp;</span><span style="color: #0000BB">Post&nbsp;</span><span style="color: #007700">extends&nbsp;\</span><span style="color: #0000BB">yii</span><span style="color: #007700">\</span><span style="color: #0000BB">db</span><span style="color: #007700">\</span><span style="color: #0000BB">ActiveRecord<br /></span><span style="color: #007700">{<br />&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;function&nbsp;</span><span style="color: #0000BB">getActiveComments</span><span style="color: #007700">()<br />&nbsp;&nbsp;&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">hasMany</span><span style="color: #007700">(</span><span style="color: #0000BB">Comment</span><span style="color: #007700">::</span><span style="color: #0000BB">className</span><span style="color: #007700">(),&nbsp;[</span><span style="color: #DD0000">'post_id'&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #DD0000">'id'</span><span style="color: #007700">])-&gt;</span><span style="color: #0000BB">active</span><span style="color: #007700">();<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;}<br />}</span></code></pre>
<p>æˆ–è€
åœ¨æ‰§è¡Œå
³è”æŸ¥è¯¢çš„æ—¶å€™ä½¿ç”¨ï¼ˆon-the-fly æ˜¯å•¥ï¼Ÿï¼‰ï¼š</p>
<pre><code class="language-php"><span style="color: #0000BB">$posts&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">Post</span><span style="color: #007700">::</span><span style="color: #0000BB">find</span><span style="color: #007700">()-&gt;</span><span style="color: #0000BB">with</span><span style="color: #007700">([<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #DD0000">'comments'&nbsp;</span><span style="color: #007700">=&gt;&nbsp;function(</span><span style="color: #0000BB">$q</span><span style="color: #007700">)&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$q</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">active</span><span style="color: #007700">();<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br />])-&gt;</span><span style="color: #0000BB">all</span><span style="color: #007700">();</span></code></pre>
<h3>é»˜è®¤ä½œç”¨åŸŸ <a href="#" name="" class="hashlink">&para;</a></h3><p>å¦‚æœä½ ä¹‹å‰ç”¨è¿‡ Yii 1.1 å°±åº”è¯¥çŸ¥é“é»˜è®¤ä½œç”¨åŸŸçš„æ¦‚å¿µã€‚ä¸€ä¸ªé»˜è®¤çš„ä½œç”¨åŸŸå¯ä»¥ä½œç”¨äºæ‰€æœ‰æŸ¥è¯¢ã€‚ä½ å¯ä»¥å¾ˆå®¹æ˜“çš„é€šè¿‡é‡å†™<a href="./yii-db-activerecord.html#find()-detail">yii\db\ActiveRecord::find()</a>æ–¹æ³•æ¥å®šä¹‰ä¸€ä¸ªé»˜è®¤ä½œç”¨åŸŸï¼Œä¾‹å¦‚ï¼š</p>
<pre><code class="language-php"><span style="color: #0000BB"></span><span style="color: #007700">public&nbsp;static&nbsp;function&nbsp;</span><span style="color: #0000BB">find</span><span style="color: #007700">()<br />{<br />&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;</span><span style="color: #0000BB">parent</span><span style="color: #007700">::</span><span style="color: #0000BB">find</span><span style="color: #007700">()-&gt;</span><span style="color: #0000BB">where</span><span style="color: #007700">([</span><span style="color: #DD0000">'deleted'&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #0000BB">false</span><span style="color: #007700">]);<br />}</span></code></pre>
<p>æ³¨æ„ï¼Œä½ ä¹‹åæ‰€æœ‰çš„æŸ¥è¯¢éƒ½ä¸èƒ½ç”¨ <a href="./yii-db-querytrait.html#where()-detail">where()</a>ï¼Œä½†æ˜¯å¯ä»¥ç”¨ <a href="./yii-db-querytrait.html#andWhere()-detail">andWhere()</a> å’Œ <a href="./yii-db-querytrait.html#orWhere()-detail">orWhere()</a>ï¼Œä»–ä»¬ä¸ä¼šè¦†ç›–æ‰é»˜è®¤ä½œç”¨åŸŸã€‚ï¼ˆè¯‘è€
æ³¨ï¼šå¦‚æœä½ è¦ä½¿ç”¨é»˜è®¤ä½œç”¨åŸŸï¼Œå°±ä¸èƒ½åœ¨ xxx::find()åä½¿ç”¨where()æ–¹æ³•ï¼Œä½ å¿
é¡»ä½¿ç”¨andXXX()æˆ–è€
orXXX()ç³»çš„æ–¹æ³•ï¼Œå¦åˆ™é»˜è®¤ä½œç”¨åŸŸä¸ä¼šèµ·æ•ˆæœï¼Œè‡³äºåŸå› ï¼Œæ‰“å¼€where()æ–¹æ³•çš„ä»£ç ä¸€çœ‹ä¾¿çŸ¥ï¼‰</p>
<h2>äº‹åŠ¡æ“ä½œ <a href="#" name="" class="hashlink">&para;</a></h2><p>å½“æ‰§è¡Œå‡ ä¸ªç›¸å
³è”çš„æ•°æ®åº“æ“ä½œçš„æ—¶å€™</p>
<p>TODO: FIXME: WIP, TBD, <a href="https://github.com/yiisoft/yii2/issues/226">https://github.com/yiisoft/yii2/issues/226</a></p>
<p>, <a href="./yii-db-baseactiverecord.html#afterSave()-detail">afterSave()</a>, <a href="./yii-db-baseactiverecord.html#beforeDelete()-detail">beforeDelete()</a> and/or <a href="./yii-db-baseactiverecord.html#afterDelete()-detail">afterDelete()</a> ç”Ÿå‘½å‘¨æœŸå‘¨æœŸæ–¹æ³•(life cycle methods æˆ‘è§‰å¾—è¿™å¥ç¿»è¯‘æˆâ€œæ¨¡æ¿æ–¹æ³•â€ä¼šä¸ä¼šæ›´å¥½ç‚¹ï¼Ÿ)ã€‚å¼€å‘è€
å¯ä»¥é€šè¿‡é‡å†™<a href="./yii-db-baseactiverecord.html#save()-detail">save()</a>æ–¹æ³•ç„¶ååœ¨æ§åˆ¶å™¨é‡Œä½¿ç”¨äº‹åŠ¡æ“ä½œï¼Œä¸¥æ ¼åœ°è¯´æ˜¯ä¼¼ä¹ä¸æ˜¯ä¸€ä¸ªå¥½çš„åšæ³• ï¼ˆå¬å›"ç˜¦æ§åˆ¶å™¨ / è‚¥æ¨¡å‹"åŸºæœ¬è§„åˆ™ï¼‰ã€‚</p>
<p>è¿™äº›æ–¹æ³•åœ¨è¿™é‡Œ(å¦‚æœä½ ä¸æ˜ç™½è‡ªå·±å®é™
åœ¨å¹²ä»€ä¹ˆï¼Œè¯·ä¸è¦ä½¿ç”¨ä»–ä»¬)ï¼ŒModelsï¼š</p>
<pre><code class="language-php"><span style="color: #0000BB"></span><span style="color: #007700">class&nbsp;</span><span style="color: #0000BB">Feature&nbsp;</span><span style="color: #007700">extends&nbsp;\</span><span style="color: #0000BB">yii</span><span style="color: #007700">\</span><span style="color: #0000BB">db</span><span style="color: #007700">\</span><span style="color: #0000BB">ActiveRecord<br /></span><span style="color: #007700">{<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">//&nbsp;...<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">public&nbsp;function&nbsp;</span><span style="color: #0000BB">getProduct</span><span style="color: #007700">()<br />&nbsp;&nbsp;&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">hasOne</span><span style="color: #007700">(</span><span style="color: #0000BB">Product</span><span style="color: #007700">::</span><span style="color: #0000BB">className</span><span style="color: #007700">(),&nbsp;[</span><span style="color: #DD0000">'id'&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #DD0000">'product_id'</span><span style="color: #007700">]);<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br />}<br /><br />class&nbsp;</span><span style="color: #0000BB">Product&nbsp;</span><span style="color: #007700">extends&nbsp;\</span><span style="color: #0000BB">yii</span><span style="color: #007700">\</span><span style="color: #0000BB">db</span><span style="color: #007700">\</span><span style="color: #0000BB">ActiveRecord<br /></span><span style="color: #007700">{<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">//&nbsp;...<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">public&nbsp;function&nbsp;</span><span style="color: #0000BB">getFeatures</span><span style="color: #007700">()<br />&nbsp;&nbsp;&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">hasMany</span><span style="color: #007700">(</span><span style="color: #0000BB">Feature</span><span style="color: #007700">::</span><span style="color: #0000BB">className</span><span style="color: #007700">(),&nbsp;[</span><span style="color: #DD0000">'product_id'&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #DD0000">'id'</span><span style="color: #007700">]);<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br />}</span></code></pre>
<p>é‡å†™ <a href="./yii-db-baseactiverecord.html#save()-detail">save()</a> æ–¹æ³•ï¼š</p>
<pre><code class="language-php"><span style="color: #0000BB"></span><span style="color: #007700">class&nbsp;</span><span style="color: #0000BB">ProductController&nbsp;</span><span style="color: #007700">extends&nbsp;\</span><span style="color: #0000BB">yii</span><span style="color: #007700">\</span><span style="color: #0000BB">web</span><span style="color: #007700">\</span><span style="color: #0000BB">Controller<br /></span><span style="color: #007700">{<br />&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;function&nbsp;</span><span style="color: #0000BB">actionCreate</span><span style="color: #007700">()<br />&nbsp;&nbsp;&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">//&nbsp;FIXME:&nbsp;TODO:&nbsp;WIP,&nbsp;TBD<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">}<br />}</span></code></pre>
<p>(è¯‘è€
æ³¨ï¼šæˆ‘è§‰å¾—ä¸Šé¢åº”è¯¥æ˜¯åŸæ‰‹å†Œé‡Œçš„bug)</p>
<p>åœ¨æ§åˆ¶å™¨å±‚ä½¿ç”¨äº‹åŠ¡ï¼š</p>
<pre><code class="language-php"><span style="color: #0000BB"></span><span style="color: #007700">class&nbsp;</span><span style="color: #0000BB">ProductController&nbsp;</span><span style="color: #007700">extends&nbsp;\</span><span style="color: #0000BB">yii</span><span style="color: #007700">\</span><span style="color: #0000BB">web</span><span style="color: #007700">\</span><span style="color: #0000BB">Controller<br /></span><span style="color: #007700">{<br />&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;function&nbsp;</span><span style="color: #0000BB">actionCreate</span><span style="color: #007700">()<br />&nbsp;&nbsp;&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">//&nbsp;FIXME:&nbsp;TODO:&nbsp;WIP,&nbsp;TBD<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">}<br />}</span></code></pre>
<p>ä½œä¸ºè¿™äº›è„†å¼±æ–¹æ³•çš„æ›¿ä»£ï¼Œä½ åº”è¯¥ä½¿ç”¨åŸå­æ“ä½œæ–¹æ¡ˆç‰¹æ€§ã€‚</p>
<pre><code class="language-php"><span style="color: #0000BB"></span><span style="color: #007700">class&nbsp;</span><span style="color: #0000BB">Feature&nbsp;</span><span style="color: #007700">extends&nbsp;\</span><span style="color: #0000BB">yii</span><span style="color: #007700">\</span><span style="color: #0000BB">db</span><span style="color: #007700">\</span><span style="color: #0000BB">ActiveRecord<br /></span><span style="color: #007700">{<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">//&nbsp;...<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">public&nbsp;function&nbsp;</span><span style="color: #0000BB">getProduct</span><span style="color: #007700">()<br />&nbsp;&nbsp;&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">hasOne</span><span style="color: #007700">(</span><span style="color: #0000BB">Product</span><span style="color: #007700">::</span><span style="color: #0000BB">className</span><span style="color: #007700">(),&nbsp;[</span><span style="color: #DD0000">'product_id'&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #DD0000">'id'</span><span style="color: #007700">]);<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;function&nbsp;</span><span style="color: #0000BB">scenarios</span><span style="color: #007700">()<br />&nbsp;&nbsp;&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;[<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #DD0000">'userCreates'&nbsp;</span><span style="color: #007700">=&gt;&nbsp;[<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #DD0000">'attributes'&nbsp;</span><span style="color: #007700">=&gt;&nbsp;[</span><span style="color: #DD0000">'name'</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">'value'</span><span style="color: #007700">],<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #DD0000">'atomic'&nbsp;</span><span style="color: #007700">=&gt;&nbsp;[</span><span style="color: #0000BB">self</span><span style="color: #007700">::</span><span style="color: #0000BB">OP_INSERT</span><span style="color: #007700">],<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;],<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;];<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br />}<br /><br />class&nbsp;</span><span style="color: #0000BB">Product&nbsp;</span><span style="color: #007700">extends&nbsp;\</span><span style="color: #0000BB">yii</span><span style="color: #007700">\</span><span style="color: #0000BB">db</span><span style="color: #007700">\</span><span style="color: #0000BB">ActiveRecord<br /></span><span style="color: #007700">{<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">//&nbsp;...<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">public&nbsp;function&nbsp;</span><span style="color: #0000BB">getFeatures</span><span style="color: #007700">()<br />&nbsp;&nbsp;&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">hasMany</span><span style="color: #007700">(</span><span style="color: #0000BB">Feature</span><span style="color: #007700">::</span><span style="color: #0000BB">className</span><span style="color: #007700">(),&nbsp;[</span><span style="color: #DD0000">'id'&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #DD0000">'product_id'</span><span style="color: #007700">]);<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;function&nbsp;</span><span style="color: #0000BB">scenarios</span><span style="color: #007700">()<br />&nbsp;&nbsp;&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;[<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #DD0000">'userCreates'&nbsp;</span><span style="color: #007700">=&gt;&nbsp;[<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #DD0000">'attributes'&nbsp;</span><span style="color: #007700">=&gt;&nbsp;[</span><span style="color: #DD0000">'title'</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">'price'</span><span style="color: #007700">],<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #DD0000">'atomic'&nbsp;</span><span style="color: #007700">=&gt;&nbsp;[</span><span style="color: #0000BB">self</span><span style="color: #007700">::</span><span style="color: #0000BB">OP_INSERT</span><span style="color: #007700">],<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;],<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;];<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;function&nbsp;</span><span style="color: #0000BB">afterValidate</span><span style="color: #007700">()<br />&nbsp;&nbsp;&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">parent</span><span style="color: #007700">::</span><span style="color: #0000BB">afterValidate</span><span style="color: #007700">();<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">//&nbsp;FIXME:&nbsp;TODO:&nbsp;WIP,&nbsp;TBD<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">}<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;function&nbsp;</span><span style="color: #0000BB">afterSave</span><span style="color: #007700">(</span><span style="color: #0000BB">$insert</span><span style="color: #007700">)<br />&nbsp;&nbsp;&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">parent</span><span style="color: #007700">::</span><span style="color: #0000BB">afterSave</span><span style="color: #007700">(</span><span style="color: #0000BB">$insert</span><span style="color: #007700">);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">getScenario</span><span style="color: #007700">()&nbsp;===&nbsp;</span><span style="color: #DD0000">'userCreates'</span><span style="color: #007700">)&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">//&nbsp;FIXME:&nbsp;TODO:&nbsp;WIP,&nbsp;TBD<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">}<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br />}</span></code></pre>
<p>Controlleré‡Œçš„ä»£ç å°†å˜å¾—å¾ˆç®€æ´ï¼š</p>
<pre><code class="language-php"><span style="color: #0000BB"></span><span style="color: #007700">class&nbsp;</span><span style="color: #0000BB">ProductController&nbsp;</span><span style="color: #007700">extends&nbsp;\</span><span style="color: #0000BB">yii</span><span style="color: #007700">\</span><span style="color: #0000BB">web</span><span style="color: #007700">\</span><span style="color: #0000BB">Controller<br /></span><span style="color: #007700">{<br />&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;function&nbsp;</span><span style="color: #0000BB">actionCreate</span><span style="color: #007700">()<br />&nbsp;&nbsp;&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">//&nbsp;FIXME:&nbsp;TODO:&nbsp;WIP,&nbsp;TBD<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">}<br />}</span></code></pre>
<p>æ§åˆ¶å™¨éå¸¸ç®€æ´ï¼š</p>
<pre><code class="language-php"><span style="color: #0000BB"></span><span style="color: #007700">class&nbsp;</span><span style="color: #0000BB">ProductController&nbsp;</span><span style="color: #007700">extends&nbsp;\</span><span style="color: #0000BB">yii</span><span style="color: #007700">\</span><span style="color: #0000BB">web</span><span style="color: #007700">\</span><span style="color: #0000BB">Controller<br /></span><span style="color: #007700">{<br />&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;function&nbsp;</span><span style="color: #0000BB">actionCreate</span><span style="color: #007700">()<br />&nbsp;&nbsp;&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">//&nbsp;FIXME:&nbsp;TODO:&nbsp;WIP,&nbsp;TBD<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">}<br />}</span></code></pre>
<h2>ä¹è§‚é”ï¼ˆOptimistic Locksï¼‰ <a href="#optimistic-locks" name="optimistic-locks" class="hashlink">&para;</a></h2><p>TODO</p>
<h2>è¢«æ±¡æŸ“å±æ€§ <a href="#" name="" class="hashlink">&para;</a></h2><p>TODO</p>
<h2>å¦è§ <a href="#" name="" class="hashlink">&para;</a></h2><ul>
<li><a href="guide-model.html">æ¨¡å‹ï¼ˆModelï¼‰</a></li>
<li><a href="./yii-db-activerecord.html">yii\db\ActiveRecord</a></li>
</ul>
        <div class="toplink"><a href="#" class="h1" title="go to top"><span class="glyphicon glyphicon-arrow-up"></a></div>
    </div>
</div>


</div>

<footer class="footer">
        <p class="pull-right"><small>Page generated on Fri, 24 Oct 2014 20:33:00 +0200</small></p>
    Powered by <a href="http://www.yiiframework.com/" rel="external">Yii Framework</a></footer>

<script type="text/javascript">jQuery(document).ready(function () {
    var shiftWindow = function () { scrollBy(0, -50) };
    if (location.hash) shiftWindow();
    window.addEventListener("hashchange", shiftWindow);
var element = document.createElement("script");
element.src = "./jssearch.index.js";
document.body.appendChild(element);

var searchBox = $('#searchbox');

// focus the search field
searchBox.focus();

// search when typing in search field
searchBox.on("keyup", function(event) {
    var query = $(this).val();

    if (query == '' || event.which == 27) {
        $('#search-resultbox').hide();
        return;
    } else if (event.which == 13) {
        var selectedLink = $('#search-resultbox a.selected');
        if (selectedLink.length != 0) {
            document.location = selectedLink.attr('href');
            return;
        }
    } else if (event.which == 38 || event.which == 40) {
        $('#search-resultbox').show();

        var selected = $('#search-resultbox a.selected');
        if (selected.length == 0) {
            $('#search-results').find('a').first().addClass('selected');
        } else {
            var next;
            if (event.which == 40) {
                next = selected.parent().next().find('a').first();
            } else {
                next = selected.parent().prev().find('a').first();
            }
            if (next.length != 0) {
                var resultbox = $('#search-results');
                var position = next.position();

//              TODO scrolling is buggy and jumps around
//                resultbox.scrollTop(Math.floor(position.top));
//                console.log(position.top);

                selected.removeClass('selected');
                next.addClass('selected');
            }
        }

        return;
    }
    $('#search-resultbox').show();
    $('#search-results').html('<li><span class="no-results">No results</span></li>');

    var result = jssearch.search(query);

    if (result.length > 0) {
        var i = 0;
        var resHtml = '';

        for (var key in result) {
            if (i++ > 20) {
                break;
            }
            resHtml = resHtml +
            '<li><a href="' + result[key].file.u.substr(3) +'"><span class="title">' + result[key].file.t + '</span>' +
            '<span class="description">' + result[key].file.d + '</span></a></li>';
        }
        $('#search-results').html(resHtml);
    }
});

// hide the search results on ESC
$(document).on("keyup", function(event) { if (event.which == 27) { $('#search-resultbox').hide(); } });
// hide search results on click to document
$(document).bind('click', function (e) { $('#search-resultbox').hide(); });
// except the following:
searchBox.bind('click', function(e) { e.stopPropagation(); });
$('#search-resultbox').bind('click', function(e) { e.stopPropagation(); });

});</script></body>
</html>
