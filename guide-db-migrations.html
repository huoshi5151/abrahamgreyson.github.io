<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="language" content="en" />
        <link href="./assets/7ad99c2d/css/bootstrap.css" rel="stylesheet">
<link href="./assets/d607947b/style.css" rel="stylesheet">
<script src="./assets/ff75f2d2/jquery.js"></script>
<script src="./assets/7ad99c2d/js/bootstrap.js"></script>
<script src="./assets/ee9fb928/jssearch.js"></script>    <title>Yii Framework 2.0 API Documentation</title>
</head>
<body>

<div class="wrap">
    <nav id="w353" class="navbar-inverse navbar-fixed-top navbar" role="navigation"><div class="navbar-header"><button class="navbar-toggle" data-toggle="collapse" data-target="#w353-collapse"><span class="sr-only">Toggle navigation</span>
<span class="icon-bar"></span>
<span class="icon-bar"></span>
<span class="icon-bar"></span></button><a class="navbar-brand" href="./index.html">Yii 2.0 API 文档</a></div><div id="w353-collapse" class="collapse navbar-collapse"><ul id="w354" class="navbar-nav nav"><li><a href="./index.html">类参考</a></li>
<li class="dropdown"><a class="dropdown-toggle" href="#" data-toggle="dropdown">扩展 <b class="caret"></b></a><ul id="w355" class="dropdown-menu"><li><a href="./ext-apidoc-index.html" tabindex="-1">apidoc</a></li>
<li><a href="./ext-authclient-index.html" tabindex="-1">authclient</a></li>
<li><a href="./ext-bootstrap-index.html" tabindex="-1">bootstrap</a></li>
<li><a href="./ext-codeception-index.html" tabindex="-1">codeception</a></li>
<li><a href="./ext-composer-index.html" tabindex="-1">composer</a></li>
<li><a href="./ext-debug-index.html" tabindex="-1">debug</a></li>
<li><a href="./ext-elasticsearch-index.html" tabindex="-1">elasticsearch</a></li>
<li><a href="./ext-faker-index.html" tabindex="-1">faker</a></li>
<li><a href="./ext-gii-index.html" tabindex="-1">gii</a></li>
<li><a href="./ext-imagine-index.html" tabindex="-1">imagine</a></li>
<li><a href="./ext-jui-index.html" tabindex="-1">jui</a></li>
<li><a href="./ext-mongodb-index.html" tabindex="-1">mongodb</a></li>
<li><a href="./ext-redis-index.html" tabindex="-1">redis</a></li>
<li><a href="./ext-smarty-index.html" tabindex="-1">smarty</a></li>
<li><a href="./ext-sphinx-index.html" tabindex="-1">sphinx</a></li>
<li><a href="./ext-swiftmailer-index.html" tabindex="-1">swiftmailer</a></li>
<li><a href="./ext-twig-index.html" tabindex="-1">twig</a></li></ul></li>
<li><a href="./guide-README.html">权威指南</a></li>
<li class="dropdown"><a class="dropdown-toggle" href="#" data-toggle="dropdown">Github <b class="caret"></b></a><ul id="w356" class="dropdown-menu"><li><a href="https://github.com/yiisoft/yii2" tabindex="-1">Yii 2.0</a></li>
<li><a href="https://github.com/yii2-chinesization/yii2-zh-cn" tabindex="-1">Yii 2.0 中文化项目</a></li>
<li><a href="https://github.com/AbrahamGreyson/abrahamgreyson.github.io" tabindex="-1">docwithcn.com</a></li></ul></li></ul><div class="navbar-form navbar-left" role="search">
  <div class="form-group">
    <input id="searchbox" type="text" class="form-control" placeholder="Search">
  </div>
</div>
</div></nav>
    <div id="search-resultbox" style="display: none;" class="modal-content">
        <ul id="search-results">
        </ul>
    </div>

    
<div class="row">
    <div class="col-md-2">
                <div id="navigation" class="list-group"><a class="list-group-item" href="#navigation-336" data-toggle="collapse" data-parent="#navigation">介绍 <b class="caret"></b></a><div id="navigation-336" class="submenu panel-collapse collapse"><a class="list-group-item" href="./guide-intro-yii.html">关于 Yii</a>
<a class="list-group-item" href="./guide-intro-upgrade-from-v1.html">从 Yii 1.1 升级</a></div>
<a class="list-group-item" href="#navigation-337" data-toggle="collapse" data-parent="#navigation">入门 <b class="caret"></b></a><div id="navigation-337" class="submenu panel-collapse collapse"><a class="list-group-item" href="./guide-start-installation.html">安装 Yii</a>
<a class="list-group-item" href="./guide-start-workflow.html">运行应用</a>
<a class="list-group-item" href="./guide-start-hello.html">第一次问候</a>
<a class="list-group-item" href="./guide-start-forms.html">使用 Forms</a>
<a class="list-group-item" href="./guide-start-databases.html">玩转 Databases</a>
<a class="list-group-item" href="./guide-start-gii.html">用 Gii 生成代码</a>
<a class="list-group-item" href="./guide-start-looking-ahead.html">更上一层楼</a></div>
<a class="list-group-item" href="#navigation-338" data-toggle="collapse" data-parent="#navigation">应用结构 <b class="caret"></b></a><div id="navigation-338" class="submenu panel-collapse collapse"><a class="list-group-item" href="./guide-structure-overview.html">结构总览</a>
<a class="list-group-item" href="./guide-structure-entry-scripts.html">入口脚本</a>
<a class="list-group-item" href="./guide-structure-applications.html">应用</a>
<a class="list-group-item" href="./guide-structure-application-components.html">应用组件</a>
<a class="list-group-item" href="./guide-structure-controllers.html">控制器（Controller）</a>
<a class="list-group-item" href="./guide-structure-views.html">视图（View）</a>
<a class="list-group-item" href="./guide-structure-models.html">模型（Model）</a>
<a class="list-group-item" href="./guide-structure-filters.html">过滤器</a>
<a class="list-group-item" href="./guide-structure-widgets.html">小部件（Widget）</a>
<a class="list-group-item" href="./guide-structure-modules.html">模块（Module）</a>
<a class="list-group-item" href="./guide-structure-assets.html">前端资源（Asset）</a>
<a class="list-group-item" href="./guide-structure-extensions.html">扩展（extensions）</a></div>
<a class="list-group-item" href="#navigation-339" data-toggle="collapse" data-parent="#navigation">请求处理 <b class="caret"></b></a><div id="navigation-339" class="submenu panel-collapse collapse"><a class="list-group-item" href="./guide-runtime-bootstrapping.html">引导（Bootstrapping）</a>
<a class="list-group-item" href="./guide-runtime-routing.html">路由（Routing）</a>
<a class="list-group-item" href="./guide-runtime-requests.html">请求（Request）</a>
<a class="list-group-item" href="./guide-runtime-responses.html">响应（Response）</a>
<a class="list-group-item" href="./guide-runtime-sessions-cookies.html">Sessions（会话）和 Cookies</a>
<a class="list-group-item" href="./guide-runtime-url-handling.html">URL 解析和生成</a>
<a class="list-group-item" href="./guide-runtime-handling-errors.html">错误处理</a>
<a class="list-group-item" href="./guide-runtime-logging.html">日志</a></div>
<a class="list-group-item" href="#navigation-340" data-toggle="collapse" data-parent="#navigation">关键概念 <b class="caret"></b></a><div id="navigation-340" class="submenu panel-collapse collapse"><a class="list-group-item" href="./guide-concept-components.html">组件（Component）</a>
<a class="list-group-item" href="./guide-concept-properties.html">属性（Property）</a>
<a class="list-group-item" href="./guide-concept-events.html">事件（Event）</a>
<a class="list-group-item" href="./guide-concept-behaviors.html">行为（Behavior）</a>
<a class="list-group-item" href="./guide-concept-configurations.html">配置（Configurations）</a>
<a class="list-group-item" href="./guide-concept-autoloading.html">类自动加载（Autoloading）</a>
<a class="list-group-item" href="./guide-concept-alias.html">别名（Alias）</a>
<a class="list-group-item" href="./guide-concept-service-locator.html">服务定位器（Service Locator）</a>
<a class="list-group-item" href="./guide-concept-di-container.html">依赖注入容器（DI Container）</a></div>
<a class="list-group-item active" href="#navigation-341" data-toggle="collapse" data-parent="#navigation">配合数据库工作 <b class="caret"></b></a><div id="navigation-341" class="submenu panel-collapse collapse in"><a class="list-group-item" href="./guide-db-dao.html">数据访问对象（DAO）</a>
<a class="list-group-item" href="./guide-db-query-builder.html">查询生成器（Query Builder）</a>
<a class="list-group-item" href="./guide-db-active-record.html">活动记录（Active Record）</a>
<a class="list-group-item active" href="./guide-db-migrations.html">数据库迁移（Migration）</a>
<a class="list-group-item" href="./guide-db-sphinx.html">Sphinx</a>
<a class="list-group-item" href="./guide-db-redis.html">Redis</a>
<a class="list-group-item" href="./guide-db-mongodb.html">MongoDB</a>
<a class="list-group-item" href="./guide-db-elastic-search.html">ElasticSearch</a></div>
<a class="list-group-item" href="#navigation-342" data-toggle="collapse" data-parent="#navigation">接收用户数据 <b class="caret"></b></a><div id="navigation-342" class="submenu panel-collapse collapse"><a class="list-group-item" href="./guide-input-forms.html">创建表单</a>
<a class="list-group-item" href="./guide-input-validation.html">输入验证</a>
<a class="list-group-item" href="./guide-input-file-uploading.html">文件上传</a>
<a class="list-group-item" href="./guide-input-multiple-models.html">多模型同时输入</a></div>
<a class="list-group-item" href="#navigation-343" data-toggle="collapse" data-parent="#navigation">显示数据 <b class="caret"></b></a><div id="navigation-343" class="submenu panel-collapse collapse"><a class="list-group-item" href="./guide-output-formatting.html">格式化输出数据</a>
<a class="list-group-item" href="./guide-output-pagination.html">分页（Pagination）</a>
<a class="list-group-item" href="./guide-output-sorting.html">排序（Sorting）</a>
<a class="list-group-item" href="./guide-output-data-providers.html">数据提供器</a>
<a class="list-group-item" href="./guide-output-data-widgets.html">数据小部件</a>
<a class="list-group-item" href="./guide-output-theming.html">主题</a></div>
<a class="list-group-item" href="#navigation-344" data-toggle="collapse" data-parent="#navigation">安全 <b class="caret"></b></a><div id="navigation-344" class="submenu panel-collapse collapse"><a class="list-group-item" href="./guide-security-authentication.html">认证（Authentication）</a>
<a class="list-group-item" href="./guide-security-authorization.html">授权（Authorization）</a>
<a class="list-group-item" href="./guide-security-passwords.html">处理密码</a>
<a class="list-group-item" href="./guide-security-auth-clients.html">客户端认证</a>
<a class="list-group-item" href="./guide-security-best-practices.html">安全领域的最佳实践</a></div>
<a class="list-group-item" href="#navigation-345" data-toggle="collapse" data-parent="#navigation">缓存 <b class="caret"></b></a><div id="navigation-345" class="submenu panel-collapse collapse"><a class="list-group-item" href="./guide-caching-overview.html">概述</a>
<a class="list-group-item" href="./guide-caching-data.html">数据缓存</a>
<a class="list-group-item" href="./guide-caching-fragment.html">片段缓存</a>
<a class="list-group-item" href="./guide-caching-page.html">分页缓存</a>
<a class="list-group-item" href="./guide-caching-http.html">HTTP 缓存</a></div>
<a class="list-group-item" href="#navigation-346" data-toggle="collapse" data-parent="#navigation">RESTful Web 服务 <b class="caret"></b></a><div id="navigation-346" class="submenu panel-collapse collapse"><a class="list-group-item" href="./guide-rest-quick-start.html">快速入门</a>
<a class="list-group-item" href="./guide-rest-resources.html">资源</a>
<a class="list-group-item" href="./guide-rest-routing.html">路由</a>
<a class="list-group-item" href="./guide-rest-response-formatting.html">格式化响应</a>
<a class="list-group-item" href="./guide-rest-authentication.html">授权验证</a>
<a class="list-group-item" href="./guide-rest-rate-limiting.html">速率限制</a>
<a class="list-group-item" href="./guide-rest-versioning.html">版本化</a>
<a class="list-group-item" href="./guide-rest-error-handling.html">错误处理</a>
<a class="list-group-item" href="./guide-rest-testing.html">测试</a></div>
<a class="list-group-item" href="#navigation-347" data-toggle="collapse" data-parent="#navigation">开发工具 <b class="caret"></b></a><div id="navigation-347" class="submenu panel-collapse collapse"><a class="list-group-item" href="./guide-tool-debugger.html">调试工具栏和调试器</a>
<a class="list-group-item" href="./guide-tool-gii.html">使用 Gii 生成代码</a>
<a class="list-group-item" href="./guide-tool-api-doc.html">生成 API 文档</a></div>
<a class="list-group-item" href="#navigation-348" data-toggle="collapse" data-parent="#navigation">测试 <b class="caret"></b></a><div id="navigation-348" class="submenu panel-collapse collapse"><a class="list-group-item" href="./guide-test-overview.html">概述</a>
<a class="list-group-item" href="./guide-test-unit.html">单元测试</a>
<a class="list-group-item" href="./guide-test-functional.html">功能测试</a>
<a class="list-group-item" href="./guide-test-acceptance.html">验收测试</a>
<a class="list-group-item" href="./guide-test-fixtures.html">测试夹具</a></div>
<a class="list-group-item" href="#navigation-349" data-toggle="collapse" data-parent="#navigation">高级专题 <b class="caret"></b></a><div id="navigation-349" class="submenu panel-collapse collapse"><a class="list-group-item" href="./guide-tutorial-advanced-app.html">高级应用模版</a>
<a class="list-group-item" href="./guide-tutorial-start-from-scratch.html">从头构建自定义模版</a>
<a class="list-group-item" href="./guide-tutorial-console.html">控制台命令</a>
<a class="list-group-item" href="./guide-tutorial-core-validators.html">核心验证器</a>
<a class="list-group-item" href="./guide-tutorial-i18n.html">国际化</a>
<a class="list-group-item" href="./guide-tutorial-mailing.html">收发邮件</a>
<a class="list-group-item" href="./guide-tutorial-performance-tuning.html">性能优化</a>
<a class="list-group-item" href="./guide-tutorial-shared-hosting.html">共享主机环境</a>
<a class="list-group-item" href="./guide-tutorial-template-engines.html">模板引擎</a>
<a class="list-group-item" href="./guide-tutorial-yii-integration.html">集成第三方代码</a></div>
<a class="list-group-item" href="#navigation-350" data-toggle="collapse" data-parent="#navigation">小部件 <b class="caret"></b></a><div id="navigation-350" class="submenu panel-collapse collapse"><a class="list-group-item" href="./guide-widget-bootstrap.html">Bootstrap 小部件</a>
<a class="list-group-item" href="./guide-widget-jui.html">Jquery UI 小部件</a></div>
<a class="list-group-item" href="#navigation-351" data-toggle="collapse" data-parent="#navigation">助手类 <b class="caret"></b></a><div id="navigation-351" class="submenu panel-collapse collapse"><a class="list-group-item" href="./guide-helper-overview.html">助手一览</a>
<a class="list-group-item" href="./guide-helper-array.html">ArrayHelper</a>
<a class="list-group-item" href="./guide-helper-html.html">Html</a>
<a class="list-group-item" href="./guide-helper-url.html">Url</a>
<a class="list-group-item" href="./guide-helper-security.html">security</a></div>
<a class="list-group-item" href="#navigation-352" data-toggle="collapse" data-parent="#navigation">不在目录内的文件 <b class="caret"></b></a><div id="navigation-352" class="submenu panel-collapse collapse"><a class="list-group-item" href="./guide-glossary.html">glossary</a></div></div>    </div>
    <div class="col-md-9 guide-content" role="main">
        <h1>Database Migration <a href="#database-migration" name="database-migration" class="hashlink">&para;</a></h1>
<blockquote><p>Note: This section is under development.</p>
</blockquote>
<p>Like source code, the structure of a database evolves as a database-driven application is developed and maintained. For example, during development, a new table may be added; Or, after the application goes live, it may be discovered that an additional index is required. It is important to keep track of these structural database changes (called <strong>migration</strong>), just as changes to the source code is tracked using version control. If the source code and the database become out of sync, bugs will occur, or the whole application might break. For this reason, Yii provides a database migration
tool that can keep track of database migration history, apply new migrations, or revert existing ones.</p>
<p>The following steps show how database migration is used by a team during development:</p>
<ol>
<li>Tim creates a new migration (e.g. creates a new table, changes a column definition, etc.).</li>
<li>Tim commits the new migration into the source control system (e.g. Git, Mercurial).</li>
<li>Doug updates his repository from the source control system and receives the new migration.</li>
<li>Doug applies the migration to his local development database, thereby syncing his database to reflect the changes Tim made.</li>
</ol>
<p>Yii supports database migration via the <code>yii migrate</code> command line tool. This tool supports:</p>
<ul>
<li>Creating new migrations</li>
<li>Applying, reverting, and redoing migrations</li>
<li>Showing migration history and new migrations</li>
</ul>
<h2>Creating Migrations <a href="#creating-migrations" name="creating-migrations" class="hashlink">&para;</a></h2>
<p>To create a new migration, run the following command:</p>
<pre><code>yii migrate/create &lt;name&gt;
</code></pre>
<p>The required <code>name</code> parameter specifies a very brief description of the migration. For example, if the migration creates a new table named <em>news</em>, you'd use the command:</p>
<pre><code>yii migrate/create create_news_table
</code></pre>
<p>As you'll shortly see, the <code>name</code> parameter
is used as part of a PHP class name in the migration. Therefore, it should only contain letters,
digits and/or underscore characters.</p>
<p>The above command will create a new
file named <code>m101129_185401_create_news_table.php</code>. This file will be created within the <code>@app/migrations</code> directory. Initially, the migration file will be generated with the following code:</p>
<pre><code class="language-php"><span style="color: #0000BB"></span><span style="color: #007700">class&nbsp;</span><span style="color: #0000BB">m101129_185401_create_news_table&nbsp;</span><span style="color: #007700">extends&nbsp;\</span><span style="color: #0000BB">yii</span><span style="color: #007700">\</span><span style="color: #0000BB">db</span><span style="color: #007700">\</span><span style="color: #0000BB">Migration<br /></span><span style="color: #007700">{<br />&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;function&nbsp;</span><span style="color: #0000BB">up</span><span style="color: #007700">()<br />&nbsp;&nbsp;&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;function&nbsp;</span><span style="color: #0000BB">down</span><span style="color: #007700">()<br />&nbsp;&nbsp;&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;echo&nbsp;</span><span style="color: #DD0000">"m101129_185401_create_news_table&nbsp;cannot&nbsp;be&nbsp;reverted.\n"</span><span style="color: #007700">;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;</span><span style="color: #0000BB">false</span><span style="color: #007700">;<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br />}</span></code></pre>
<p>Notice that the class name is the same as the file name, and follows the pattern
<code>m&lt;timestamp&gt;_&lt;name&gt;</code>, where:</p>
<ul>
<li><code>&lt;timestamp&gt;</code> refers to the UTC timestamp (in the
format of <code>yymmdd_hhmmss</code>) when the migration is created,</li>
<li><code>&lt;name&gt;</code> is taken from the command's <code>name</code> parameter.</li>
</ul>
<p>In the class, the <code>up()</code> method should contain the code implementing the actual database
migration. In other words, the <code>up()</code> method executes code that actually changes the database. The <code>down()</code> method may contain code that reverts the changes made by <code>up()</code>.</p>
<p>Sometimes, it is impossible for the <code>down()</code> to undo the database migration. For example, if the migration deletes
table rows or an entire table, that data cannot be recovered in the <code>down()</code> method. In such
cases, the migration is called irreversible, meaning the database cannot be rolled back to
a previous state. When a migration is irreversible, as in the above generated code, the <code>down()</code>
method returns <code>false</code> to indicate that the migration cannot be reverted.</p>
<p>As an example, let's show the migration about creating a news table.</p>
<pre><code class="language-php"><span style="color: #0000BB"></span><span style="color: #007700">use&nbsp;</span><span style="color: #0000BB">yii</span><span style="color: #007700">\</span><span style="color: #0000BB">db</span><span style="color: #007700">\</span><span style="color: #0000BB">Schema</span><span style="color: #007700">;<br /><br />class&nbsp;</span><span style="color: #0000BB">m101129_185401_create_news_table&nbsp;</span><span style="color: #007700">extends&nbsp;\</span><span style="color: #0000BB">yii</span><span style="color: #007700">\</span><span style="color: #0000BB">db</span><span style="color: #007700">\</span><span style="color: #0000BB">Migration<br /></span><span style="color: #007700">{<br />&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;function&nbsp;</span><span style="color: #0000BB">up</span><span style="color: #007700">()<br />&nbsp;&nbsp;&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">createTable</span><span style="color: #007700">(</span><span style="color: #DD0000">'news'</span><span style="color: #007700">,&nbsp;[<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #DD0000">'id'&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #DD0000">'pk'</span><span style="color: #007700">,<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #DD0000">'title'&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #0000BB">Schema</span><span style="color: #007700">::</span><span style="color: #0000BB">TYPE_STRING&nbsp;</span><span style="color: #007700">.&nbsp;</span><span style="color: #DD0000">'&nbsp;NOT&nbsp;NULL'</span><span style="color: #007700">,<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #DD0000">'content'&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #0000BB">Schema</span><span style="color: #007700">::</span><span style="color: #0000BB">TYPE_TEXT</span><span style="color: #007700">,<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;]);<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;function&nbsp;</span><span style="color: #0000BB">down</span><span style="color: #007700">()<br />&nbsp;&nbsp;&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">dropTable</span><span style="color: #007700">(</span><span style="color: #DD0000">'news'</span><span style="color: #007700">);<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br /><br />}</span></code></pre>
<p>The base class <a href="./yii-db-migration.html">yii\db\Migration</a> exposes a database connection via <code>db</code>
property. You can use it for manipulating data and schema of a database.</p>
<p>The column types used in this example are abstract types that will be replaced
by Yii with the corresponding types depended on your database management system.
You can use them to write database independent migrations.
For example <code>pk</code> will be replaced by <code>int(11) NOT NULL AUTO_INCREMENT PRIMARY KEY</code>
for MySQL and <code>integer PRIMARY KEY AUTOINCREMENT NOT NULL</code> for sqlite.
See documentation of <a href="./yii-db-querybuilder.html#getColumnType()-detail">yii\db\QueryBuilder::getColumnType()</a> for more details and a list
of available types. You may also use the constants defined in <a href="./yii-db-schema.html">yii\db\Schema</a> to
define column types.</p>
<blockquote><p>Note: You can add constraints and other custom table options at the end of the table description by
specifying them as simple string. For example in the above migration, after <code>content</code> attribute definition
you can write <code>'CONSTRAINT ...'</code> or other custom options.</p>
</blockquote>
<h2>Transactional Migrations <a href="#transactional-migrations" name="transactional-migrations" class="hashlink">&para;</a></h2>
<p>While performing complex DB migrations, we usually want to make sure that each
migration succeed or fail as a whole so that the database maintains the
consistency and integrity. In order to achieve this goal, we can exploit
DB transactions. We could use special methods <code>safeUp</code> and <code>safeDown</code> for these purposes.</p>
<pre><code class="language-php"><span style="color: #0000BB"></span><span style="color: #007700">use&nbsp;</span><span style="color: #0000BB">yii</span><span style="color: #007700">\</span><span style="color: #0000BB">db</span><span style="color: #007700">\</span><span style="color: #0000BB">Schema</span><span style="color: #007700">;<br /><br />class&nbsp;</span><span style="color: #0000BB">m101129_185401_create_news_table&nbsp;</span><span style="color: #007700">extends&nbsp;\</span><span style="color: #0000BB">yii</span><span style="color: #007700">\</span><span style="color: #0000BB">db</span><span style="color: #007700">\</span><span style="color: #0000BB">Migration<br /></span><span style="color: #007700">{<br />&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;function&nbsp;</span><span style="color: #0000BB">safeUp</span><span style="color: #007700">()<br />&nbsp;&nbsp;&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">createTable</span><span style="color: #007700">(</span><span style="color: #DD0000">'news'</span><span style="color: #007700">,&nbsp;[<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #DD0000">'id'&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #DD0000">'pk'</span><span style="color: #007700">,<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #DD0000">'title'&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #0000BB">Schema</span><span style="color: #007700">::</span><span style="color: #0000BB">TYPE_STRING&nbsp;</span><span style="color: #007700">.&nbsp;</span><span style="color: #DD0000">'&nbsp;NOT&nbsp;NULL'</span><span style="color: #007700">,<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #DD0000">'content'&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #0000BB">Schema</span><span style="color: #007700">::</span><span style="color: #0000BB">TYPE_TEXT</span><span style="color: #007700">,<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;]);<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">createTable</span><span style="color: #007700">(</span><span style="color: #DD0000">'user'</span><span style="color: #007700">,&nbsp;[<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #DD0000">'id'&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #DD0000">'pk'</span><span style="color: #007700">,<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #DD0000">'login'&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #0000BB">Schema</span><span style="color: #007700">::</span><span style="color: #0000BB">TYPE_STRING&nbsp;</span><span style="color: #007700">.&nbsp;</span><span style="color: #DD0000">'&nbsp;NOT&nbsp;NULL'</span><span style="color: #007700">,<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #DD0000">'password'&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #0000BB">Schema</span><span style="color: #007700">::</span><span style="color: #0000BB">TYPE_STRING&nbsp;</span><span style="color: #007700">.&nbsp;</span><span style="color: #DD0000">'&nbsp;NOT&nbsp;NULL'</span><span style="color: #007700">,<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;]);<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;function&nbsp;</span><span style="color: #0000BB">safeDown</span><span style="color: #007700">()<br />&nbsp;&nbsp;&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">dropTable</span><span style="color: #007700">(</span><span style="color: #DD0000">'news'</span><span style="color: #007700">);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">dropTable</span><span style="color: #007700">(</span><span style="color: #DD0000">'user'</span><span style="color: #007700">);<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br /><br />}</span></code></pre>
<p>When your code uses more then one query it is recommended to use <code>safeUp</code> and <code>safeDown</code>.</p>
<blockquote><p>Note: Not all DBMS support transactions. And some DB queries cannot be put
into a transaction. In this case, you will have to implement <code>up()</code> and
<code>down()</code>, instead. And for MySQL, some SQL statements may cause
<a href="http://dev.mysql.com/doc/refman/5.1/en/implicit-commit.html">implicit commit</a>.</p>
</blockquote>
<h2>Applying Migrations <a href="#applying-migrations" name="applying-migrations" class="hashlink">&para;</a></h2>
<p>To apply all available new migrations (i.e., make the local database up-to-date),
run the following command:</p>
<pre><code>yii migrate
</code></pre>
<p>The command will show the list of all new migrations. If you confirm to apply
the migrations, it will run the <code>up()</code> method in every new migration class, one
after another, in the order of the timestamp value in the class name.</p>
<p>After applying a migration, the migration tool will keep a record in a database
table named <code>migration</code>. This allows the tool to identify which migrations
have been applied and which are not. If the <code>migration</code> table does not exist,
the tool will automatically create it in the database specified by the <code>db</code>
application component.</p>
<p>Sometimes, we may only want to apply one or a few new migrations. We can use the
following command:</p>
<pre><code>yii migrate/up 3
</code></pre>
<p>This command will apply the 3 new migrations. Changing the value 3 will allow
us to change the number of migrations to be applied.</p>
<p>We can also migrate the database to a specific version with the following command:</p>
<pre><code>yii migrate/to 101129_185401
</code></pre>
<p>That is, we use the timestamp part of a migration name to specify the version
that we want to migrate the database to. If there are multiple migrations between
the last applied migration and the specified migration, all these migrations
will be applied. If the specified migration has been applied before, then all
migrations applied after it will be reverted (to be described in the next section).</p>
<h2>Reverting Migrations <a href="#reverting-migrations" name="reverting-migrations" class="hashlink">&para;</a></h2>
<p>To revert the last one or several applied migrations, we can use the following
command:</p>
<pre><code>yii migrate/down [step]
</code></pre>
<p>where the optional <code>step</code> parameter specifies how many migrations to be reverted
back. It defaults to 1, meaning reverting back the last applied migration.</p>
<p>As we described before, not all migrations can be reverted. Trying to revert
such migrations will throw an exception and stop the whole reverting process.</p>
<h2>Redoing Migrations <a href="#redoing-migrations" name="redoing-migrations" class="hashlink">&para;</a></h2>
<p>Redoing migrations means first reverting and then applying the specified migrations.
This can be done with the following command:</p>
<pre><code>yii migrate/redo [step]
</code></pre>
<p>where the optional <code>step</code> parameter specifies how many migrations to be redone.
It defaults to 1, meaning redoing the last migration.</p>
<h2>Showing Migration Information <a href="#showing-migration-information" name="showing-migration-information" class="hashlink">&para;</a></h2>
<p>Besides applying and reverting migrations, the migration tool can also display
the migration history and the new migrations to be applied.</p>
<pre><code>yii migrate/history [limit]
yii migrate/new [limit]
</code></pre>
<p>where the optional parameter <code>limit</code> specifies the number of migrations to be
displayed. If <code>limit</code> is not specified, all available migrations will be displayed.</p>
<p>The first command shows the migrations that have been applied, while the second
command shows the migrations that have not been applied.</p>
<h2>Modifying Migration History <a href="#modifying-migration-history" name="modifying-migration-history" class="hashlink">&para;</a></h2>
<p>Sometimes, we may want to modify the migration history to a specific migration
version without actually applying or reverting the relevant migrations. This
often happens when developing a new migration. We can use the following command
to achieve this goal.</p>
<pre><code>yii migrate/mark 101129_185401
</code></pre>
<p>This command is very similar to <code>yii migrate/to</code> command, except that it only
modifies the migration history table to the specified version without applying
or reverting the migrations.</p>
<h2>Customizing Migration Command <a href="#customizing-migration-command" name="customizing-migration-command" class="hashlink">&para;</a></h2>
<p>There are several ways to customize the migration command.</p>
<h3>Use Command Line Options <a href="#use-command-line-options" name="use-command-line-options" class="hashlink">&para;</a></h3>
<p>The migration command comes with four options that can be specified in command
line:</p>
<ul>
<li><p><code>interactive</code>: boolean, specifies whether to perform migrations in an
interactive mode. Defaults to true, meaning the user will be prompted when
performing a specific migration. You may set this to false should the
migrations be done in a background process.</p>
</li>
<li><p><code>migrationPath</code>: string, specifies the directory storing all migration class
files. This must be specified in terms of a path alias, and the corresponding
directory must exist. If not specified, it will use the <code>migrations</code>
sub-directory under the application base path.</p>
</li>
<li><p><code>migrationTable</code>: string, specifies the name of the database table for storing
migration history information. It defaults to <code>migration</code>. The table
structure is <code>version varchar(255) primary key, apply_time integer</code>.</p>
</li>
<li><p><code>db</code>: string, specifies the ID of the database application component.
Defaults to 'db'.</p>
</li>
<li><p><code>templateFile</code>: string, specifies the path of the file to be served as the code
template for generating the migration classes. This must be specified in terms
of a path alias (e.g. <code>application.migrations.template</code>). If not set, an
internal template will be used. Inside the template, the token <code>{ClassName}</code>
will be replaced with the actual migration class name.</p>
</li>
</ul>
<p>To specify these options, execute the migrate command using the following format</p>
<pre><code>yii migrate/up --option1=value1 --option2=value2 ...
</code></pre>
<p>For example, if we want to migrate for a <code>forum</code> module whose migration files
are located within the module's <code>migrations</code> directory, we can use the following
command:</p>
<pre><code>yii migrate/up --migrationPath=@app/modules/forum/migrations
</code></pre>
<h3>Configure Command Globally <a href="#configure-command-globally" name="configure-command-globally" class="hashlink">&para;</a></h3>
<p>While command line options allow us to configure the migration command
on-the-fly, sometimes we may want to configure the command once for all.
For example, we may want to use a different table to store the migration history,
or we may want to use a customized migration template. We can do so by modifying
the console application's configuration file like the following,</p>
<pre><code class="language-php"><span style="color: #0000BB"></span><span style="color: #DD0000">'controllerMap'&nbsp;</span><span style="color: #007700">=&gt;&nbsp;[<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #DD0000">'migrate'&nbsp;</span><span style="color: #007700">=&gt;&nbsp;[<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #DD0000">'class'&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #DD0000">'yii\console\controllers\MigrateController'</span><span style="color: #007700">,<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #DD0000">'migrationTable'&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #DD0000">'my_custom_migrate_table'</span><span style="color: #007700">,<br />&nbsp;&nbsp;&nbsp;&nbsp;],<br />]</span></code></pre>
<p>Now if we run the <code>migrate</code> command, the above configurations will take effect
without requiring us to enter the command line options every time. Other command options
can be also configured this way.</p>
<h3>Migrating with Multiple Databases <a href="#migrating-with-multiple-databases" name="migrating-with-multiple-databases" class="hashlink">&para;</a></h3>
<p>By default, migrations will be applied to the database specified by the <code>db</code> application component.
You may change it by specifying the <code>--db</code> option, for example,</p>
<pre><code>yii migrate --db=db2
</code></pre>
<p>The above command will apply <em>all</em> migrations found in the default migration path to the <code>db2</code> database.</p>
<p>If your application works with multiple databases, it is possible that some migrations should be applied
to one database while some others should be applied to another database. In this case, it is recommended that
you create a base migration class for each different database and override the <a href="./yii-db-migration.html#init()-detail">yii\db\Migration::init()</a>
method like the following,</p>
<pre><code class="language-php"><span style="color: #0000BB"></span><span style="color: #007700">public&nbsp;function&nbsp;</span><span style="color: #0000BB">init</span><span style="color: #007700">()<br />{<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">db&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #DD0000">'db2'</span><span style="color: #007700">;<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">parent</span><span style="color: #007700">::</span><span style="color: #0000BB">init</span><span style="color: #007700">();<br />}</span></code></pre>
<p>To create a migration that should be applied to a particular database, simply extend from the corresponding
base migration class. Now if you run the <code>yii migrate</code> command, each migration will be applied to its corresponding database.</p>
<blockquote><p>Info: Because each migration uses hardcoded DB connection, the <code>--db</code> option of the <code>migrate</code> command will
  have no effect. Also note that the migration history will be stored in the default <code>db</code> database.</p>
</blockquote>
<p>If you want to support changing DB connection via the <code>--db</code> option, you may take the following alternative
approach to work with multiple databases.</p>
<p>For each database, create a migration path and save all corresponding migration classes there. To apply migrations,
run the command as follows,</p>
<pre><code>yii migrate --migrationPath=@app/migrations/db1 --db=db1
yii migrate --migrationPath=@app/migrations/db2 --db=db2
...
</code></pre>
<blockquote><p>Info: The above approach stores the migration history in different databases specified via the <code>--db</code> option.</p>
</blockquote>
        <div class="toplink"><a href="#" class="h1" title="go to top"><span class="glyphicon glyphicon-arrow-up"></a></div>
    </div>
</div>


</div>

<footer class="footer">
        <p class="pull-right"><small>Page generated on Tue, 16 Sep 2014 19:18:23 +0200</small></p>
    Powered by <a href="http://www.yiiframework.com/" rel="external">Yii Framework</a></footer>

<script type="text/javascript">jQuery(document).ready(function () {
    var shiftWindow = function () { scrollBy(0, -50) };
    if (location.hash) shiftWindow();
    window.addEventListener("hashchange", shiftWindow);
var element = document.createElement("script");
element.src = "./jssearch.index.js";
document.body.appendChild(element);

var searchBox = $('#searchbox');

// focus the search field
searchBox.focus();

// search when typing in search field
searchBox.on("keyup", function(event) {
    var query = $(this).val();

    if (query == '' || event.which == 27) {
        $('#search-resultbox').hide();
        return;
    } else if (event.which == 13) {
        var selectedLink = $('#search-resultbox a.selected');
        if (selectedLink.length != 0) {
            document.location = selectedLink.attr('href');
            return;
        }
    } else if (event.which == 38 || event.which == 40) {
        $('#search-resultbox').show();

        var selected = $('#search-resultbox a.selected');
        if (selected.length == 0) {
            $('#search-results').find('a').first().addClass('selected');
        } else {
            var next;
            if (event.which == 40) {
                next = selected.parent().next().find('a').first();
            } else {
                next = selected.parent().prev().find('a').first();
            }
            if (next.length != 0) {
                var resultbox = $('#search-results');
                var position = next.position();

//              TODO scrolling is buggy and jumps around
//                resultbox.scrollTop(Math.floor(position.top));
//                console.log(position.top);

                selected.removeClass('selected');
                next.addClass('selected');
            }
        }

        return;
    }
    $('#search-resultbox').show();
    $('#search-results').html('<li><span class="no-results">No results</span></li>');

    var result = jssearch.search(query);

    if (result.length > 0) {
        var i = 0;
        var resHtml = '';

        for (var key in result) {
            if (i++ > 20) {
                break;
            }
            resHtml = resHtml +
            '<li><a href="' + result[key].file.u.substr(3) +'"><span class="title">' + result[key].file.t + '</span>' +
            '<span class="description">' + result[key].file.d + '</span></a></li>';
        }
        $('#search-results').html(resHtml);
    }
});

// hide the search results on ESC
$(document).on("keyup", function(event) { if (event.which == 27) { $('#search-resultbox').hide(); } });
// hide search results on click to document
$(document).bind('click', function (e) { $('#search-resultbox').hide(); });
// except the following:
searchBox.bind('click', function(e) { e.stopPropagation(); });
$('#search-resultbox').bind('click', function(e) { e.stopPropagation(); });

});</script></body>
</html>
